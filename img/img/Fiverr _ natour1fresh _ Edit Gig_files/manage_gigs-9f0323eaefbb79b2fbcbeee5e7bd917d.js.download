var wysihtml5={version:"0.4.0pre",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"\ufeff",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};window.rangy=function(){function e(e,t){var n=typeof e[t];return n==u||!(n!=l||!e[t])||"unknown"==n}function t(e,t){return!(typeof e[t]!=l||!e[t])}function n(e,t){return typeof e[t]!=g}function i(e){return function(t,n){for(var i=n.length;i--;)if(!e(t,n[i]))return!1;return!0}}function r(e){return e&&v(e,h)&&_(e,m)}function a(e){window.alert("Rangy not supported in your browser. Reason: "+e),b.initialized=!0,b.supported=!1}function o(e){var t="Rangy warning: "+e;b.config.alertOnWarn?window.alert(t):typeof window.console!=g&&typeof window.console.log!=g&&window.console.log(t)}function s(){if(!b.initialized){var n,i=!1,o=!1;e(document,"createRange")&&(n=document.createRange(),v(n,f)&&_(n,p)&&(i=!0),n.detach());var s=t(document,"body")?document.body:document.getElementsByTagName("body")[0];s&&e(s,"createTextRange")&&(n=s.createTextRange(),r(n)&&(o=!0)),i||o||a("Neither Range nor TextRange are implemented"),b.initialized=!0,b.features={implementsDomRange:i,implementsTextRange:o};for(var c=C.concat(w),d=0,l=c.length;l>d;++d)try{c[d](b)}catch(u){t(window,"console")&&e(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",u)}}}function c(e){e=e||window,s();for(var t=0,n=x.length;n>t;++t)x[t](e)}function d(e){this.name=e,this.initialized=!1,this.supported=!1}var l="object",u="function",g="undefined",p=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],f=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],m=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],h=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],v=i(e),y=i(t),_=i(n),b={version:"1.2.2",initialized:!1,supported:!0,util:{isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:v,areHostObjects:y,areHostProperties:_,isTextRange:r},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};b.fail=a,b.warn=o,{}.hasOwnProperty?b.util.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}:a("hasOwnProperty not supported");var w=[],C=[];b.init=s,b.addInitListener=function(e){b.initialized?e(b):w.push(e)};var x=[];b.addCreateMissingNativeApiListener=function(e){x.push(e)},b.createMissingNativeApi=c,d.prototype.fail=function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},d.prototype.warn=function(e){b.warn("Module "+this.name+": "+e)},d.prototype.createError=function(e){return new Error("Error in Rangy "+this.name+" module: "+e)},b.createModule=function(e,t){var n=new d(e);b.modules[e]=n,C.push(function(e){t(e,n),n.initialized=!0,n.supported=!0})},b.requireModules=function(e){for(var t,n,i=0,r=e.length;r>i;++i){if(n=e[i],t=b.modules[n],!(t&&t instanceof d))throw new Error("Module '"+n+"' not found");if(!t.supported)throw new Error("Module '"+n+"' not supported")}};var S=!1,E=function(e){S||(S=!0,b.initialized||s())};return typeof window==g?void a("No window found"):typeof document==g?void a("No document found"):(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",E,!1),e(window,"addEventListener")?window.addEventListener("load",E,!1):e(window,"attachEvent")?window.attachEvent("onload",E):a("Window does not have required addEventListener or attachEvent method"),b)}(),rangy.createModule("DomUtil",function(e,t){function n(e){var t;return typeof e.namespaceURI==E||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function i(e){var t=e.parentNode;return 1==t.nodeType?t:null}function r(e){for(var t=0;e=e.previousSibling;)t++;return t}function a(e){var t;return d(e)?e.length:(t=e.childNodes)?t.length:0}function o(e,t){var n,i=[];for(n=e;n;n=n.parentNode)i.push(n);for(n=t;n;n=n.parentNode)if(D(i,n))return n;return null}function s(e,t,n){for(var i=n?t:t.parentNode;i;){if(i===e)return!0;i=i.parentNode}return!1}function c(e,t,n){for(var i,r=n?e:e.parentNode;r;){if(i=r.parentNode,i===t)return r;r=i}return null}function d(e){var t=e.nodeType;return 3==t||4==t||8==t}function l(e,t){var n=t.nextSibling,i=t.parentNode;return n?i.insertBefore(e,n):i.appendChild(e),e}function u(e,t){var n=e.cloneNode(!1);return n.deleteData(0,t),e.deleteData(t,e.length-t),l(n,e),n}function g(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=E)return e.ownerDocument;if(typeof e.document!=E)return e.document;if(e.parentNode)return g(e.parentNode);throw new Error("getDocument: no document found for node")}function p(e){var t=g(e);if(typeof t.defaultView!=E)return t.defaultView;if(typeof t.parentWindow!=E)return t.parentWindow;throw new Error("Cannot get a window object for node")}function f(e){if(typeof e.contentDocument!=E)return e.contentDocument;if(typeof e.contentWindow!=E)return e.contentWindow.document;throw new Error("getIframeWindow: No Document object found for iframe element")}function m(e){if(typeof e.contentWindow!=E)return e.contentWindow;if(typeof e.contentDocument!=E)return e.contentDocument.defaultView;throw new Error("getIframeWindow: No Window object found for iframe element")}function h(e){return N.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]}function v(e){for(var t;t=e.parentNode;)e=t;return e}function y(e,t,n,i){var a,s,d,l,u;if(e==n)return t===i?0:i>t?-1:1;if(a=c(n,e,!0))return t<=r(a)?-1:1;if(a=c(e,n,!0))return r(a)<i?-1:1;if(s=o(e,n),d=e===s?s:c(e,s,!0),l=n===s?s:c(n,s,!0),d===l)throw new Error("comparePoints got to case 4 and childA and childB are the same!");for(u=s.firstChild;u;){if(u===d)return-1;if(u===l)return 1;u=u.nextSibling}throw new Error("Should not be here!")}function _(e){for(var t,n=g(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function b(e){if(!e)return"[No node]";if(d(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+e.childNodes.length+"]"}return e.nodeName}function w(e){this.root=e,this._next=e}function C(e){return new w(e)}function x(e,t){this.node=e,this.offset=t}function S(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var E="undefined",N=e.util;N.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),N.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var T=document.createElement("div");N.areHostMethods(T,["insertBefore","appendChild","cloneNode"]||!N.areHostObjects(T,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),N.isHostProperty(T,"innerHTML")||t.fail("Element is missing innerHTML property");var k=document.createTextNode("test");N.areHostMethods(k,["splitText","deleteData","insertData","appendData","cloneNode"]||!N.areHostObjects(T,["previousSibling","nextSibling","childNodes","parentNode"])||!N.areHostProperties(k,["data"]))||t.fail("Incomplete Text Node implementation");var D=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1};w.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},x.prototype={equals:function(e){return this.node===e.node&this.offset==e.offset},inspect:function(){return"[DomPosition("+b(this.node)+":"+this.offset+")]"}},S.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},S.prototype.toString=function(){return this.message},e.dom={arrayContains:D,isHtmlNamespace:n,parentElement:i,getNodeIndex:r,getNodeLength:a,getCommonAncestor:o,isAncestorOf:s,getClosestAncestorIn:c,isCharacterDataNode:d,insertAfter:l,splitDataNode:u,getDocument:g,getWindow:p,getIframeWindow:m,getIframeDocument:f,getBody:h,getRootContainer:v,comparePoints:y,inspectNode:b,fragmentFromNodeChildren:_,createIterator:C,DomPosition:x},e.DOMException=S}),rangy.createModule("DomRange",function(e,t){function n(e,t){return 3!=e.nodeType&&(M.isAncestorOf(e,t.startContainer,!0)||M.isAncestorOf(e,t.endContainer,!0))}function i(e){return M.getDocument(e.startContainer)}function r(e,t,n){var i=e._listeners[t];if(i)for(var r=0,a=i.length;a>r;++r)i[r].call(e,{target:e,args:n})}function a(e){return new H(e.parentNode,M.getNodeIndex(e))}function o(e){return new H(e.parentNode,M.getNodeIndex(e)+1)}function s(e,t,n){var i=11==e.nodeType?e.firstChild:e;return M.isCharacterDataNode(t)?n==t.length?M.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:M.splitDataNode(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),i}function c(e){for(var t,n,r,a=i(e.range).createDocumentFragment();n=e.next();){if(t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(r=e.getSubtreeIterator(),n.appendChild(c(r)),r.detach(!0)),10==n.nodeType)throw new F("HIERARCHY_REQUEST_ERR");a.appendChild(n)}return a}function d(e,t,n){var i,r;n=n||{stop:!1};for(var a,o;a=e.next();)if(e.isPartiallySelectedSubtree()){if(t(a)===!1)return void(n.stop=!0);if(o=e.getSubtreeIterator(),d(o,t,n),o.detach(!0),n.stop)return}else for(i=M.createIterator(a);r=i.next();)if(t(r)===!1)return void(n.stop=!0)}function l(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),l(t),t.detach(!0)):e.remove()}function u(e){for(var t,n,r=i(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(u(n)),n.detach(!0)):e.remove(),10==t.nodeType)throw new F("HIERARCHY_REQUEST_ERR");r.appendChild(t)}return r}function g(e,t,n){var i,r=!(!t||!t.length),a=!!n;r&&(i=new RegExp("^("+t.join("|")+")$"));var o=[];return d(new f(e,!1),function(e){r&&!i.test(e.nodeType)||a&&!n(e)||o.push(e)}),o}function p(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+M.inspectNode(e.startContainer)+":"+e.startOffset+", "+M.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function f(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&M.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||M.isCharacterDataNode(this.sc)?M.getClosestAncestorIn(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||M.isCharacterDataNode(this.ec)?M.getClosestAncestorIn(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function m(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function h(e,t,n){this.nodes=g(e,t,n),this._next=this.nodes[0],this._position=0}function v(e){return function(t,n){for(var i,r=n?t:t.parentNode;r;){if(i=r.nodeType,M.arrayContains(e,i))return r;r=r.parentNode}return null}}function y(e,t){if(K(e,t))throw new m("INVALID_NODE_TYPE_ERR")}function _(e){if(!e.startContainer)throw new F("INVALID_STATE_ERR")}function b(e,t){if(!M.arrayContains(t,e.nodeType))throw new m("INVALID_NODE_TYPE_ERR")}function w(e,t){if(0>t||t>(M.isCharacterDataNode(e)?e.length:e.childNodes.length))throw new F("INDEX_SIZE_ERR")}function C(e,t){if(V(e,!0)!==V(t,!0))throw new F("WRONG_DOCUMENT_ERR")}function x(e){if(z(e,!0))throw new F("NO_MODIFICATION_ALLOWED_ERR")}function S(e,t){if(!e)throw new F(t)}function E(e){return!M.arrayContains(G,e.nodeType)&&!V(e,!0)}function N(e,t){return t<=(M.isCharacterDataNode(e)?e.length:e.childNodes.length)}function T(e){if(_(e),E(e.startContainer)||E(e.endContainer)||!N(e.startContainer,e.startOffset)||!N(e.endContainer,e.endOffset))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function k(){}function D(e){e.START_TO_START=ee,e.START_TO_END=te,e.END_TO_END=ne,e.END_TO_START=ie,e.NODE_BEFORE=re,e.NODE_AFTER=ae,e.NODE_BEFORE_AND_AFTER=oe,e.NODE_INSIDE=se}function R(e){D(e),D(e.prototype)}function A(e,t){return function(){T(this);var n,i,r=this.startContainer,a=this.startOffset,s=this.commonAncestorContainer,c=new f(this,!0);r!==s&&(n=M.getClosestAncestorIn(r,s,!0),i=o(n),r=i.node,a=i.offset),d(c,x),c.reset();var l=e(c);return c.detach(),t(this,r,a,r,a),l}}function I(t,i,r){function s(e,t){return function(n){_(this),b(n,B),b(U(n),G);var i=(e?a:o)(n);(t?c:d)(this,i.node,i.offset)}}function c(e,t,n){var r=e.endContainer,a=e.endOffset;(t!==e.startContainer||n!==e.startOffset)&&((U(t)!=U(r)||1==M.comparePoints(t,n,r,a))&&(r=t,a=n),i(e,t,n,r,a))}function d(e,t,n){var r=e.startContainer,a=e.startOffset;(t!==e.endContainer||n!==e.endOffset)&&((U(t)!=U(r)||-1==M.comparePoints(t,n,r,a))&&(r=t,a=n),i(e,r,a,t,n))}function g(e,t,n){(t!==e.startContainer||n!==e.startOffset||t!==e.endContainer||n!==e.endOffset)&&i(e,t,n,t,n)}t.prototype=new k,e.util.extend(t.prototype,{setStart:function(e,t){_(this),y(e,!0),w(e,t),c(this,e,t)},setEnd:function(e,t){_(this),y(e,!0),w(e,t),d(this,e,t)},setStartBefore:s(!0,!0),setStartAfter:s(!1,!0),setEndBefore:s(!0,!1),setEndAfter:s(!1,!1),collapse:function(e){T(this),e?i(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):i(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){_(this),y(e,!0),i(this,e,0,e,M.getNodeLength(e))},selectNode:function(e){_(this),y(e,!1),b(e,B);var t=a(e),n=o(e);i(this,t.node,t.offset,n.node,n.offset)},extractContents:A(u,i),deleteContents:A(l,i),canSurroundContents:function(){T(this),x(this.startContainer),x(this.endContainer);var e=new f(this,!0),t=e._first&&n(e._first,this)||e._last&&n(e._last,this);return e.detach(),!t},detach:function(){r(this)},splitBoundaries:function(){T(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,r=this.endOffset,a=e===n;M.isCharacterDataNode(n)&&r>0&&r<n.length&&M.splitDataNode(n,r),M.isCharacterDataNode(e)&&t>0&&t<e.length&&(e=M.splitDataNode(e,t),a?(r-=t,n=e):n==e.parentNode&&r>=M.getNodeIndex(e)&&r++,t=0),i(this,e,t,n,r)},normalizeBoundaries:function(){T(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,r=this.endOffset,a=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(n=e,r=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},o=function(i){var a=i.previousSibling;if(a&&a.nodeType==i.nodeType){e=i;var o=i.length;if(t=a.length,i.insertData(0,a.data),a.parentNode.removeChild(a),e==n)r+=t,n=e;else if(n==i.parentNode){var s=M.getNodeIndex(i);r==s?(n=i,r=o):r>s&&r--}}},s=!0;if(M.isCharacterDataNode(n))n.length==r&&a(n);else{if(r>0){var c=n.childNodes[r-1];c&&M.isCharacterDataNode(c)&&a(c)}s=!this.collapsed}if(s){if(M.isCharacterDataNode(e))0==t&&o(e);else if(t<e.childNodes.length){var d=e.childNodes[t];d&&M.isCharacterDataNode(d)&&o(d)}}else e=n,t=r;i(this,e,t,n,r)},collapseToPoint:function(e,t){_(this),y(e,!0),w(e,t),g(this,e,t)}}),R(t)}function O(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:M.getCommonAncestor(e.startContainer,e.endContainer)}function P(e,t,n,i,a){var o=e.startContainer!==t||e.startOffset!==n,s=e.endContainer!==i||e.endOffset!==a;e.startContainer=t,e.startOffset=n,e.endContainer=i,e.endOffset=a,O(e),r(e,"boundarychange",{startMoved:o,endMoved:s})}function j(e){_(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=null,e.collapsed=e.commonAncestorContainer=null,r(e,"detach",null),e._listeners=null}function L(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},O(this)}e.requireModules(["DomUtil"]);var M=e.dom,H=M.DomPosition,F=e.DOMException;f.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,M.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!M.isCharacterDataNode(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return n(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse();else{e=new L(i(this.range));var t=this._current,n=t,r=0,a=t,o=M.getNodeLength(t);M.isAncestorOf(t,this.sc,!0)&&(n=this.sc,r=this.so),M.isAncestorOf(t,this.ec,!0)&&(a=this.ec,o=this.eo),P(e,n,r,a,o)}return new f(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},m.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},m.prototype.toString=function(){return this.message},h.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var B=[1,3,4,5,7,8,10],G=[2,9,11],$=[5,6,10,12],q=[1,3,4,5,7,8,10,11],W=[1,3,4,5,7,8],U=M.getRootContainer,V=v([9,11]),z=v($),K=v([6,10,12]),Y=document.createElement("style"),X=!1;try{Y.innerHTML="<b>x</b>",X=3==Y.firstChild.nodeType}catch(Q){}e.features.htmlParsingConforms=X;var J=X?function(e){var t=this.startContainer,n=M.getDocument(t);if(!t)throw new F("INVALID_STATE_ERR");var i=null;return 1==t.nodeType?i=t:M.isCharacterDataNode(t)&&(i=M.parentElement(t)),i=null===i||"HTML"==i.nodeName&&M.isHtmlNamespace(M.getDocument(i).documentElement)&&M.isHtmlNamespace(i)?n.createElement("body"):i.cloneNode(!1),i.innerHTML=e,M.fragmentFromNodeChildren(i)}:function(e){_(this);var t=i(this),n=t.createElement("body");return n.innerHTML=e,M.fragmentFromNodeChildren(n)},Z=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ee=0,te=1,ne=2,ie=3,re=0,ae=1,oe=2,se=3;k.prototype={attachListener:function(e,t){this._listeners[e].push(t)},compareBoundaryPoints:function(e,t){T(this),C(this.startContainer,t.startContainer);var n,i,r,a,o=e==ie||e==ee?"start":"end",s=e==te||e==ee?"start":"end";return n=this[o+"Container"],i=this[o+"Offset"],r=t[s+"Container"],a=t[s+"Offset"],M.comparePoints(n,i,r,a)},insertNode:function(e){if(T(this),b(e,q),x(this.startContainer),M.isAncestorOf(e,this.startContainer,!0))throw new F("HIERARCHY_REQUEST_ERR");var t=s(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){T(this);var e,t;if(this.collapsed)return i(this).createDocumentFragment();if(this.startContainer===this.endContainer&&M.isCharacterDataNode(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=i(this).createDocumentFragment(),t.appendChild(e),t;var n=new f(this,!0);return e=c(n),n.detach(),e},canSurroundContents:function(){T(this),x(this.startContainer),x(this.endContainer);var e=new f(this,!0),t=e._first&&n(e._first,this)||e._last&&n(e._last,this);return e.detach(),!t},surroundContents:function(e){if(b(e,W),!this.canSurroundContents())throw new m("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);s(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){T(this);for(var e,t=new L(i(this)),n=Z.length;n--;)e=Z[n],t[e]=this[e];return t},toString:function(){T(this);var e=this.startContainer;if(e===this.endContainer&&M.isCharacterDataNode(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new f(this,!0);return d(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){T(this);var t=e.parentNode,n=M.getNodeIndex(e);if(!t)throw new F("NOT_FOUND_ERR");var i=this.comparePoint(t,n),r=this.comparePoint(t,n+1);return 0>i?r>0?oe:re:r>0?ae:se},comparePoint:function(e,t){return T(this),S(e,"HIERARCHY_REQUEST_ERR"),C(e,this.startContainer),M.comparePoints(e,t,this.startContainer,this.startOffset)<0?-1:M.comparePoints(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:J,toHtml:function(){T(this);var e=i(this).createElement("div");return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){if(T(this),S(e,"NOT_FOUND_ERR"),M.getDocument(e)!==i(this))return!1;var n=e.parentNode,r=M.getNodeIndex(e);S(n,"NOT_FOUND_ERR");var a=M.comparePoints(n,r,this.endContainer,this.endOffset),o=M.comparePoints(n,r+1,this.startContainer,this.startOffset);return t?0>=a&&o>=0:0>a&&o>0},isPointInRange:function(e,t){return T(this),S(e,"HIERARCHY_REQUEST_ERR"),C(e,this.startContainer),M.comparePoints(e,t,this.startContainer,this.startOffset)>=0&&M.comparePoints(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e,t){if(T(this),i(e)!=i(this))throw new F("WRONG_DOCUMENT_ERR");var n=M.comparePoints(this.startContainer,this.startOffset,e.endContainer,e.endOffset),r=M.comparePoints(this.endContainer,this.endOffset,e.startContainer,e.startOffset);return t?0>=n&&r>=0:0>n&&r>0},intersection:function(e){if(this.intersectsRange(e)){var t=M.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=M.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset),i=this.cloneRange();return-1==t&&i.setStart(e.startContainer,e.startOffset),1==n&&i.setEnd(e.endContainer,e.endOffset),i}return null},union:function(e){if(this.intersectsRange(e,!0)){var t=this.cloneRange();return-1==M.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==M.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new m("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==se},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,M.getNodeLength(e))<=0},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var i=n.pop();t.setEnd(i,i.length);var r=this.containsRange(t);return t.detach(),r}return this.containsNodeContents(e)},createNodeIterator:function(e,t){return T(this),new h(this,e,t)},getNodes:function(e,t){return T(this),g(this,e,t)},getDocument:function(){return i(this)},collapseBefore:function(e){_(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){_(this),this.setStartAfter(e),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(e){return L.rangesEqual(this,e)},inspect:function(){return p(this)}},I(L,P,j),e.rangePrototype=k.prototype,L.rangeProperties=Z,L.RangeIterator=f,L.copyComparisonConstants=R,L.createPrototypeRange=I,L.inspect=p,L.getRangeDocument=i,L.rangesEqual=function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset},e.DomRange=L,e.RangeException=m}),rangy.createModule("WrappedRange",function(e,t){function n(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var i=n.parentElement();n=e.duplicate(),n.collapse(!1);var r=n.parentElement(),a=i==r?i:s.getCommonAncestor(i,r);return a==t?a:s.getCommonAncestor(t,a)}function i(e){return 0==e.compareEndPoints("StartToEnd",e)}function r(e,t,n,i){var r=e.duplicate();r.collapse(n);var a=r.parentElement();if(s.isAncestorOf(t,a,!0)||(a=t),!a.canHaveHTML)return new c(a.parentNode,s.getNodeIndex(a));var o,d,l,u,g,p=s.getDocument(a).createElement("span"),f=n?"StartToStart":"StartToEnd";do a.insertBefore(p,p.previousSibling),r.moveToElementText(p);while((o=r.compareEndPoints(f,e))>0&&p.previousSibling);if(g=p.nextSibling,-1==o&&g&&s.isCharacterDataNode(g)){r.setEndPoint(n?"EndToStart":"EndToEnd",e);var m;if(/[\r\n]/.test(g.data)){var h=r.duplicate(),v=h.text.replace(/\r\n/g,"\r").length;for(m=h.moveStart("character",v);-1==(o=h.compareEndPoints("StartToEnd",h));)m++,h.moveStart("character",1)}else m=r.text.length;u=new c(g,m)}else d=(i||!n)&&p.previousSibling,l=(i||n)&&p.nextSibling,u=l&&s.isCharacterDataNode(l)?new c(l,0):d&&s.isCharacterDataNode(d)?new c(d,d.length):new c(a,s.getNodeIndex(p));return p.parentNode.removeChild(p),u}function a(e,t){var n,i,r,a,o=e.offset,c=s.getDocument(e.node),d=c.body.createTextRange(),l=s.isCharacterDataNode(e.node);return l?(n=e.node,i=n.parentNode):(a=e.node.childNodes,n=o<a.length?a[o]:null,i=e.node),r=c.createElement("span"),r.innerHTML="&#feff;",n?i.insertBefore(r,n):i.appendChild(r),d.moveToElementText(r),d.collapse(!t),i.removeChild(r),l&&d[t?"moveStart":"moveEnd"]("character",o),d}e.requireModules(["DomUtil","DomRange"]);var o,s=e.dom,c=s.DomPosition,d=e.DomRange;if(!e.features.implementsDomRange||e.features.implementsTextRange&&e.config.preferTextRange){if(e.features.implementsTextRange){o=function(e){this.textRange=e,this.refresh()},o.prototype=new d(document),o.prototype.refresh=function(){var e,t,a=n(this.textRange);i(this.textRange)?t=e=r(this.textRange,a,!0,!0):(e=r(this.textRange,a,!0,!1),t=r(this.textRange,a,!1,!1)),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},d.copyComparisonConstants(o);var l=function(){return this}();"undefined"==typeof l.Range&&(l.Range=o),e.createNativeRange=function(e){return e=e||document,e.body.createTextRange()}}}else!function(){function t(e){for(var t,n=l.length;n--;)t=l[n],e[t]=e.nativeRange[t]}function n(e,t,n,i,r){var a=e.startContainer!==t||e.startOffset!=n,o=e.endContainer!==i||e.endOffset!=r;(a||o)&&(e.setEnd(i,r),e.setStart(t,n))}function i(e){e.nativeRange.detach(),e.detached=!0;for(var t,n=l.length;n--;)t=l[n],e[t]=null}var r,a,c,l=d.rangeProperties;o=function(e){if(!e)throw new Error("Range must be specified");this.nativeRange=e,t(this)},d.createPrototypeRange(o,n,i),r=o.prototype,r.selectNode=function(e){this.nativeRange.selectNode(e),t(this)},r.deleteContents=function(){this.nativeRange.deleteContents(),t(this)},r.extractContents=function(){var e=this.nativeRange.extractContents();return t(this),e},r.cloneContents=function(){return this.nativeRange.cloneContents()},r.surroundContents=function(e){this.nativeRange.surroundContents(e),t(this)},r.collapse=function(e){this.nativeRange.collapse(e),t(this)},r.cloneRange=function(){return new o(this.nativeRange.cloneRange())},r.refresh=function(){t(this)},r.toString=function(){return this.nativeRange.toString()};var u=document.createTextNode("test");s.getBody(document).appendChild(u);var g=document.createRange();g.setStart(u,0),g.setEnd(u,0);try{g.setStart(u,1),a=!0,r.setStart=function(e,n){this.nativeRange.setStart(e,n),t(this)},r.setEnd=function(e,n){this.nativeRange.setEnd(e,n),t(this)},c=function(e){return function(n){this.nativeRange[e](n),t(this)}}}catch(p){a=!1,r.setStart=function(e,n){try{this.nativeRange.setStart(e,n)}catch(i){this.nativeRange.setEnd(e,n),this.nativeRange.setStart(e,n)}t(this)},r.setEnd=function(e,n){try{this.nativeRange.setEnd(e,n)}catch(i){this.nativeRange.setStart(e,n),this.nativeRange.setEnd(e,n)}t(this)},c=function(e,n){return function(i){try{this.nativeRange[e](i)}catch(r){this.nativeRange[n](i),this.nativeRange[e](i)}t(this)}}}r.setStartBefore=c("setStartBefore","setEndBefore"),r.setStartAfter=c("setStartAfter","setEndAfter"),r.setEndBefore=c("setEndBefore","setStartBefore"),r.setEndAfter=c("setEndAfter","setStartAfter"),g.selectNodeContents(u),g.startContainer==u&&g.endContainer==u&&0==g.startOffset&&g.endOffset==u.length?r.selectNodeContents=function(e){this.nativeRange.selectNodeContents(e),t(this)}:r.selectNodeContents=function(e){this.setStart(e,0),this.setEnd(e,d.getEndOffset(e))},g.selectNodeContents(u),g.setEnd(u,3);var f=document.createRange();f.selectNodeContents(u),f.setEnd(u,4),f.setStart(u,2),-1==g.compareBoundaryPoints(g.START_TO_END,f)&1==g.compareBoundaryPoints(g.END_TO_START,f)?r.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:r.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)},e.util.isHostMethod(g,"createContextualFragment")&&(r.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),s.getBody(document).removeChild(u),g.detach(),f.detach()}(),e.createNativeRange=function(e){return e=e||document,e.createRange()};e.features.implementsTextRange&&(o.rangeToTextRange=function(e){if(e.collapsed){var t=a(new c(e.startContainer,e.startOffset),!0);return t}var n=a(new c(e.startContainer,e.startOffset),!0),i=a(new c(e.endContainer,e.endOffset),!1),r=s.getDocument(e.startContainer).body.createTextRange();return r.setEndPoint("StartToStart",n),r.setEndPoint("EndToEnd",i),r}),o.prototype.getName=function(){return"WrappedRange"},e.WrappedRange=o,e.createRange=function(t){return t=t||document,new o(e.createNativeRange(t))},e.createRangyRange=function(e){return e=e||document,new d(e)},e.createIframeRange=function(t){return e.createRange(s.getIframeDocument(t))},e.createIframeRangyRange=function(t){return e.createRangyRange(s.getIframeDocument(t))},e.addCreateMissingNativeApiListener(function(t){var n=t.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return e.createRange(this)}),n=t=null})}),rangy.createModule("WrappedSelection",function(e,t){function n(e){return(e||window).getSelection()}function i(e){return(e||window).document.selection}function r(e,t,n){var i=n?"end":"start",r=n?"start":"end";e.anchorNode=t[i+"Container"],e.anchorOffset=t[i+"Offset"],e.focusNode=t[r+"Container"],e.focusOffset=t[r+"Offset"]}function a(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function o(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function s(t){var n;return t instanceof S?(n=t._selectionNativeRange,n||(n=e.createNativeRange(C.getDocument(t.startContainer)),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset),t._selectionNativeRange=n,t.attachListener("detach",function(){this._selectionNativeRange=null}))):t instanceof E?n=t.nativeRange:e.features.implementsDomRange&&t instanceof C.getWindow(t.startContainer).Range&&(n=t),n}function c(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!C.isAncestorOf(e[0],e[t]))return!1;return!0}function d(e){var t=e.getNodes();if(!c(t))throw new Error("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return t[0]}function l(e){return!!e&&"undefined"!=typeof e.text}function u(e,t){var n=new E(t);e._ranges=[n],r(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function g(t){if(t._ranges.length=0,"None"==t.docSelection.type)o(t);else{var n=t.docSelection.createRange();if(l(n))u(t,n);else{t.rangeCount=n.length;for(var i,a=C.getDocument(n.item(0)),s=0;s<t.rangeCount;++s)i=e.createRange(a),i.selectNode(n.item(s)),t._ranges.push(i);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,r(t,t._ranges[t.rangeCount-1],!1)}}}function p(e,t){for(var n=e.docSelection.createRange(),i=d(t),r=C.getDocument(n.item(0)),a=C.getBody(r).createControlRange(),o=0,s=n.length;s>o;++o)a.add(n.item(o));try{a.add(i)}catch(c){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a.select(),g(e)}function f(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function m(e,t){for(var n,i=C.getDocument(t[0].startContainer),r=C.getBody(i).createControlRange(),a=0;a<rangeCount;++a){n=d(t[a]);try{r.add(n)}catch(o){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}r.select(),g(e)}function h(e,t){if(e.anchorNode&&C.getDocument(e.anchorNode)!==C.getDocument(t))throw new N("WRONG_DOCUMENT_ERR")}function v(e){var t=[],n=new T(e.anchorNode,e.anchorOffset),i=new T(e.focusNode,e.focusOffset),r="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var a=0,o=e.rangeCount;o>a;++a)t[a]=S.inspect(e.getRangeAt(a));return"["+r+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+i.inspect()+"]"}e.requireModules(["DomUtil","DomRange","WrappedRange"]),e.config.checkSelectionRanges=!0;var y,_,b="boolean",w="_rangySelection",C=e.dom,x=e.util,S=e.DomRange,E=e.WrappedRange,N=e.DOMException,T=C.DomPosition,k="Control",D=e.util.isHostMethod(window,"getSelection"),R=e.util.isHostObject(document,"selection"),A=R&&(!D||e.config.preferTextRange);A?(y=i,e.isSelectionValid=function(e){var t=(e||window).document,n=t.selection;return"None"!=n.type||C.getDocument(n.createRange().parentElement())==t}):D?(y=n,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=y;var I=y(),O=e.createNativeRange(document),P=C.getBody(document),j=x.areHostObjects(I,["anchorNode","focusNode"]&&x.areHostProperties(I,["anchorOffset","focusOffset"]));e.features.selectionHasAnchorAndFocus=j;var L=x.isHostMethod(I,"extend");e.features.selectionHasExtend=L;var M="number"==typeof I.rangeCount;e.features.selectionHasRangeCount=M;var H=!1,F=!0;x.areHostMethods(I,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof I.rangeCount&&e.features.implementsDomRange&&!function(){var e=document.createElement("iframe");P.appendChild(e);var t=C.getIframeDocument(e);t.open(),t.write("<html><head></head><body>12</body></html>"),t.close();var n=C.getIframeWindow(e).getSelection(),i=t.documentElement,r=i.lastChild,a=r.firstChild,o=t.createRange();o.setStart(a,1),o.collapse(!0),n.addRange(o),F=1==n.rangeCount,n.removeAllRanges();var s=o.cloneRange();o.setStart(a,0),s.setEnd(a,2),n.addRange(o),n.addRange(s),H=2==n.rangeCount,o.detach(),s.detach(),P.removeChild(e)}(),e.features.selectionSupportsMultipleRanges=H,e.features.collapsedNonEditableSelectionsSupported=F;var B,G=!1;P&&x.isHostMethod(P,"createControlRange")&&(B=P.createControlRange(),x.areHostProperties(B,["item","add"])&&(G=!0)),e.features.implementsControlRange=G,_=j?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var $;x.isHostMethod(I,"getRangeAt")?$=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:j&&($=function(t){var n=C.getDocument(t.anchorNode),i=e.createRange(n);return i.setStart(t.anchorNode,t.anchorOffset),i.setEnd(t.focusNode,t.focusOffset),i.collapsed!==this.isCollapsed&&(i.setStart(t.focusNode,t.focusOffset),i.setEnd(t.anchorNode,t.anchorOffset)),i}),e.getSelection=function(e){e=e||window;var t=e[w],n=y(e),r=R?i(e):null;return t?(t.nativeSelection=n,t.docSelection=r,t.refresh(e)):(t=new f(n,r,e),e[w]=t),t},e.getIframeSelection=function(t){return e.getSelection(C.getIframeWindow(t))};var q=f.prototype;if(!A&&j&&x.areHostMethods(I,["removeAllRanges","addRange"])){q.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),o(this)};var W=function(t,n){var i=S.getRangeDocument(n),r=e.createRange(i);r.collapseToPoint(n.endContainer,n.endOffset),t.nativeSelection.addRange(s(r)),t.nativeSelection.extend(n.startContainer,n.startOffset),t.refresh()};M?q.addRange=function(t,n){if(G&&R&&this.docSelection.type==k)p(this,t);else if(n&&L)W(this,t);else{var i;if(H?i=this.rangeCount:(this.removeAllRanges(),i=0),this.nativeSelection.addRange(s(t)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==i+1){if(e.config.checkSelectionRanges){var a=$(this.nativeSelection,this.rangeCount-1);a&&!S.rangesEqual(a,t)&&(t=new E(a))}this._ranges[this.rangeCount-1]=t,r(this,t,z(this.nativeSelection)),this.isCollapsed=_(this)}else this.refresh()}}:q.addRange=function(e,t){t&&L?W(this,e):(this.nativeSelection.addRange(s(e)),this.refresh())},q.setRanges=function(e){if(G&&e.length>1)m(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(x.isHostMethod(I,"empty")&&x.isHostMethod(O,"select")&&G&&A))return t.fail("No means of selecting a Range or TextRange was found"),!1;q.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=C.getDocument(this.anchorNode);else if(this.docSelection.type==k){var t=this.docSelection.createRange();t.length&&(e=C.getDocument(t.item(0)).body.createTextRange())}if(e){var n=e.body.createTextRange();n.select(),this.docSelection.empty()}}}catch(i){}o(this)},q.addRange=function(e){this.docSelection.type==k?p(this,e):(E.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,r(this,e,!1))},q.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?m(this,e):t&&this.addRange(e[0])}}q.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new N("INDEX_SIZE_ERR");return this._ranges[e]};var U;if(A)U=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=C.getBody(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==k?g(t):l(n)?u(t,n):o(t)};else if(x.isHostMethod(I,"getRangeAt")&&"number"==typeof I.rangeCount)U=function(t){if(G&&R&&t.docSelection.type==k)g(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,i=t.rangeCount;i>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));r(t,t._ranges[t.rangeCount-1],z(t.nativeSelection)),t.isCollapsed=_(t)}else o(t)};else{if(!j||typeof I.isCollapsed!=b||typeof O.collapsed!=b||!e.features.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;U=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=$(n,0),e._ranges=[t],e.rangeCount=1,a(e),e.isCollapsed=_(e)):o(e)}}q.refresh=function(e){var t=e?this._ranges.slice(0):null;if(U(this),e){var n=t.length;if(n!=this._ranges.length)return!1;for(;n--;)if(!S.rangesEqual(t[n],this._ranges[n]))return!1;return!0}};var V=function(e,t){var n=e.getAllRanges(),i=!1;e.removeAllRanges();for(var r=0,a=n.length;a>r;++r)i||t!==n[r]?e.addRange(n[r]):i=!0;e.rangeCount||o(e)};G?q.removeRange=function(e){if(this.docSelection.type==k){for(var t,n=this.docSelection.createRange(),i=d(e),r=C.getDocument(n.item(0)),a=C.getBody(r).createControlRange(),o=!1,s=0,c=n.length;c>s;++s)t=n.item(s),t!==i||o?a.add(n.item(s)):o=!0;a.select(),g(this)}else V(this,e)}:q.removeRange=function(e){V(this,e)};var z;!A&&j&&e.features.implementsDomRange?(z=function(e){var t=!1;return e.anchorNode&&(t=1==C.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t},q.isBackwards=function(){return z(this)}):z=q.isBackwards=function(){return!1},q.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},q.collapse=function(t,n){h(this,t);var i=e.createRange(C.getDocument(t));i.collapseToPoint(t,n),this.removeAllRanges(),this.addRange(i),this.isCollapsed=!0},q.collapseToStart=function(){if(!this.rangeCount)throw new N("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},q.collapseToEnd=function(){if(!this.rangeCount)throw new N("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},q.selectAllChildren=function(t){h(this,t);var n=e.createRange(C.getDocument(t));n.selectNodeContents(t),this.removeAllRanges(),this.addRange(n)},q.deleteFromDocument=function(){if(G&&R&&this.docSelection.type==k){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();this.removeAllRanges();for(var i=0,r=n.length;r>i;++i)n[i].deleteContents();this.addRange(n[r-1])}},q.getAllRanges=function(){return this._ranges.slice(0)},q.setSingleRange=function(e){this.setRanges([e])},q.containsNode=function(e,t){for(var n=0,i=this._ranges.length;i>n;++n)if(this._ranges[n].containsNode(e,t))return!0;return!1},q.toHtml=function(){var e="";if(this.rangeCount){for(var t=S.getRangeDocument(this._ranges[0]).createElement("div"),n=0,i=this._ranges.length;i>n;++n)t.appendChild(this._ranges[n].cloneContents());e=t.innerHTML}return e},q.getName=function(){return"WrappedSelection"},q.inspect=function(){return v(this)},q.detach=function(){this.win[w]=null,this.win=this.anchorNode=this.focusNode=null},f.inspect=v,e.Selection=f,e.selectionPrototype=q,e.addCreateMissingNativeApiListener(function(t){"undefined"==typeof t.getSelection&&(t.getSelection=function(){return e.getSelection(this)}),t=null})});var Base=function(){};Base.extend=function(e,t){var n=Base.prototype.extend;Base._prototyping=!0;var i=new this;n.call(i,e),i.base=function(){},delete Base._prototyping;var r=i.constructor,a=i.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==a)this._constructing=!0,r.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||n).call(arguments[0],i)};return a.ancestor=this,a.extend=this.extend,a.forEach=this.forEach,a.implement=this.implement,a.prototype=i,a.toString=this.toString,a.valueOf=function(e){return"object"==e?a:r.valueOf()},n.call(a,t),"function"==typeof a.init&&a.init(),a},Base.prototype={extend:function(e,t){if(arguments.length>1){var n=this[e];if(n&&"function"==typeof t&&(!n.valueOf||n.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)){var i=t.valueOf();t=function(){var e=this.base||Base.prototype.base;this.base=n;var t=i.apply(this,arguments);return this.base=e,t},t.valueOf=function(e){return"object"==e?t:i},t.toString=Base.toString}this[e]=t}else if(e){var r=Base.prototype.extend;Base._prototyping||"function"==typeof this||(r=this.extend||r);for(var a={toSource:null},o=["constructor","toString","valueOf"],s=Base._prototyping?0:1;c=o[s++];)e[c]!=a[c]&&r.call(this,c,e[c]);for(var c in e)a[c]||r.call(this,c,e[c])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(e,t,n){for(var i in e)void 0===this.prototype[i]&&t.call(n,e[i],i,e)},implement:function(){for(var e=0;e<arguments.length;e++)"function"==typeof arguments[e]?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return String(this.valueOf())}}),wysihtml5.browser=function(){function e(e){return+(/ipad|iphone|ipod/.test(e)&&e.match(/ os (\d+).+? like mac os x/)||[,0])[1]}function t(e){return+(e.match(/android (\d+)/)||[,0])[1]}var n=navigator.userAgent,i=document.createElement("div"),r=-1!==n.indexOf("MSIE")&&-1===n.indexOf("Opera"),a=-1!==n.indexOf("Gecko")&&-1===n.indexOf("KHTML"),o=-1!==n.indexOf("AppleWebKit/"),s=-1!==n.indexOf("Chrome/"),c=-1!==n.indexOf("Opera/");return{USER_AGENT:n,supported:function(){var n=this.USER_AGENT.toLowerCase(),r="contentEditable"in i,a=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,o=document.querySelector&&document.querySelectorAll,s=this.isIos()&&e(n)<5||this.isAndroid()&&t(n)<4||-1!==n.indexOf("opera mobi")||-1!==n.indexOf("hpwos/");return r&&a&&o&&!s},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},supportsSandboxedIframes:function(){return r},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return r},hasCurrentStyleProperty:function(){return"currentStyle"in i},hasHistoryIssue:function(){return a},insertsLineBreaksOnReturn:function(){return a},supportsPlaceholderAttributeOn:function(e){return"placeholder"in e},supportsEvent:function(e){return"on"+e in i||function(){return i.setAttribute("on"+e,"return;"),"function"==typeof i["on"+e]}()},supportsEventsInIframeCorrectly:function(){return!c},supportsHTML5Tags:function(e){var t=e.createElement("div"),n="<article>foo</article>";return t.innerHTML=n,t.innerHTML.toLowerCase()===n},supportsCommand:function(){var e={formatBlock:r,insertUnorderedList:r||o,insertOrderedList:r||o},t={insertHTML:a};return function(n,i){var r=e[i];if(!r){try{return n.queryCommandSupported(i)}catch(a){}try{return n.queryCommandEnabled(i)}catch(o){return!!t[i]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return r},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return a||c||o},supportsGetAttributeCorrectly:function(){var e=document.createElement("td");return"1"!=e.getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return a||r||c},autoScrollsToCaret:function(){return!o},autoClosesUnclosedTags:function(){var e,t,n=i.cloneNode(!1);return n.innerHTML="<p><div></div>",t=n.innerHTML.toLowerCase(),e="<p></p><div></div>"===t||"<p><div></div></p>"===t,this.autoClosesUnclosedTags=function(){return e},e},supportsNativeGetElementsByClassName:function(){return-1!==String(document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return c},supportsSpeechApiOn:function(e){var t=n.match(/Chrome\/(\d+)/)||[,0];return t[1]>=11&&("onwebkitspeechchange"in e||"speech"in e)},crashesWhenDefineProperty:function(e){return r&&("XMLHttpRequest"===e||"XDomainRequest"===e)},doesAsyncFocus:function(){return r},hasProblemsSettingCaretAfterImg:function(){return r},hasUndoInContextMenu:function(){return a||s||c},hasInsertNodeIssue:function(){return c},hasIframeFocusIssue:function(){return r}}}(),wysihtml5.lang.array=function(e){return{contains:function(t){if(e.indexOf)return-1!==e.indexOf(t);for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return!0;return!1},without:function(t){t=wysihtml5.lang.array(t);for(var n=[],i=0,r=e.length;r>i;i++)t.contains(e[i])||n.push(e[i]);return n},get:function(){for(var t=0,n=e.length,i=[];n>t;t++)i.push(e[t]);return i}}},wysihtml5.lang.Dispatcher=Base.extend({on:function(e,t){return this.events=this.events||{},this.events[e]=this.events[e]||[],this.events[e].push(t),this},off:function(e,t){this.events=this.events||{};var n,i,r=0;if(e){for(n=this.events[e]||[],i=[];r<n.length;r++)n[r]!==t&&t&&i.push(n[r]);this.events[e]=i}else this.events={};return this},fire:function(e,t){this.events=this.events||{};for(var n=this.events[e]||[],i=0;i<n.length;i++)n[i].call(this,t);return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}}),wysihtml5.lang.object=function(e){return{merge:function(t){for(var n in t)e[n]=t[n];return this},get:function(){return e},clone:function(){var t,n={};for(t in e)n[t]=e[t];return n},isArray:function(){return"[object Array]"===Object.prototype.toString.call(e)}}},function(){var e=/^\s+/,t=/\s+$/;wysihtml5.lang.string=function(n){return n=String(n),{trim:function(){return n.replace(e,"").replace(t,"")},interpolate:function(e){for(var t in e)n=this.replace("#{"+t+"}").by(e[t]);return n},replace:function(e){return{by:function(t){return n.split(e).join(t)}}}}}}(),function(e){function t(e){return a(e)?e:(e===e.ownerDocument.documentElement&&(e=e.ownerDocument.body),o(e))}function n(e){return e.replace(c,function(e,t){var n=(t.match(d)||[])[1]||"",i=u[n];t=t.replace(d,""),t.split(i).length>t.split(n).length&&(t+=n,n="");var r=t,a=t;return t.length>l&&(a=a.substr(0,l)+"..."),"www."===r.substr(0,4)&&(r="http://"+r),'<a href="'+r+'">'+a+"</a>"+n})}function i(e){var t=e._wysihtml5_tempElement;return t||(t=e._wysihtml5_tempElement=e.createElement("div")),t}function r(e){var t=e.parentNode,r=i(t.ownerDocument);for(r.innerHTML="<span></span>"+n(e.data),r.removeChild(r.firstChild);r.firstChild;)t.insertBefore(r.firstChild,e);t.removeChild(e)}function a(e){for(var t;e.parentNode;){if(e=e.parentNode,t=e.nodeName,s.contains(t))return!0;if("body"===t)return!1}return!1}function o(t){if(!s.contains(t.nodeName)){if(t.nodeType===e.TEXT_NODE&&t.data.match(c))return void r(t);for(var n=e.lang.array(t.childNodes).get(),i=n.length,a=0;i>a;a++)o(n[a]);return t}}var s=e.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),c=/((https?:\/\/|www\.)[^\s<]{3,})/gi,d=/([^\w\/\-](,?))$/i,l=100,u={")":"(","]":"[","}":"{"};e.dom.autoLink=t,e.dom.autoLink.URL_REG_EXP=c}(wysihtml5),function(e){var t=e.dom;t.addClass=function(e,n){var i=e.classList;return i?i.add(n):void(t.hasClass(e,n)||(e.className+=" "+n))},t.removeClass=function(e,t){var n=e.classList;return n?n.remove(t):void(e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," "))},t.hasClass=function(e,t){var n=e.classList;if(n)return n.contains(t);var i=e.className;return i.length>0&&(i==t||new RegExp("(^|\\s)"+t+"(\\s|$)").test(i))}}(wysihtml5),wysihtml5.dom.contains=function(){var e=document.documentElement;return e.contains?function(e,t){return t.nodeType!==wysihtml5.ELEMENT_NODE&&(t=t.parentNode),e!==t&&e.contains(t)}:e.compareDocumentPosition?function(e,t){return!!(16&e.compareDocumentPosition(t))}:void 0}(),wysihtml5.dom.convertToList=function(){function e(e,t){var n=e.createElement("li");return t.appendChild(n),n}function t(e,t){return e.createElement(t)}function n(n,i){if("UL"===n.nodeName||"OL"===n.nodeName||"MENU"===n.nodeName)return n;var r,a,o,s,c,d,l,u,g,p=n.ownerDocument,f=t(p,i),m=n.querySelectorAll("br"),h=m.length;for(g=0;h>g;g++)for(s=m[g];(c=s.parentNode)&&c!==n&&c.lastChild===s;){if("block"===wysihtml5.dom.getStyle("display").from(c)){c.removeChild(s);break}wysihtml5.dom.insert(s).after(s.parentNode)}for(r=wysihtml5.lang.array(n.childNodes).get(),a=r.length,g=0;a>g;g++)u=u||e(p,f),o=r[g],d="block"===wysihtml5.dom.getStyle("display").from(o),l="BR"===o.nodeName,d?(u=u.firstChild?e(p,f):u,u.appendChild(o),u=null):l?u=u.firstChild?null:u:u.appendChild(o);return 0===r.length&&e(p,f),n.parentNode.replaceChild(f,n),f}return n}(),wysihtml5.dom.copyAttributes=function(e){return{from:function(t){return{to:function(n){for(var i,r=0,a=e.length;a>r;r++)i=e[r],"undefined"!=typeof t[i]&&""!==t[i]&&(n[i]=t[i]);return{andTo:arguments.callee}}}}}},function(e){var t=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],n=function(t){return i(t)?parseInt(e.getStyle("width").from(t),10)<t.offsetWidth:!1},i=function(n){for(var i=0,r=t.length;r>i;i++)if("border-box"===e.getStyle(t[i]).from(n))return t[i]};e.copyStyles=function(i){return{from:function(r){n(r)&&(i=wysihtml5.lang.array(i).without(t));for(var a,o="",s=i.length,c=0;s>c;c++)a=i[c],o+=a+":"+e.getStyle(a).from(r)+";";return{to:function(t){return e.setStyles(o).on(t),{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(e){e.dom.delegate=function(t,n,i,r){return e.dom.observe(t,i,function(i){for(var a=i.target,o=e.lang.array(t.querySelectorAll(n));a&&a!==t;){if(o.contains(a)){r.call(a,i);break}a=a.parentNode}})}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var e=function(e,t){var n=t.createElement("div");n.style.display="none",t.body.appendChild(n);try{n.innerHTML=e}catch(i){}return t.body.removeChild(n),n},t=function(e){if(!e._wysihtml5_supportsHTML5Tags){for(var t=0,i=n.length;i>t;t++)e.createElement(n[t]);e._wysihtml5_supportsHTML5Tags=!0}},n=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(n,i){i=i||document;var r;return"object"==typeof n&&n.nodeType?(r=i.createElement("div"),r.appendChild(n)):wysihtml5.browser.supportsHTML5Tags(i)?(r=i.createElement("div"),r.innerHTML=n):(t(i),r=e(n,i)),r}}(),wysihtml5.dom.getParentElement=function(){function e(e,t){return t&&t.length?"string"==typeof t?e===t:wysihtml5.lang.array(t).contains(e):!0}function t(e){return e.nodeType===wysihtml5.ELEMENT_NODE}function n(e,t,n){var i=(e.className||"").match(n)||[];return t?i[i.length-1]===t:!!i.length}function i(t,n,i){for(;i--&&t&&"BODY"!==t.nodeName;){if(e(t.nodeName,n))return t;t=t.parentNode}return null}function r(i,r,a,o,s){for(;s--&&i&&"BODY"!==i.nodeName;){if(t(i)&&e(i.nodeName,r)&&n(i,a,o))return i;i=i.parentNode}return null}return function(e,t,n){return n=n||50,t.className||t.classRegExp?r(e,t.nodeName,t.className,t.classRegExp,n):i(e,t.nodeName,n)}}(),wysihtml5.dom.getStyle=function(){function e(e){return e.replace(n,function(e){return e.charAt(1).toUpperCase()})}var t={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},n=/\-[a-z]/g;return function(n){return{from:function(i){if(i.nodeType===wysihtml5.ELEMENT_NODE){var r=i.ownerDocument,a=t[n]||e(n),o=i.style,s=i.currentStyle,c=o[a];if(c)return c;if(s)try{return s[a]}catch(d){}var l,u,g=r.defaultView||r.parentWindow,p=("height"===n||"width"===n)&&"TEXTAREA"===i.nodeName;return g.getComputedStyle?(p&&(l=o.overflow,o.overflow="hidden"),u=g.getComputedStyle(i,null).getPropertyValue(n),p&&(o.overflow=l||""),u):void 0}}}}}(),wysihtml5.dom.hasElementWithTagName=function(){function e(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=n++)}var t={},n=1;return function(n,i){var r=e(n)+":"+i,a=t[r];return a||(a=t[r]=n.getElementsByTagName(i)),a.length>0}}(),function(e){function t(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=i++)}var n={},i=1;e.dom.hasElementWithClassName=function(i,r){if(!e.browser.supportsNativeGetElementsByClassName())return!!i.querySelector("."+r);var a=t(i)+":"+r,o=n[a];return o||(o=n[a]=i.getElementsByClassName(r)),o.length>0}}(wysihtml5),wysihtml5.dom.insert=function(e){return{after:function(t){t.parentNode.insertBefore(e,t.nextSibling)},before:function(t){t.parentNode.insertBefore(e,t)},into:function(t){t.appendChild(e)}}},wysihtml5.dom.insertCSS=function(e){return e=e.join("\n"),{into:function(t){var n=t.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.appendChild(t.createTextNode(e));var i=t.querySelector("head link");if(i)return void i.parentNode.insertBefore(n,i);var r=t.querySelector("head");r&&r.appendChild(n)}}},wysihtml5.dom.observe=function(e,t,n){t="string"==typeof t?[t]:t;for(var i,r,a=0,o=t.length;o>a;a++)r=t[a],e.addEventListener?e.addEventListener(r,n,!1):(i=function(t){"target"in t||(t.target=t.srcElement),t.preventDefault=t.preventDefault||function(){this.returnValue=!1},t.stopPropagation=t.stopPropagation||function(){this.cancelBubble=!0},n.call(e,t)},e.attachEvent("on"+r,i));return{stop:function(){for(var r,a=0,o=t.length;o>a;a++)r=t[a],e.removeEventListener?e.removeEventListener(r,n,!1):e.detachEvent("on"+r,i)}}},wysihtml5.dom.parse=function(){function e(e,n,i,r){wysihtml5.lang.object(u).merge(l).merge(n).get(),i=i||e.ownerDocument||document;var a,o,s,c=i.createDocumentFragment(),d="string"==typeof e;for(a=d?wysihtml5.dom.getAsDom(e,i):e;a.firstChild;)s=a.firstChild,a.removeChild(s),o=t(s,r),o&&c.appendChild(o);return a.innerHTML="",a.appendChild(c),d?wysihtml5.quirks.getCorrectInnerHTML(a):a}function t(e,n){var i,r,a=e.nodeType,o=e.childNodes,d=o.length,l=s[a],u=0;if(i=l&&l(e),!i)return null;for(u=0;d>u;u++)r=t(o[u],n),r&&i.appendChild(r);return n&&i.childNodes.length<=1&&i.nodeName.toLowerCase()===c&&!i.attributes.length?i.firstChild:i}function n(e){var t,n,r=u.tags,a=e.nodeName.toLowerCase(),o=e.scopeName;if(e._wysihtml5)return null;if(e._wysihtml5=1,"wysihtml5-temp"===e.className)return null;if(o&&"HTML"!=o&&(a=o+":"+a),"outerHTML"in e&&(wysihtml5.browser.autoClosesUnclosedTags()||"P"!==e.nodeName||"</p>"===e.outerHTML.slice(-4).toLowerCase()||(a="div")),a in r){if(t=r[a],!t||t.remove)return null;t="string"==typeof t?{rename_tag:t}:t}else{if(!e.firstChild)return null;t={rename_tag:c}}return n=e.ownerDocument.createElement(t.rename_tag||a),i(e,n,t),e=null,n}function i(e,t,n){var i,a,o,s,c,l,g,m={},h=n.set_class,v=n.add_class,y=n.set_attributes,_=n.check_attributes,b=u.classes,w=0,C=[],x=[],S=[],E=[];if(y&&(m=wysihtml5.lang.object(y).clone()),_)for(c in _)g=p[_[c]],g&&(l=g(r(e,c)),"string"==typeof l&&(m[c]=l));if(h&&C.push(h),v)for(c in v)g=f[v[c]],g&&(s=g(r(e,c)),"string"==typeof s&&C.push(s));for(b["_wysihtml5-temp-placeholder"]=1,E=e.getAttribute("class"),E&&(C=C.concat(E.split(d))),i=C.length;i>w;w++)o=C[w],b[o]&&x.push(o);for(a=x.length;a--;)o=x[a],wysihtml5.lang.array(S).contains(o)||S.unshift(o);S.length&&(m["class"]=S.join(" "));for(c in m)try{t.setAttribute(c,m[c])}catch(N){}m.src&&("undefined"!=typeof m.width&&t.setAttribute("width",m.width),"undefined"!=typeof m.height&&t.setAttribute("height",m.height))}function r(e,t){t=t.toLowerCase();var n=e.nodeName;if("IMG"==n&&"src"==t&&a(e)===!0)return e.src;if(g&&"outerHTML"in e){var i=e.outerHTML.toLowerCase(),r=-1!=i.indexOf(" "+t+"=");return r?e.getAttribute(t):null}return e.getAttribute(t)}function a(e){try{return e.complete&&!e.mozMatchesSelector(":-moz-broken")}catch(t){if(e.complete&&"complete"===e.readyState)return!0}}function o(e){return e.ownerDocument.createTextNode(e.data)}var s={1:n,3:o},c="span",d=/\s+/,l={tags:{},classes:{}},u={},g=!wysihtml5.browser.supportsGetAttributeCorrectly(),p={url:function(){var e=/^https?:\/\//i;return function(t){return t&&t.match(e)?t.replace(e,function(e){return e.toLowerCase()}):null}}(),src:function(){var e=/^(\/|https?:\/\/)/i;return function(t){return t&&t.match(e)?t.replace(e,function(e){return e.toLowerCase()}):null}}(),href:function(){var e=/^(\/|https?:\/\/|mailto:)/i;return function(t){return t&&t.match(e)?t.replace(e,function(e){return e.toLowerCase()}):null}}(),alt:function(){var e=/[^ a-z0-9_\-]/gi;return function(t){return t?t.replace(e,""):""}}(),numbers:function(){var e=/\D/g;return function(t){return t=(t||"").replace(e,""),t||null}}()},f={align_img:function(){var e={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(t){return e[String(t).toLowerCase()]}}(),align_text:function(){var e={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(t){return e[String(t).toLowerCase()]}}(),clear_br:function(){var e={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(t){return e[String(t).toLowerCase()]}}(),size_font:function(){var e={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(t){return e[String(t).charAt(0)]}}()};return e}(),wysihtml5.dom.removeEmptyTextNodes=function(e){for(var t,n=wysihtml5.lang.array(e.childNodes).get(),i=n.length,r=0;i>r;r++)t=n[r],t.nodeType===wysihtml5.TEXT_NODE&&""===t.data&&t.parentNode.removeChild(t)},wysihtml5.dom.renameElement=function(e,t){for(var n,i=e.ownerDocument.createElement(t);n=e.firstChild;)i.appendChild(n);return wysihtml5.dom.copyAttributes(["align","className"]).from(e).to(i),e.parentNode.replaceChild(i,e),i},wysihtml5.dom.replaceWithChildNodes=function(e){if(e.parentNode){if(!e.firstChild)return void e.parentNode.removeChild(e);for(var t=e.ownerDocument.createDocumentFragment();e.firstChild;)t.appendChild(e.firstChild);e.parentNode.replaceChild(t,e),e=t=null}},function(e){function t(t){return"block"===e.getStyle("display").from(t)}function n(e){return"BR"===e.nodeName}function i(e){var t=e.ownerDocument.createElement("br");e.appendChild(t)}function r(e,r){if(e.nodeName.match(/^(MENU|UL|OL)$/)){var a,o,s,c,d,l,u=e.ownerDocument,g=u.createDocumentFragment(),p=e.previousElementSibling||e.previousSibling;if(r)for(p&&!t(p)&&i(g);l=e.firstElementChild||e.firstChild;){for(o=l.lastChild;a=l.firstChild;)s=a===o,c=s&&!t(a)&&!n(a),g.appendChild(a),c&&i(g);l.parentNode.removeChild(l)}else for(;l=e.firstElementChild||e.firstChild;){if(l.querySelector&&l.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))for(;a=l.firstChild;)g.appendChild(a);else{for(d=u.createElement("p");a=l.firstChild;)d.appendChild(a);g.appendChild(d)}l.parentNode.removeChild(l)}e.parentNode.replaceChild(g,e)}}e.resolveList=r}(wysihtml5.dom),function(e){var t=document,n=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],i=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],r=["referrer","write","open","close"];e.dom.Sandbox=Base.extend({constructor:function(t,n){this.callback=t||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(n).get(),this.iframe=this._createIframe()},insertInto:function(e){"string"==typeof e&&(e=t.getElementById(e)),e.appendChild(this.iframe)},getIframe:function(){return this.iframe},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var e=this.getIframe();e.parentNode.removeChild(e)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var n=this,i=t.createElement("iframe");return i.className="wysihtml5-sandbox",e.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(i),e.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(i.src="javascript:'<html></html>'"),i.onload=function(){i.onreadystatechange=i.onload=null,n._onLoadIframe(i)},i.onreadystatechange=function(){/loaded|complete/.test(i.readyState)&&(i.onreadystatechange=i.onload=null,n._onLoadIframe(i))},i},_onLoadIframe:function(a){if(e.dom.contains(t.documentElement,a)){var o=this,s=a.contentWindow,c=a.contentWindow.document,d=t.characterSet||t.charset||"utf-8",l=this._getHtml({charset:d,stylesheets:this.config.stylesheets});if(c.open("text/html","replace"),c.write(l),c.close(),this.getWindow=function(){return a.contentWindow},this.getDocument=function(){return a.contentWindow.document},s.onerror=function(e,t,n){throw new Error("wysihtml5.Sandbox: "+e,t,n)},!e.browser.supportsSandboxedIframes()){var u,g;for(u=0,g=n.length;g>u;u++)this._unset(s,n[u]);for(u=0,g=i.length;g>u;u++)this._unset(s,i[u],e.EMPTY_FUNCTION);for(u=0,g=r.length;g>u;u++)this._unset(c,r[u]);this._unset(c,"cookie","",!0)}this.loaded=!0,setTimeout(function(){o.callback(o)},0)}},_getHtml:function(t){var n,i=t.stylesheets,r="",a=0;if(i="string"==typeof i?[i]:i)for(n=i.length;n>a;a++)r+='<link rel="stylesheet" href="'+i[a]+'">';return t.stylesheets=r,e.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(t)},_unset:function(t,n,i,r){try{t[n]=i}catch(a){}try{t.__defineGetter__(n,function(){return i})}catch(a){}if(r)try{t.__defineSetter__(n,function(){})}catch(a){}if(!e.browser.crashesWhenDefineProperty(n))try{var o={get:function(){return i}};r&&(o.set=function(){}),Object.defineProperty(t,n,o)}catch(a){}}})}(wysihtml5),function(){var e={className:"class"};wysihtml5.dom.setAttributes=function(t){return{on:function(n){for(var i in t)n.setAttribute(e[i]||i,t[i])}}}}(),wysihtml5.dom.setStyles=function(e){return{on:function(t){var n=t.style;if("string"==typeof e)return void(n.cssText+=";"+e);for(var i in e)"float"===i?(n.cssFloat=e[i],n.styleFloat=e[i]):n[i]=e[i]}}},function(e){e.simulatePlaceholder=function(t,n,i){var r="placeholder",a=function(){n.hasPlaceholderSet()&&n.clear(),n.placeholderSet=!1,e.removeClass(n.element,r)},o=function(){n.isEmpty()&&(n.placeholderSet=!0,n.setValue(i),e.addClass(n.element,r))};t.on("set_placeholder",o).on("unset_placeholder",a).on("focus:composer",a).on("paste:composer",a).on("blur:composer",o),o()}}(wysihtml5.dom),function(e){var t=document.documentElement;"textContent"in t?(e.setTextContent=function(e,t){e.textContent=t},e.getTextContent=function(e){return e.textContent}):"innerText"in t?(e.setTextContent=function(e,t){e.innerText=t},e.getTextContent=function(e){return e.innerText}):(e.setTextContent=function(e,t){e.nodeValue=t},e.getTextContent=function(e){return e.nodeValue})}(wysihtml5.dom),wysihtml5.quirks.cleanPastedHTML=function(){function e(e,n,i){n=n||t,i=i||e.ownerDocument||document;var r,a,o,s,c,d="string"==typeof e,l=0;r=d?wysihtml5.dom.getAsDom(e,i):e;for(c in n)for(o=r.querySelectorAll(c),a=n[c],s=o.length;s>l;l++)a(o[l]);return o=e=n=null,d?r.innerHTML:r}var t={"a u":wysihtml5.dom.replaceWithChildNodes};return e}(),wysihtml5.quirks.ensureProperClearing=function(){var e=function(){var e=this;setTimeout(function(){var t=e.innerHTML.toLowerCase();("<p>&nbsp;</p>"==t||"<p>&nbsp;</p><p>&nbsp;</p>"==t)&&(e.innerHTML="")},0)};return function(t){wysihtml5.dom.observe(t.element,["cut","keydown"],e)}}(),function(e){var t="%7E";e.quirks.getCorrectInnerHTML=function(n){var i=n.innerHTML;if(-1===i.indexOf(t))return i;var r,a,o,s,c=n.querySelectorAll("[href*='~'], [src*='~']");for(s=0,o=c.length;o>s;s++)r=c[s].href||c[s].src,a=e.lang.string(r).replace("~").by(t),i=e.lang.string(i).replace(a).by(r);return i}}(wysihtml5),function(e){var t="wysihtml5-quirks-redraw";e.quirks.redraw=function(n){e.dom.addClass(n,t),e.dom.removeClass(n,t);try{var i=n.ownerDocument;i.execCommand("italic",!1,null),i.execCommand("italic",!1,null)}catch(r){}}}(wysihtml5),function(e){function t(e){var t=0;if(e.parentNode)do t+=e.offsetTop||0,e=e.offsetParent;while(e);return t}var n=e.dom;e.Selection=Base.extend({constructor:function(e){window.rangy.init(),this.editor=e,this.composer=e.composer,this.doc=this.composer.doc},getBookmark:function(){var e=this.getRange();return e&&e.cloneRange()},setBookmark:function(e){e&&this.setSelection(e)},setBefore:function(e){var t=rangy.createRange(this.doc);return t.setStartBefore(e),t.setEndBefore(e),this.setSelection(t)},setAfter:function(e){var t=rangy.createRange(this.doc);return t.setStartAfter(e),t.setEndAfter(e),this.setSelection(t)},selectNode:function(t,i){var r=rangy.createRange(this.doc),a=t.nodeType===e.ELEMENT_NODE,o="canHaveHTML"in t?t.canHaveHTML:"IMG"!==t.nodeName,s=a?t.innerHTML:t.data,c=""===s||s===e.INVISIBLE_SPACE,d=n.getStyle("display").from(t),l="block"===d||"list-item"===d;if(c&&a&&o&&!i)try{t.innerHTML=e.INVISIBLE_SPACE}catch(u){}o?r.selectNodeContents(t):r.selectNode(t),o&&c&&a?r.collapse(l):o&&c&&(r.setStartAfter(t),r.setEndAfter(t)),this.setSelection(r)},getSelectedNode:function(e){var t,n;return e&&this.doc.selection&&"Control"===this.doc.selection.type&&(n=this.doc.selection.createRange(),n&&n.length)?n.item(0):(t=this.getSelection(this.doc),t.focusNode===t.anchorNode?t.focusNode:(n=this.getRange(this.doc),n?n.commonAncestorContainer:this.doc.body))},executeAndRestore:function(t,i){var r,a,o,s,c,d=this.doc.body,l=i&&d.scrollTop,u=i&&d.scrollLeft,g="_wysihtml5-temp-placeholder",p='<span class="'+g+'">'+e.INVISIBLE_SPACE+"</span>",f=this.getRange(this.doc);if(!f)return void t(d,d);e.browser.hasInsertNodeIssue()?this.doc.execCommand("insertHTML",!1,p):(s=f.createContextualFragment(p),f.insertNode(s));try{t(f.startContainer,f.endContainer)}catch(m){setTimeout(function(){throw m},0)}r=this.doc.querySelector("."+g),r?(c=rangy.createRange(this.doc),o=r.nextSibling,e.browser.hasInsertNodeIssue()&&o&&"BR"===o.nodeName?(a=this.doc.createTextNode(e.INVISIBLE_SPACE),n.insert(a).after(r),c.setStartBefore(a),c.setEndBefore(a)):(c.selectNode(r),c.deleteContents()),this.setSelection(c)):d.focus(),i&&(d.scrollTop=l,d.scrollLeft=u);try{r.parentNode.removeChild(r)}catch(h){}},executeAndRestoreSimple:function(e){var t,n,i,r,a,o=this.getRange(),s=this.doc.body;if(!o)return void e(s,s);r=o.getNodes([3]),n=r[0]||o.startContainer,i=r[r.length-1]||o.endContainer,a={collapsed:o.collapsed,startContainer:n,startOffset:n===o.startContainer?o.startOffset:0,endContainer:i,endOffset:i===o.endContainer?o.endOffset:i.length};try{e(o.startContainer,o.endContainer)}catch(c){setTimeout(function(){throw c},0)}t=rangy.createRange(this.doc);try{t.setStart(a.startContainer,a.startOffset)}catch(d){}try{t.setEnd(a.endContainer,a.endOffset)}catch(l){}try{this.setSelection(t)}catch(u){}},set:function(e,t){var n=rangy.createRange(this.doc);n.setStart(e,t||0),this.setSelection(n)},insertHTML:function(e){var t=rangy.createRange(this.doc),n=t.createContextualFragment(e),i=n.lastChild;this.insertNode(n),i&&this.setAfter(i)},insertNode:function(e){var t=this.getRange();t&&t.insertNode(e)},surround:function(e){var t=this.getRange();if(t)try{t.surroundContents(e),this.selectNode(e)}catch(n){e.appendChild(t.extractContents()),t.insertNode(e)}},scrollIntoView:function(){var n,i=this.doc,r=5,a=i.documentElement.scrollHeight>i.documentElement.offsetHeight,o=i._wysihtml5ScrollIntoViewElement=i._wysihtml5ScrollIntoViewElement||function(){var t=i.createElement("span");return t.innerHTML=e.INVISIBLE_SPACE,t}();a&&(this.insertNode(o),n=t(o),o.parentNode.removeChild(o),n>=i.body.scrollTop+i.documentElement.offsetHeight-r&&(i.body.scrollTop=n))},selectLine:function(){e.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var e=this.doc.defaultView,t=e.getSelection();t.modify("extend","left","lineboundary"),t.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var e,t,n,i,r,a=this.doc.selection.createRange(),o=a.boundingTop,s=this.doc.body.scrollWidth;if(a.moveToPoint){for(0===o&&(n=this.doc.createElement("span"),this.insertNode(n),o=n.offsetTop,n.parentNode.removeChild(n)),o+=1,i=-10;s>i;i+=2)try{a.moveToPoint(i,o);break}catch(c){}for(e=o,t=this.doc.selection.createRange(),r=s;r>=0;r--)try{t.moveToPoint(r,e);break}catch(d){}a.setEndPoint("EndToEnd",t),a.select()}},getText:function(){var e=this.getSelection();return e?e.toString():""},getNodes:function(e,t){var n=this.getRange();return n?n.getNodes([e],t):[]},getRange:function(){var e=this.getSelection();return e&&e.rangeCount&&e.getRangeAt(0)},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(e){var t=this.doc.defaultView||this.doc.parentWindow,n=rangy.getSelection(t);return n.setSingleRange(e)}})}(wysihtml5),function(e,t){function n(e,t,n){if(!e.className)return!1;var i=e.className.match(n)||[];return i[i.length-1]===t}function i(e,t,n){e.className?(r(e,n),e.className+=" "+t):e.className=t}function r(e,t){e.className&&(e.className=e.className.replace(t,""))}function a(e,t){return e.className.replace(p," ")==t.className.replace(p," ")}function o(e){for(var t=e.parentNode;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)}function s(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n,i,r,a=0,o=e.attributes.length;o>a;++a)if(n=e.attributes[a],r=n.name,"class"!=r){if(i=t.attributes.getNamedItem(r),n.specified!=i.specified)return!1;if(n.specified&&n.nodeValue!==i.nodeValue)return!1}return!0}function c(e,n){return t.dom.isCharacterDataNode(e)?0==n?!!e.previousSibling:n==e.length?!!e.nextSibling:!0:n>0&&n<e.childNodes.length}function d(e,n,i){var r;if(t.dom.isCharacterDataNode(n)&&(0==i?(i=t.dom.getNodeIndex(n),n=n.parentNode):i==n.length?(i=t.dom.getNodeIndex(n)+1,n=n.parentNode):r=t.dom.splitDataNode(n,i)),!r){r=n.cloneNode(!1),r.id&&r.removeAttribute("id");for(var a;a=n.childNodes[i];)r.appendChild(a);t.dom.insertAfter(r,n)}return n==e?r:d(e,r.parentNode,t.dom.getNodeIndex(r))}function l(t){this.isElementMerge=t.nodeType==e.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?t.lastChild:t,this.textNodes=[this.firstTextNode]}function u(e,t,n,i){this.tagNames=e||[g],this.cssClass=t||"",this.similarClassRegExp=n,this.normalize=i,this.applyToAnyTagName=!1}var g="span",p=/\s+/g;l.prototype={doMerge:function(){for(var e,t,n,i=[],r=0,a=this.textNodes.length;a>r;++r)e=this.textNodes[r],t=e.parentNode,i[r]=e.data,r&&(t.removeChild(e),t.hasChildNodes()||t.parentNode.removeChild(t));return this.firstTextNode.data=n=i.join(""),n},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){for(var e=[],t=0,n=this.textNodes.length;n>t;++t)e[t]="'"+this.textNodes[t].data+"'";return"[Merge("+e.join(",")+")]"}},u.prototype={getAncestorWithClass:function(i){for(var r;i;){if(r=this.cssClass?n(i,this.cssClass,this.similarClassRegExp):!0,i.nodeType==e.ELEMENT_NODE&&t.dom.arrayContains(this.tagNames,i.tagName.toLowerCase())&&r)return i;i=i.parentNode}return!1},postApply:function(e,t){for(var n,i,r,a=e[0],o=e[e.length-1],s=[],c=a,d=o,u=0,g=o.length,p=0,f=e.length;f>p;++p)i=e[p],r=this.getAdjacentMergeableTextNode(i.parentNode,!1),r?(n||(n=new l(r),s.push(n)),n.textNodes.push(i),i===a&&(c=n.firstTextNode,u=c.length),i===o&&(d=n.firstTextNode,g=n.getLength())):n=null;var m=this.getAdjacentMergeableTextNode(o.parentNode,!0);if(m&&(n||(n=new l(o),s.push(n)),n.textNodes.push(m)),s.length){for(p=0,f=s.length;f>p;++p)s[p].doMerge();t.setStart(c,u),t.setEnd(d,g)}},getAdjacentMergeableTextNode:function(t,n){var i,r=t.nodeType==e.TEXT_NODE,a=r?t.parentNode:t,o=n?"nextSibling":"previousSibling";if(r){if(i=t[o],i&&i.nodeType==e.TEXT_NODE)return i}else if(i=a[o],i&&this.areElementsMergeable(t,i))return i[n?"firstChild":"lastChild"];return null},areElementsMergeable:function(e,n){return t.dom.arrayContains(this.tagNames,(e.tagName||"").toLowerCase())&&t.dom.arrayContains(this.tagNames,(n.tagName||"").toLowerCase())&&a(e,n)&&s(e,n)},createContainer:function(e){var t=e.createElement(this.tagNames[0]);return this.cssClass&&(t.className=this.cssClass),t},applyToTextNode:function(e){var n=e.parentNode;if(1==n.childNodes.length&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase()))this.cssClass&&i(n,this.cssClass,this.similarClassRegExp);else{var r=this.createContainer(t.dom.getDocument(e));e.parentNode.insertBefore(r,e),r.appendChild(e)}},isRemovable:function(n){return t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&e.lang.string(n.className).trim()==this.cssClass},undoToTextNode:function(e,t,n){if(!t.containsNode(n)){var i=t.cloneRange();i.selectNode(n),i.isPointInRange(t.endContainer,t.endOffset)&&c(t.endContainer,t.endOffset)&&(d(n,t.endContainer,t.endOffset),t.setEndAfter(n)),i.isPointInRange(t.startContainer,t.startOffset)&&c(t.startContainer,t.startOffset)&&(n=d(n,t.startContainer,t.startOffset))}this.similarClassRegExp&&r(n,this.similarClassRegExp),this.isRemovable(n)&&o(n)},applyToRange:function(t){var n=t.getNodes([e.TEXT_NODE]);if(!n.length)try{var i=this.createContainer(t.endContainer.ownerDocument);return t.surroundContents(i),void this.selectNode(t,i)}catch(r){}if(t.splitBoundaries(),n=t.getNodes([e.TEXT_NODE]),n.length){for(var a,o=0,s=n.length;s>o;++o)a=n[o],this.getAncestorWithClass(a)||this.applyToTextNode(a);t.setStart(n[0],0),a=n[n.length-1],t.setEnd(a,a.length),this.normalize&&this.postApply(n,t)}},undoToRange:function(t){var n,i,r=t.getNodes([e.TEXT_NODE]);if(r.length)t.splitBoundaries(),r=t.getNodes([e.TEXT_NODE]);else{var a=t.endContainer.ownerDocument,o=a.createTextNode(e.INVISIBLE_SPACE);t.insertNode(o),t.selectNode(o),r=[o]}for(var s=0,c=r.length;c>s;++s)n=r[s],i=this.getAncestorWithClass(n),i&&this.undoToTextNode(n,t,i);1==c?this.selectNode(t,r[0]):(t.setStart(r[0],0),n=r[r.length-1],t.setEnd(n,n.length),this.normalize&&this.postApply(r,t))},selectNode:function(t,n){var i=n.nodeType===e.ELEMENT_NODE,r="canHaveHTML"in n?n.canHaveHTML:!0,a=i?n.innerHTML:n.data,o=""===a||a===e.INVISIBLE_SPACE;if(o&&i&&r)try{n.innerHTML=e.INVISIBLE_SPACE}catch(s){}t.selectNodeContents(n),o&&i?t.collapse(!1):o&&(t.setStartAfter(n),t.setEndAfter(n))},getTextSelectedByRange:function(e,t){var n=t.cloneRange();n.selectNodeContents(e);var i=n.intersection(t),r=i?i.toString():"";return n.detach(),r},isAppliedToRange:function(t){var n,i=[],r=t.getNodes([e.TEXT_NODE]);if(!r.length)return n=this.getAncestorWithClass(t.startContainer),n?[n]:!1;for(var a,o=0,s=r.length;s>o;++o){if(a=this.getTextSelectedByRange(r[o],t),n=this.getAncestorWithClass(r[o]),""!=a&&!n)return!1;i.push(n)}return i},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)}},e.selection.HTMLApplier=u}(wysihtml5,rangy),wysihtml5.Commands=Base.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.doc=this.composer.doc},support:function(e){return wysihtml5.browser.supportsCommand(this.doc,e)},exec:function(e,t){var n=wysihtml5.commands[e],i=wysihtml5.lang.array(arguments).get(),r=n&&n.exec,a=null;if(this.editor.fire("beforecommand:composer"),r)i.unshift(this.composer),a=r.apply(n,i);else try{a=this.doc.execCommand(e,!1,t)}catch(o){}return this.editor.fire("aftercommand:composer"),a},state:function(e,t){var n=wysihtml5.commands[e],i=wysihtml5.lang.array(arguments).get(),r=n&&n.state;if(r)return i.unshift(this.composer),r.apply(n,i);try{return this.doc.queryCommandState(e)}catch(a){return!1}}}),wysihtml5.commands.bold={exec:function(e,t){return wysihtml5.commands.formatInline.exec(e,t,"b")},state:function(e,t){return wysihtml5.commands.formatInline.state(e,t,"b")}},function(e){function t(e,t){for(var n,i,r,o=t.length,s=0;o>s;s++)n=t[s],i=a.getParentElement(n,{nodeName:"code"}),r=a.getTextContent(n),r.match(a.autoLink.URL_REG_EXP)&&!i?i=a.renameElement(n,"code"):a.replaceWithChildNodes(n)}function n(t,n){var o,s,c,d,l,u,g,p,f,m=t.doc,h="_wysihtml5-temp-"+ +new Date,v=/non-matching-class/g,y=0;for(e.commands.formatInline.exec(t,i,r,h,v),s=m.querySelectorAll(r+"."+h),o=s.length;o>y;y++){c=s[y],c.removeAttribute("class");for(f in n)c.setAttribute(f,n[f])}u=c,1===o&&(g=a.getTextContent(c),d=!!c.querySelector("*"),l=""===g||g===e.INVISIBLE_SPACE,!d&&l&&(a.setTextContent(c,n.text||c.href),p=m.createTextNode(" "),t.selection.setAfter(c),a.insert(p).after(c),u=p)),t.selection.setAfter(u)}var i,r="A",a=e.dom;e.commands.createLink={exec:function(e,i,r){var a=this.state(e,i);a?e.selection.executeAndRestore(function(){t(e,a)}):(r="object"==typeof r?r:{href:r},n(e,r))},state:function(t,n){return e.commands.formatInline.state(t,n,"A")}}}(wysihtml5),function(e){var t,n=/wysiwyg-font-size-[0-9a-z\-]+/g;e.commands.fontSize={exec:function(t,i,r){return e.commands.formatInline.exec(t,i,"span","wysiwyg-font-size-"+r,n)},state:function(t,i,r){return e.commands.formatInline.state(t,i,"span","wysiwyg-font-size-"+r,n)},value:function(){return t}}}(wysihtml5),function(e){var t=/wysiwyg-color-[0-9a-z]+/g;e.commands.foreColor={exec:function(n,i,r){return e.commands.formatInline.exec(n,i,"span","wysiwyg-color-"+r,t)},state:function(n,i,r){return e.commands.formatInline.state(n,i,"span","wysiwyg-color-"+r,t)}}}(wysihtml5),function(e){function t(e,t,i){e.className?(n(e,i),e.className+=" "+t):e.className=t}function n(e,t){e.className=e.className.replace(t,"")}function i(t){return t.nodeType===e.TEXT_NODE&&!e.lang.string(t.data).trim()}function r(e){for(var t=e.previousSibling;t&&i(t);)t=t.previousSibling;return t}function a(e){for(var t=e.nextSibling;t&&i(t);)t=t.nextSibling;return t}function o(e){var t=e.ownerDocument,n=a(e),i=r(e);n&&!l(n)&&e.parentNode.insertBefore(t.createElement("br"),n),i&&!l(i)&&e.parentNode.insertBefore(t.createElement("br"),e)}function s(e){var t=a(e),n=r(e);t&&d(t)&&t.parentNode.removeChild(t),n&&d(n)&&n.parentNode.removeChild(n)}function c(e){var t=e.lastChild;t&&d(t)&&t.parentNode.removeChild(t)}function d(e){return"BR"===e.nodeName}function l(e){return d(e)?!0:"block"===f.getStyle("display").from(e)?!0:!1}function u(t,n,i,r){if(r)var a=f.observe(t,"DOMNodeInserted",function(t){var n,i=t.target;i.nodeType===e.ELEMENT_NODE&&(n=f.getStyle("display").from(i),"inline"!==n.substr(0,6)&&(i.className+=" "+r))});t.execCommand(n,!1,i),a&&a.stop()}function g(t,n){t.selection.selectLine(),t.selection.surround(n),s(n),c(n),t.selection.selectNode(n,e.browser.displaysCaretInEmptyContentEditableCorrectly())}function p(t){return!!e.lang.string(t.className).trim()}var f=e.dom,m=["H1","H2","H3","H4","H5","H6","P","BLOCKQUOTE","DIV"];e.commands.formatBlock={exec:function(i,r,a,s,c){var d,l=i.doc,h=this.state(i,r,a,s,c),v=i.config.useLineBreaks,y=v?"DIV":"P";return a="string"==typeof a?a.toUpperCase():a,h?void i.selection.executeAndRestoreSimple(function(){c&&n(h,c);var e=p(h);e||!v&&"P"!==a?f.renameElement(h,"P"===a?"DIV":y):(o(h),f.replaceWithChildNodes(h))}):(null===a||e.lang.array(m).contains(a))&&(d=i.selection.getSelectedNode(),h=f.getParentElement(d,{nodeName:m}))?void i.selection.executeAndRestore(function(){a&&(h=f.renameElement(h,a)),s&&t(h,s,c)}):i.commands.support(r)?void u(l,r,a||y,s):(h=l.createElement(a||y),s&&(h.className=s),void g(i,h))},state:function(e,t,n,i,r){n="string"==typeof n?n.toUpperCase():n;var a=e.selection.getSelectedNode();return f.getParentElement(a,{nodeName:n,className:i,classRegExp:r})}}}(wysihtml5),function(e){function t(e){var t=i[e];return t?[e.toLowerCase(),t.toLowerCase()]:[e.toLowerCase()]}function n(n,i,a){var o=n+":"+i;return r[o]||(r[o]=new e.selection.HTMLApplier(t(n),i,a,!0)),r[o]}var i={strong:"b",em:"i",b:"strong",i:"em"},r={};e.commands.formatInline={exec:function(e,t,i,r,a){var o=e.selection.getRange();return o?(n(i,r,a).toggleRange(o),void e.selection.setSelection(o)):!1},state:function(t,r,a,o,s){var c,d=t.doc,l=i[a]||a;return e.dom.hasElementWithTagName(d,a)||e.dom.hasElementWithTagName(d,l)?o&&!e.dom.hasElementWithClassName(d,o)?!1:(c=t.selection.getRange(),c?n(a,o,s).isAppliedToRange(c):!1):!1}}}(wysihtml5),wysihtml5.commands.insertHTML={exec:function(e,t,n){e.commands.support(t)?e.doc.execCommand(t,!1,n):e.selection.insertHTML(n)},state:function(){return!1}},function(e){var t="IMG";e.commands.insertImage={exec:function(n,i,r){r="object"==typeof r?r:{src:r};var a,o,s,c=n.doc,d=this.state(n);if(d)return n.selection.setBefore(d),s=d.parentNode,s.removeChild(d),e.dom.removeEmptyTextNodes(s),"A"!==s.nodeName||s.firstChild||(n.selection.setAfter(s),s.parentNode.removeChild(s)),void e.quirks.redraw(n.element);d=c.createElement(t);for(o in r)"className"===o&&(o="class"),d.setAttribute(o,r[o]);n.selection.insertNode(d),e.browser.hasProblemsSettingCaretAfterImg()?(a=c.createTextNode(e.INVISIBLE_SPACE),n.selection.insertNode(a),n.selection.setAfter(a)):n.selection.setAfter(d)},state:function(n){var i,r,a,o=n.doc;return e.dom.hasElementWithTagName(o,t)&&(i=n.selection.getSelectedNode())?i.nodeName===t?i:i.nodeType!==e.ELEMENT_NODE?!1:(r=n.selection.getText(),(r=e.lang.string(r).trim())?!1:(a=n.selection.getNodes(e.ELEMENT_NODE,function(e){return"IMG"===e.nodeName}),1!==a.length?!1:a[0])):!1}}}(wysihtml5),function(e){var t="<br>"+(e.browser.needsSpaceAfterLineBreak()?" ":"");e.commands.insertLineBreak={exec:function(n,i){n.commands.support(i)?(n.doc.execCommand(i,!1,null),e.browser.autoScrollsToCaret()||n.selection.scrollIntoView()):n.commands.exec("insertHTML",t)},state:function(){return!1}}}(wysihtml5),wysihtml5.commands.insertOrderedList={exec:function(e,t){var n,i,r=e.doc,a=e.selection.getSelectedNode(),o=wysihtml5.dom.getParentElement(a,{nodeName:"OL"}),s=wysihtml5.dom.getParentElement(a,{nodeName:"UL"}),c="_wysihtml5-temp-"+(new Date).getTime();return o||s||!e.commands.support(t)?void(o?e.selection.executeAndRestore(function(){wysihtml5.dom.resolveList(o,e.config.useLineBreaks)}):s?e.selection.executeAndRestore(function(){wysihtml5.dom.renameElement(s,"ol")}):(e.commands.exec("formatBlock","div",c),i=r.querySelector("."+c),n=""===i.innerHTML||i.innerHTML===wysihtml5.INVISIBLE_SPACE||"<br>"===i.innerHTML,e.selection.executeAndRestore(function(){o=wysihtml5.dom.convertToList(i,"ol")}),n&&e.selection.selectNode(o.querySelector("li"),!0))):void r.execCommand(t,!1,null)},state:function(e){var t=e.selection.getSelectedNode();return wysihtml5.dom.getParentElement(t,{nodeName:"OL"})}},wysihtml5.commands.insertUnorderedList={exec:function(e,t){var n,i,r=e.doc,a=e.selection.getSelectedNode(),o=wysihtml5.dom.getParentElement(a,{nodeName:"UL"}),s=wysihtml5.dom.getParentElement(a,{nodeName:"OL"}),c="_wysihtml5-temp-"+(new Date).getTime();return o||s||!e.commands.support(t)?void(o?e.selection.executeAndRestore(function(){wysihtml5.dom.resolveList(o,e.config.useLineBreaks)}):s?e.selection.executeAndRestore(function(){wysihtml5.dom.renameElement(s,"ul")}):(e.commands.exec("formatBlock","div",c),i=r.querySelector("."+c),n=""===i.innerHTML||i.innerHTML===wysihtml5.INVISIBLE_SPACE||"<br>"===i.innerHTML,e.selection.executeAndRestore(function(){o=wysihtml5.dom.convertToList(i,"ul")}),n&&e.selection.selectNode(o.querySelector("li"),!0))):void r.execCommand(t,!1,null)},state:function(e){var t=e.selection.getSelectedNode();return wysihtml5.dom.getParentElement(t,{nodeName:"UL"})}},wysihtml5.commands.italic={exec:function(e,t){return wysihtml5.commands.formatInline.exec(e,t,"i")},state:function(e,t){return wysihtml5.commands.formatInline.state(e,t,"i")}},function(e){var t="wysiwyg-text-align-center",n=/wysiwyg-text-align-[0-9a-z]+/g;e.commands.justifyCenter={exec:function(i,r){return e.commands.formatBlock.exec(i,"formatBlock",null,t,n)},state:function(i,r){return e.commands.formatBlock.state(i,"formatBlock",null,t,n)}}}(wysihtml5),function(e){var t="wysiwyg-text-align-left",n=/wysiwyg-text-align-[0-9a-z]+/g;e.commands.justifyLeft={exec:function(i,r){return e.commands.formatBlock.exec(i,"formatBlock",null,t,n)},state:function(i,r){return e.commands.formatBlock.state(i,"formatBlock",null,t,n)}}}(wysihtml5),function(e){var t="wysiwyg-text-align-right",n=/wysiwyg-text-align-[0-9a-z]+/g;e.commands.justifyRight={exec:function(i,r){return e.commands.formatBlock.exec(i,"formatBlock",null,t,n)},state:function(i,r){return e.commands.formatBlock.state(i,"formatBlock",null,t,n)}}}(wysihtml5),function(e){var t="wysiwyg-text-align-justify",n=/wysiwyg-text-align-[0-9a-z]+/g;e.commands.justifyFull={exec:function(i,r){return e.commands.formatBlock.exec(i,"formatBlock",null,t,n)},state:function(i,r){return e.commands.formatBlock.state(i,"formatBlock",null,t,n)}}}(wysihtml5),wysihtml5.commands.redo={exec:function(e){return e.undoManager.redo()},state:function(e){return!1}},wysihtml5.commands.underline={exec:function(e,t){return wysihtml5.commands.formatInline.exec(e,t,"u")},state:function(e,t){return wysihtml5.commands.formatInline.state(e,t,"u")}},wysihtml5.commands.undo={exec:function(e){return e.undoManager.undo()},state:function(e){return!1}},function(e){function t(e){for(var t;t=e.querySelector("._wysihtml5-temp");)t.parentNode.removeChild(t)}var n=90,i=89,r=8,a=46,o=25,s="data-wysihtml5-selection-node",c="data-wysihtml5-selection-offset",d='<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",l='<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",u=e.dom;e.UndoManager=e.lang.Dispatcher.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.element=this.composer.element,this.position=0,this.historyStr=[],this.historyDom=[],this.transact(),this._observe()},_observe:function(){var o,s=this,c=this.composer.sandbox.getDocument();if(u.observe(this.element,"keydown",function(e){if(!e.altKey&&(e.ctrlKey||e.metaKey)){var t=e.keyCode,r=t===n&&!e.shiftKey,a=t===n&&e.shiftKey||t===i;r?(s.undo(),e.preventDefault()):a&&(s.redo(),e.preventDefault())}}),u.observe(this.element,"keydown",function(e){var t=e.keyCode;t!==o&&(o=t,(t===r||t===a)&&s.transact())}),e.browser.hasUndoInContextMenu()){var g,p,f=function(){t(c),clearInterval(g)};u.observe(this.element,"contextmenu",function(){f(),s.composer.selection.executeAndRestoreSimple(function(){s.element.lastChild&&s.composer.selection.setAfter(s.element.lastChild),c.execCommand("insertHTML",!1,d),c.execCommand("insertHTML",!1,l),c.execCommand("undo",!1,null)}),g=setInterval(function(){c.getElementById("_wysihtml5-redo")?(f(),s.redo()):c.getElementById("_wysihtml5-undo")||(f(),s.undo())},400),p||(p=!0,u.observe(document,"mousedown",f),u.observe(c,["mousedown","paste","cut","copy"],f))})}this.editor.on("newword:composer",function(){s.transact()}).on("beforecommand:composer",function(){s.transact()})},transact:function(){var t=this.historyStr[this.position-1],n=this.composer.getValue();if(n!==t){var i=this.historyStr.length=this.historyDom.length=this.position;i>o&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++;var r,a,d=this.composer.selection.getRange(),l=d.startContainer||this.element,u=d.startOffset||0;l.nodeType===e.ELEMENT_NODE?r=l:(r=l.parentNode,a=this.getChildNodeIndex(r,l)),r.setAttribute(c,u),"undefined"!=typeof a&&r.setAttribute(s,a);var g=this.element.cloneNode(!!n);this.historyDom.push(g),this.historyStr.push(n),r.removeAttribute(c),r.removeAttribute(s)}},undo:function(){this.transact(),this.undoPossible()&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return this.position>1},redoPossible:function(){return this.position<this.historyStr.length},set:function(e){this.element.innerHTML="";for(var t=0,n=e.childNodes,i=e.childNodes.length;i>t;t++)this.element.appendChild(n[t].cloneNode(!0));var r,a,o;e.hasAttribute(c)?(r=e.getAttribute(c),o=e.getAttribute(s),a=this.element):(a=this.element.querySelector("["+c+"]")||this.element,r=a.getAttribute(c),o=a.getAttribute(s),a.removeAttribute(c),a.removeAttribute(s)),null!==o&&(a=this.getChildNodeByIndex(a,+o)),this.composer.selection.set(a,r)},getChildNodeIndex:function(e,t){for(var n=0,i=e.childNodes,r=i.length;r>n;n++)if(i[n]===t)return n},getChildNodeByIndex:function(e,t){return e.childNodes[t]}})}(wysihtml5),wysihtml5.views.View=Base.extend({constructor:function(e,t,n){this.parent=e,this.element=t,this.config=n,this._observeViewChange()},_observeViewChange:function(){var e=this;this.parent.on("beforeload",function(){e.parent.on("change_view",function(t){t===e.name?(e.parent.currentView=e,e.show(),setTimeout(function(){e.focus()},0)):e.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(e){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(e){var t=e.dom,n=e.browser;e.views.Composer=e.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(e,t,n){this.base(e,t,n),this.textarea=this.parent.textarea,this._initSandbox()},clear:function(){this.element.innerHTML=n.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(t){var n=this.isEmpty()?"":e.quirks.getCorrectInnerHTML(this.element);return t&&(n=this.parent.parse(n)),n=e.lang.string(n).replace(e.INVISIBLE_SPACE).by("")},setValue:function(e,t){t&&(e=this.parent.parse(e));try{this.element.innerHTML=e}catch(n){this.element.innerText=e}},show:function(){this.iframe.style.display=this._displayStyle||"",this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=t.getStyle("display").from(this.iframe),"none"===this._displayStyle&&(this._displayStyle=null),this.iframe.style.display="none"},disable:function(){this.parent.fire("disable:composer"),this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer"),this.element.setAttribute("contentEditable","true")},focus:function(t){e.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var n=this.element.lastChild;t&&n&&("BR"===n.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return t.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==this.textarea.element.getAttribute("placeholder")&&this.placeholderSet},isEmpty:function(){var e=this.element.innerHTML.toLowerCase();return""===e||"<br>"===e||"<p></p>"===e||"<p><br></p>"===e||this.hasPlaceholderSet()},_initSandbox:function(){var e=this;this.sandbox=new t.Sandbox(function(){e._create()},{stylesheets:this.config.stylesheets}),this.iframe=this.sandbox.getIframe();var n=this.textarea.element;if(t.insert(this.iframe).after(n),n.form){var i=document.createElement("input");i.type="hidden",i.name="_wysihtml5_mode",i.value=1,t.insert(i).after(n)}},_create:function(){var i=this;this.doc=this.sandbox.getDocument(),this.element=this.doc.body,this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0),this.selection=new e.Selection(this.parent),this.commands=new e.Commands(this.parent),t.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),t.addClass(this.element,this.config.composerClassName),this.config.style&&this.style(),this.observe();var r=this.config.name;r&&(t.addClass(this.element,r),t.addClass(this.iframe,r)),this.enable(),this.textarea.element.disabled&&this.disable();var a="string"==typeof this.config.placeholder?this.config.placeholder:this.textarea.element.getAttribute("placeholder");a&&t.simulatePlaceholder(this.parent,this,a),this.commands.exec("styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),this._initUndoManager(),this._initLineBreaking(),!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||n.isIos()||setTimeout(function(){i.focus(!0)},100),n.clearsContentEditableCorrectly()||e.quirks.ensureProperClearing(this),this.initSync&&this.config.sync&&this.initSync(),this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var i=this,r=n.canDisableAutoLinking(),a=n.doesAutoLinkingInContentEditable();if(r&&this.commands.exec("autoUrlDetect",!1),this.config.autoLink){(!a||a&&r)&&(this.parent.on("newword:composer",function(){t.getTextContent(i.element).match(t.autoLink.URL_REG_EXP)&&i.selection.executeAndRestore(function(e,n){t.autoLink(n.parentNode)})}),t.observe(this.element,"blur",function(){t.autoLink(i.element)}));var o=this.sandbox.getDocument().getElementsByTagName("a"),s=t.autoLink.URL_REG_EXP,c=function(n){var i=e.lang.string(t.getTextContent(n)).trim();return"www."===i.substr(0,4)&&(i="http://"+i),i};t.observe(this.element,"keydown",function(e){if(o.length){var n,r=i.selection.getSelectedNode(e.target.ownerDocument),a=t.getParentElement(r,{nodeName:"A"},4);a&&(n=c(a),setTimeout(function(){var e=c(a);e!==n&&e.match(s)&&a.setAttribute("href",e)},0))}})}},_initObjectResizing:function(){if(this.commands.exec("enableObjectResizing",!0),n.supportsEvent("resizeend")){var i=["width","height"],r=i.length,a=this.element;t.observe(a,"resizeend",function(t){var n,o=t.target||t.srcElement,s=o.style,c=0;if("IMG"===o.nodeName){for(;r>c;c++)n=i[c],s[n]&&(o.setAttribute(n,parseInt(s[n],10)),s[n]="");e.quirks.redraw(a)}})}},_initUndoManager:function(){this.undoManager=new e.UndoManager(this.parent)},_initLineBreaking:function(){function i(e){var n=t.getParentElement(e,{nodeName:["P","DIV"]},2);n&&r.selection.executeAndRestore(function(){r.config.useLineBreaks?t.replaceWithChildNodes(n):"P"!==n.nodeName&&t.renameElement(n,"p")})}var r=this,a=["LI","P","H1","H2","H3","H4","H5","H6"],o=["UL","OL","MENU"];this.config.useLineBreaks||t.observe(this.element,["focus","keydown"],function(){if(r.isEmpty()){var e=r.doc.createElement("P");r.element.innerHTML="",r.element.appendChild(e),n.displaysCaretInEmptyContentEditableCorrectly()?r.selection.selectNode(e,!0):(e.innerHTML="<br>",r.selection.setBefore(e.firstChild))}}),t.observe(this.doc,"keydown",function(n){var s=n.keyCode;if(!n.shiftKey&&(s===e.ENTER_KEY||s===e.BACKSPACE_KEY)){var c=t.getParentElement(r.selection.getSelectedNode(),{nodeName:a},4);return c?void setTimeout(function(){var n,a=r.selection.getSelectedNode();if("LI"===c.nodeName){if(!a)return;n=t.getParentElement(a,{nodeName:o},2),n||i(a)}s===e.ENTER_KEY&&c.nodeName.match(/^H[1-6]$/)&&i(a)},0):void(r.config.useLineBreaks&&s===e.ENTER_KEY&&!e.browser.insertsLineBreaksOnReturn()&&(r.commands.exec("insertLineBreak"),n.preventDefault()))}})}})}(wysihtml5),function(e){var t=e.dom,n=document,i=window,r=n.createElement("div"),a=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],o=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],s=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",e.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],c=function(e){if(e.setActive)try{e.setActive()}catch(r){}else{var a=e.style,o=n.documentElement.scrollTop||n.body.scrollTop,s=n.documentElement.scrollLeft||n.body.scrollLeft,c={position:a.position,top:a.top,left:a.left,WebkitUserSelect:a.WebkitUserSelect};t.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(e),e.focus(),t.setStyles(c).on(e),i.scrollTo&&i.scrollTo(s,o)}};e.views.Composer.prototype.style=function(){var i,d=this,l=n.querySelector(":focus"),u=this.textarea.element,g=u.hasAttribute("placeholder"),p=g&&u.getAttribute("placeholder"),f=u.style.display,m=u.disabled;this.focusStylesHost=r.cloneNode(!1),this.blurStylesHost=r.cloneNode(!1),this.disabledStylesHost=r.cloneNode(!1),g&&u.removeAttribute("placeholder"),u===l&&u.blur(),u.disabled=!1,u.style.display=i="none",(u.getAttribute("rows")&&"auto"===t.getStyle("height").from(u)||u.getAttribute("cols")&&"auto"===t.getStyle("width").from(u))&&(u.style.display=i=f),t.copyStyles(o).from(u).to(this.iframe).andTo(this.blurStylesHost),t.copyStyles(a).from(u).to(this.element).andTo(this.blurStylesHost),t.insertCSS(s).into(this.element.ownerDocument),u.disabled=!0,t.copyStyles(o).from(u).to(this.disabledStylesHost),t.copyStyles(a).from(u).to(this.disabledStylesHost),u.disabled=m,u.style.display=f,c(u),u.style.display=i,t.copyStyles(o).from(u).to(this.focusStylesHost),t.copyStyles(a).from(u).to(this.focusStylesHost),u.style.display=f,t.copyStyles(["display"]).from(u).to(this.iframe);var h=e.lang.array(o).without(["display"]);return l?l.focus():u.blur(),g&&u.setAttribute("placeholder",p),this.parent.on("focus:composer",function(){t.copyStyles(h).from(d.focusStylesHost).to(d.iframe),t.copyStyles(a).from(d.focusStylesHost).to(d.element)}),this.parent.on("blur:composer",function(){t.copyStyles(h).from(d.blurStylesHost).to(d.iframe),t.copyStyles(a).from(d.blurStylesHost).to(d.element)}),this.parent.observe("disable:composer",function(){t.copyStyles(h).from(d.disabledStylesHost).to(d.iframe),t.copyStyles(a).from(d.disabledStylesHost).to(d.element)}),this.parent.observe("enable:composer",function(){t.copyStyles(h).from(d.blurStylesHost).to(d.iframe),t.copyStyles(a).from(d.blurStylesHost).to(d.element)}),this}}(wysihtml5),function(e){var t=e.dom,n=e.browser,i={66:"bold",73:"italic",85:"underline"};e.views.Composer.prototype.observe=function(){var r=this,a=this.getValue(),o=this.sandbox.getIframe(),s=this.element,c=n.supportsEventsInIframeCorrectly()?s:this.sandbox.getWindow(),d=["drop","paste"];t.observe(o,"DOMNodeRemoved",function(){clearInterval(l),r.parent.fire("destroy:composer")});var l=setInterval(function(){t.contains(document.documentElement,o)||(clearInterval(l),r.parent.fire("destroy:composer"))},250);t.observe(c,"focus",function(){r.parent.fire("focus").fire("focus:composer"),setTimeout(function(){a=r.getValue()},0)}),t.observe(c,"blur",function(){a!==r.getValue()&&r.parent.fire("change").fire("change:composer"),r.parent.fire("blur").fire("blur:composer")}),t.observe(s,"dragenter",function(){r.parent.fire("unset_placeholder")}),t.observe(s,d,function(){setTimeout(function(){r.parent.fire("paste").fire("paste:composer")},0)}),t.observe(s,"keyup",function(t){var n=t.keyCode;(n===e.SPACE_KEY||n===e.ENTER_KEY)&&r.parent.fire("newword:composer")}),this.parent.on("paste:composer",function(){setTimeout(function(){r.parent.fire("newword:composer")},0)}),n.canSelectImagesInContentEditable()||t.observe(s,"mousedown",function(e){var t=e.target;"IMG"===t.nodeName&&(r.selection.selectNode(t),e.preventDefault())}),n.hasHistoryIssue()&&n.supportsSelectionModify()&&t.observe(s,"keydown",function(e){if(e.metaKey||e.ctrlKey){var t=e.keyCode,n=s.ownerDocument.defaultView,i=n.getSelection();(37===t||39===t)&&(37===t&&(i.modify("extend","left","lineboundary"),e.shiftKey||i.collapseToStart()),39===t&&(i.modify("extend","right","lineboundary"),e.shiftKey||i.collapseToEnd()),e.preventDefault())}}),t.observe(s,"keydown",function(e){var t=e.keyCode,n=i[t];(e.ctrlKey||e.metaKey)&&!e.altKey&&n&&(r.commands.exec(n),e.preventDefault())}),t.observe(s,"keydown",function(t){var n,i=r.selection.getSelectedNode(!0),a=t.keyCode;!i||"IMG"!==i.nodeName||a!==e.BACKSPACE_KEY&&a!==e.DELETE_KEY||(n=i.parentNode,n.removeChild(i),"A"!==n.nodeName||n.firstChild||n.parentNode.removeChild(n),setTimeout(function(){e.quirks.redraw(s)},0),t.preventDefault())}),n.hasIframeFocusIssue()&&(t.observe(this.iframe,"focus",function(){setTimeout(function(){r.doc.querySelector(":focus")!==r.element&&r.focus()},0)}),t.observe(this.element,"blur",function(){setTimeout(function(){r.selection.getSelection().removeAllRanges()},0)}));var u={IMG:"Image: ",A:"Link: "};t.observe(s,"mouseover",function(e){var t,n=e.target,i=n.nodeName;if("A"===i||"IMG"===i){var r=n.hasAttribute("title");r||(t=u[i]+(n.getAttribute("href")||n.getAttribute("src")),n.setAttribute("title",t))}})}}(wysihtml5),function(e){var t=400;e.views.Synchronizer=Base.extend({constructor:function(e,t,n){this.editor=e,this.textarea=t,this.composer=n,this._observe()},fromComposerToTextarea:function(t){this.textarea.setValue(e.lang.string(this.composer.getValue()).trim(),t)},fromTextareaToComposer:function(e){var t=this.textarea.getValue();t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(e){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(e):this.fromComposerToTextarea(e)},_observe:function(){var n,i=this,r=this.textarea.element.form,a=function(){n=setInterval(function(){i.fromComposerToTextarea()},t)},o=function(){clearInterval(n),n=null};a(),r&&(e.dom.observe(r,"submit",function(){i.sync(!0)}),e.dom.observe(r,"reset",function(){setTimeout(function(){i.fromComposerToTextarea()},0)})),this.editor.on("change_view",function(e){"composer"!==e||n?"textarea"===e&&(i.fromComposerToTextarea(!0),o()):(i.fromTextareaToComposer(!0),a())}),this.editor.on("destroy:composer",o)}})}(wysihtml5),wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(e,t,n){this.base(e,t,n),this._observe()},clear:function(){this.element.value=""},getValue:function(e){var t=this.isEmpty()?"":this.element.value;return e&&(t=this.parent.parse(t)),t},setValue:function(e,t){t&&(e=this.parent.parse(e)),this.element.value=e},hasPlaceholderSet:function(){var e=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),t=this.element.getAttribute("placeholder")||null,n=this.element.value,i=!n;return e&&i||n===t},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var e=this.element,t=this.parent,n={focusin:"focus",focusout:"blur"},i=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];t.on("beforeload",function(){wysihtml5.dom.observe(e,i,function(e){var i=n[e.type]||e.type;t.fire(i).fire(i+":textarea")}),wysihtml5.dom.observe(e,["paste","drop"],function(){setTimeout(function(){t.fire("paste").fire("paste:textarea")},0)})})}}),function(e){var t=e.dom,n="wysihtml5-command-dialog-opened",i="input, select, textarea",r="[data-wysihtml5-dialog-field]",a="data-wysihtml5-dialog-field";e.toolbar.Dialog=e.lang.Dispatcher.extend({constructor:function(e,t){this.link=e,this.container=t},_observe:function(){if(!this._observed){var r=this,a=function(e){var t=r._serialize();t==r.elementToChange?r.fire("edit",t):r.fire("save",t),r.hide(),e.preventDefault(),e.stopPropagation()};t.observe(r.link,"click",function(){t.hasClass(r.link,n)&&setTimeout(function(){r.hide()},0)}),t.observe(this.container,"keydown",function(t){var n=t.keyCode;n===e.ENTER_KEY&&a(t),n===e.ESCAPE_KEY&&r.hide()}),t.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",a),t.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(e){r.fire("cancel"),r.hide(),e.preventDefault(),e.stopPropagation()});for(var o=this.container.querySelectorAll(i),s=0,c=o.length,d=function(){clearInterval(r.interval)};c>s;s++)t.observe(o[s],"change",d);this._observed=!0}},_serialize:function(){for(var e=this.elementToChange||{},t=this.container.querySelectorAll(r),n=t.length,i=0;n>i;i++)e[t[i].getAttribute(a)]=t[i].value;return e},_interpolate:function(e){for(var t,n,i,o=document.querySelector(":focus"),s=this.container.querySelectorAll(r),c=s.length,d=0;c>d;d++)t=s[d],t!==o&&(e&&"hidden"===t.type||(n=t.getAttribute(a),i=this.elementToChange?this.elementToChange[n]||"":t.defaultValue,t.value=i))},show:function(e){if(!t.hasClass(this.link,n)){var r=this,a=this.container.querySelector(i);if(this.elementToChange=e,this._observe(),this._interpolate(),e&&(this.interval=setInterval(function(){r._interpolate(!0)},500)),t.addClass(this.link,n),this.container.style.display="",this.fire("show"),a&&!e)try{a.focus()}catch(o){}}},hide:function(){clearInterval(this.interval),this.elementToChange=null,t.removeClass(this.link,n),this.container.style.display="none",this.fire("hide")}})}(wysihtml5),function(e){var t=e.dom,n={position:"relative"},i={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},r={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},a={"x-webkit-speech":"",speech:""};e.toolbar.Speech=function(o,s){var c=document.createElement("input");if(!e.browser.supportsSpeechApiOn(c))return void(s.style.display="none");var d=o.editor.textarea.element.getAttribute("lang");d&&(a.lang=d);var l=document.createElement("div");e.lang.object(i).merge({width:s.offsetWidth+"px",height:s.offsetHeight+"px"}),t.insert(c).into(l),t.insert(l).into(s),t.setStyles(r).on(c),t.setAttributes(a).on(c),t.setStyles(i).on(l),t.setStyles(n).on(s);var u="onwebkitspeechchange"in c?"webkitspeechchange":"speechchange";t.observe(c,u,function(){o.execCommand("insertText",c.value),c.value=""}),t.observe(c,"click",function(e){t.hasClass(s,"wysihtml5-command-disabled")&&e.preventDefault(),e.stopPropagation()})}}(wysihtml5),function(e){var t="wysihtml5-command-disabled",n="wysihtml5-commands-disabled",i="wysihtml5-command-active",r="wysihtml5-action-active",a=e.dom;e.toolbar.Toolbar=Base.extend({constructor:function(t,n){this.editor=t,this.container="string"==typeof n?document.getElementById(n):n,this.composer=t.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),this.show();for(var i=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),r=i.length,a=0;r>a;a++)new e.toolbar.Speech(this,i[a])},_getLinks:function(t){for(var n,i,r,a,o,s=this[t+"Links"]=e.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+t+"]")).get(),c=s.length,d=0,l=this[t+"Mapping"]={};c>d;d++)n=s[d],r=n.getAttribute("data-wysihtml5-"+t),a=n.getAttribute("data-wysihtml5-"+t+"-value"),i=this.container.querySelector("[data-wysihtml5-"+t+"-group='"+r+"']"),o=this._getDialog(n,r),l[r+":"+a]={link:n,group:i,name:r,value:a,dialog:o,state:!1}},_getDialog:function(t,n){var i,r,a=this,o=this.container.querySelector("[data-wysihtml5-dialog='"+n+"']");return o&&(i=new e.toolbar.Dialog(t,o),i.on("show",function(){r=a.composer.selection.getBookmark(),a.editor.fire("show:dialog",{command:n,dialogContainer:o,commandLink:t})}),i.on("save",function(e){r&&a.composer.selection.setBookmark(r),a._execCommand(n,e),a.editor.fire("save:dialog",{command:n,dialogContainer:o,commandLink:t})}),i.on("cancel",function(){a.editor.focus(!1),a.editor.fire("cancel:dialog",{command:n,dialogContainer:o,commandLink:t})})),i},execCommand:function(e,t){if(!this.commandsDisabled){var n=this.commandMapping[e+":"+t];n&&n.dialog&&!n.state?n.dialog.show():this._execCommand(e,t)}},_execCommand:function(e,t){this.editor.focus(!1),this.composer.commands.exec(e,t),this._updateLinkStates()},execAction:function(e){var t=this.editor;"change_view"===e&&(t.currentView===t.textarea?t.fire("change_view","composer"):t.fire("change_view","textarea"))},_observe:function(){for(var e=this,t=this.editor,i=this.container,r=this.commandLinks.concat(this.actionLinks),o=r.length,s=0;o>s;s++)a.setAttributes({href:"javascript:;",unselectable:"on"}).on(r[s]);a.delegate(i,"[data-wysihtml5-command], [data-wysihtml5-action]","mousedown",function(e){e.preventDefault()}),a.delegate(i,"[data-wysihtml5-command]","click",function(t){var n=this,i=n.getAttribute("data-wysihtml5-command"),r=n.getAttribute("data-wysihtml5-command-value");e.execCommand(i,r),t.preventDefault()}),a.delegate(i,"[data-wysihtml5-action]","click",function(t){var n=this.getAttribute("data-wysihtml5-action");e.execAction(n),t.preventDefault()}),t.on("focus:composer",function(){e.bookmark=null,clearInterval(e.interval),e.interval=setInterval(function(){e._updateLinkStates()},500)}),t.on("blur:composer",function(){clearInterval(e.interval)}),t.on("destroy:composer",function(){clearInterval(e.interval)}),t.on("change_view",function(t){setTimeout(function(){e.commandsDisabled="composer"!==t,e._updateLinkStates(),e.commandsDisabled?a.addClass(i,n):a.removeClass(i,n)},0)})},_updateLinkStates:function(){var n,o,s,c,d=this.commandMapping,l=this.actionMapping;for(n in d)c=d[n],this.commandsDisabled?(o=!1,a.removeClass(c.link,i),c.group&&a.removeClass(c.group,i),c.dialog&&c.dialog.hide()):(o=this.composer.commands.state(c.name,c.value),e.lang.object(o).isArray()&&(o=1===o.length?o[0]:!0),a.removeClass(c.link,t),c.group&&a.removeClass(c.group,t)),c.state!==o&&(c.state=o,o?(a.addClass(c.link,i),c.group&&a.addClass(c.group,i),c.dialog&&("object"==typeof o?c.dialog.show(o):c.dialog.hide())):(a.removeClass(c.link,i),c.group&&a.removeClass(c.group,i),c.dialog&&c.dialog.hide()));for(n in l)s=l[n],"change_view"===s.name&&(s.state=this.editor.currentView===this.editor.textarea,s.state?a.addClass(s.link,r):a.removeClass(s.link,r))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),function(e){var t,n={name:t,style:!0,toolbar:t,autoLink:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},parser:e.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",useLineBreaks:!0,stylesheets:[],placeholderText:t,supportTouchDevices:!0};e.Editor=e.lang.Dispatcher.extend({constructor:function(t,i){if(this.textareaElement="string"==typeof t?document.getElementById(t):t,this.config=e.lang.object({}).merge(n).merge(i).get(),this.textarea=new e.views.Textarea(this,this.textareaElement,this.config),this.currentView=this.textarea,this._isCompatible=e.browser.supported(),!this._isCompatible||!this.config.supportTouchDevices&&e.browser.isTouchDevice()){var r=this;return void setTimeout(function(){r.fire("beforeload").fire("load")},0)}e.dom.addClass(document.body,this.config.bodyClassName),this.composer=new e.views.Composer(this,this.textareaElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.on("beforeload",function(){this.synchronizer=new e.views.Synchronizer(this,this.textarea,this.composer),this.config.toolbar&&(this.toolbar=new e.toolbar.Toolbar(this,this.config.toolbar))})},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(e){return this.currentView.getValue(e)},setValue:function(e,t){return this.fire("unset_placeholder"),e?(this.currentView.setValue(e,t),this):this.clear()},focus:function(e){return this.currentView.focus(e),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(t){var n=this.config.parser(t,this.config.parserRules,this.composer.sandbox.getDocument(),!0);return"object"==typeof t&&e.quirks.redraw(t),n},_initParser:function(){this.on("paste:composer",function(){var t=!0,n=this;n.composer.selection.executeAndRestore(function(){e.quirks.cleanPastedHTML(n.composer.element),n.parse(n.composer.element)},t)})}})}(wysihtml5);var wysihtml5ParserRules={classes:{"wysiwyg-clear-both":1,"wysiwyg-clear-left":1,"wysiwyg-clear-right":1,"wysiwyg-color-aqua":1,"wysiwyg-color-black":1,"wysiwyg-color-blue":1,"wysiwyg-color-fuchsia":1,"wysiwyg-color-gray":1,"wysiwyg-color-green":1,"wysiwyg-color-lime":1,"wysiwyg-color-maroon":1,"wysiwyg-color-navy":1,"wysiwyg-color-olive":1,"wysiwyg-color-purple":1,"wysiwyg-color-red":1,"wysiwyg-color-silver":1,"wysiwyg-color-teal":1,"wysiwyg-color-white":1,"wysiwyg-color-yellow":1,"wysiwyg-float-left":1,"wysiwyg-float-right":1,"wysiwyg-font-size-large":1,"wysiwyg-font-size-larger":1,"wysiwyg-font-size-medium":1,"wysiwyg-font-size-small":1,"wysiwyg-font-size-smaller":1,"wysiwyg-font-size-x-large":1,"wysiwyg-font-size-x-small":1,"wysiwyg-font-size-xx-large":1,"wysiwyg-font-size-xx-small":1,"wysiwyg-text-align-center":1,"wysiwyg-text-align-justify":1,"wysiwyg-text-align-left":1,"wysiwyg-text-align-right":1},tags:{tr:{rename_tag:"span"},strike:{rename_tag:"span"},form:{rename_tag:"span"},rt:{rename_tag:"span"},code:{rename_tag:"span"},acronym:{rename_tag:"span"},br:{},details:{rename_tag:"span"},h4:{rename_tag:"span"},em:{},title:{rename_tag:"span"},multicol:{rename_tag:"span"},figure:{rename_tag:"span"},xmp:{rename_tag:"span"},small:{rename_tag:"span"},area:{rename_tag:"span"},time:{rename_tag:"span"},dir:{rename_tag:"span"},bdi:{rename_tag:"span"},command:{rename_tag:"span"},ul:{},progress:{rename_tag:"span"},dfn:{rename_tag:"span"},iframe:{rename_tag:"span"},figcaption:{},a:{rename_tag:"span"},img:{rename_tag:"span"},rb:{rename_tag:"span"},footer:{rename_tag:"span"},noframes:{rename_tag:"span"},abbr:{rename_tag:"span"},u:{},bgsound:{rename_tag:"span"},sup:{rename_tag:"span"},address:{rename_tag:"span"},basefont:{rename_tag:"span"},nav:{rename_tag:"span"},h1:{rename_tag:"span"},head:{rename_tag:"span"},tbody:{rename_tag:"span"},dd:{rename_tag:"span"},s:{rename_tag:"span"},li:{},td:{rename_tag:"span"},object:{rename_tag:"span"},div:{},option:{rename_tag:"span"},select:{rename_tag:"span"},i:{},track:{rename_tag:"span"},wbr:{rename_tag:"span"},fieldset:{rename_tag:"span"},big:{rename_tag:"span"},button:{rename_tag:"span"},noscript:{rename_tag:"span"},svg:{rename_tag:"span"},input:{rename_tag:"span"},table:{rename_tag:"span"},keygen:{rename_tag:"span"},h5:{rename_tag:"span"},meta:{rename_tag:"span"},map:{rename_tag:"span"},isindex:{rename_tag:"span"},mark:{rename_tag:"span"},caption:{rename_tag:"span"},tfoot:{rename_tag:"span"},base:{rename_tag:"span"},video:{rename_tag:"span"},strong:{},canvas:{rename_tag:"span"},output:{rename_tag:"span"},marquee:{rename_tag:"span"},b:{},q:{rename_tag:"span"},applet:{rename_tag:"span"},span:{},rp:{rename_tag:"span"},spacer:{rename_tag:"span"},source:{rename_tag:"span"},aside:{rename_tag:"span"},frame:{rename_tag:"span"},section:{rename_tag:"span"},body:{rename_tag:"span"},ol:{},nobr:{rename_tag:"span"},html:{rename_tag:"span"},summary:{rename_tag:"span"},"var":{rename_tag:"span"},del:{rename_tag:"span"},blockquote:{rename_tag:"span"},style:{rename_tag:"span"},device:{rename_tag:"span"},meter:{rename_tag:"span"},h3:{rename_tag:"span"},textarea:{rename_tag:"span"},embed:{rename_tag:"span"},hgroup:{rename_tag:"span"},font:{rename_tag:"span"},tt:{rename_tag:"span"},noembed:{rename_tag:"span"},thead:{rename_tag:"span"},blink:{rename_tag:"span"},plaintext:{rename_tag:"span"},xml:{rename_tag:"span"},h6:{rename_tag:"span"},param:{rename_tag:"span"},th:{rename_tag:"span"},legend:{rename_tag:"span"},hr:{rename_tag:"span"},label:{rename_tag:"span"},dl:{rename_tag:"span"},kbd:{rename_tag:"span"},listing:{rename_tag:"span"},dt:{rename_tag:"span"},nextid:{rename_tag:"span"},pre:{rename_tag:"span"},center:{rename_tag:"span"},audio:{rename_tag:"span"},datalist:{rename_tag:"span"},samp:{rename_tag:"span"},col:{rename_tag:"span"},article:{rename_tag:"span"},cite:{rename_tag:"span"},link:{rename_tag:"span"},script:{rename_tag:"span"},bdo:{rename_tag:"span"},menu:{rename_tag:"span"},colgroup:{rename_tag:"span"},ruby:{rename_tag:"span"},h2:{rename_tag:"span"},ins:{rename_tag:"span"},p:{},sub:{rename_tag:"span"},comment:{rename_tag:"span"},frameset:{rename_tag:"span"},optgroup:{rename_tag:"span"},header:{rename_tag:"span"}}};!function(e){"use strict";var t={prefilled:null,CapitalizeFirstLetter:!1,preventSubmitOnEnter:!0,isClearInputOnEsc:!0,AjaxPush:null,AjaxPushAllTags:null,AjaxPushParameters:null,delimiters:[9,13,44],backspace:[8],maxTags:0,hiddenTagListName:null,hiddenTagListId:null,replace:!0,output:null,deleteTagsOnBackspace:!0,tagsContainer:null,tagCloseIcon:"x",tagClass:"",validator:null,onlyTagList:!1,preventTyping:_.noop},n={pushTag:function(t,n){var r,a,o,s,c,d,l,u,g,p,f,m,h=e(this),v=h.data("opts"),y=h.data("tlis"),_=h.data("tlid");t=i.trimTag(t,v.delimiterChars),!t||t.length<=0||(v.CapitalizeFirstLetter&&t.length>1&&(t=t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()),(!v.validator||v.validator(t))&&(v.maxTags>0&&y.length>=v.maxTags||(r=!1,a=jQuery.map(y,function(e){return e.toLowerCase()}),c=e.inArray(t.toLowerCase(),a),-1!==c&&(r=!0),r?e("#"+h.data("tm_rndid")+"_"+_[c]).stop().animate({backgroundColor:v.blinkBGColor_1},100).animate({backgroundColor:v.blinkBGColor_2},100).animate({backgroundColor:v.blinkBGColor_1},100).animate({backgroundColor:v.blinkBGColor_2},100).animate({backgroundColor:v.blinkBGColor_1},100).animate({backgroundColor:v.blinkBGColor_2},100):(n||h.trigger("tm:pushing",t),o=Math.max.apply(null,_),o=o===-(1/0)?0:o,s=++o,y.push(t),_.push(s),n||null!==v.AjaxPush&&-1===e.inArray(t,v.prefilled)&&e.post(v.AjaxPush,e.extend({tag:t},v.AjaxPushParameters)),d=h.data("tm_rndid")+"_"+s,l=h.data("tm_rndid")+"_Remover_"+s,u=e("<span/>").text(t).html(),g='<span class="'+i.tagClasses.call(h)+'" id="'+d+'">',g+="<span>"+u+"</span>",g+='<a href="#" class="tm-tag-remove" id="'+l+'" TagIdToRemove="'+s+'">',g+=v.tagCloseIcon+"</a></span> ",p=e(g),null!==v.tagsContainer?e(v.tagsContainer).append(p):s>1?(f=s-1,m=e("#"+h.data("tm_rndid")+"_"+f),m.after(p)):h.before(p),p.find("#"+l).on("click",h,function(t){t.preventDefault();var n=parseInt(e(this).attr("TagIdToRemove"));i.spliceTag.call(h,n,t.data)}),i.refreshHiddenTagList.call(h),n||h.trigger("tm:pushed",t),i.showOrHide.call(h)),h.val(""))))},popTag:function(){var t,n,r=e(this),a=r.data("tlis"),o=r.data("tlid");o.length>0&&(t=o.pop(),n=a[a.length-1],r.trigger("tm:popping",n),a.pop(),e("#"+r.data("tm_rndid")+"_"+t).remove(),i.refreshHiddenTagList.call(r),r.trigger("tm:popped",n))},empty:function(){for(var t,n=e(this),r=n.data("tlis"),a=n.data("tlid");a.length>0;)t=a.pop(),r.pop(),e("#"+n.data("tm_rndid")+"_"+t).remove(),i.refreshHiddenTagList.call(n);n.trigger("tm:emptied",null),i.showOrHide.call(n)}},i={showOrHide:function(){var e=this,t=e.data("opts"),n=e.data("tlis");t.maxTags>0&&n.length<t.maxTags&&(e.show(),e.trigger("tm:show")),t.maxTags>0&&n.length>=t.maxTags&&(e.hide(),e.trigger("tm:hide"))},tagClasses:function(){var t,n=e(this),i=n.data("opts"),r=i.tagBaseClass,a=i.inputBaseClass;return t=r,n.attr("class")&&e.each(n.attr("class").split(" "),function(e,n){-1!==n.indexOf(a+"-")&&(t+=" "+r+n.substring(a.length))}),t+=i.tagClass?" "+i.tagClass:""},trimTag:function(t,n){var i;for(t=e.trim(t),i=0;i<t.length&&-1===e.inArray(t.charCodeAt(i),n);i++);return t.substring(0,i)},refreshHiddenTagList:function(){var t=e(this),n=t.data("tlis"),i=t.data("lhiddenTagList");i&&e(i).val(n.join(t.data("opts").baseDelimiter)).change(),t.trigger("tm:refresh",n.join(t.data("opts").baseDelimiter))},killEvent:function(e){e.cancelBubble=!0,e.returnValue=!1,e.stopPropagation(),e.preventDefault()},keyInArray:function(t,n){return-1!==e.inArray(t.which,n)},applyDelimiter:function(t){var i=e(this);n.pushTag.call(i,e(this).val()),t.preventDefault()},prefill:function(t){var i=e(this);e.each(t,function(e,t){n.pushTag.call(i,t,!0)})},pushAllTags:function(t,n){var i=this,r=i.data("opts"),a=i.data("tlis");r.AjaxPushAllTags&&("tm:pushed"!==t.type||-1===e.inArray(n,r.prefilled))&&e.post(r.AjaxPush,{tags:a.join(r.baseDelimiter)})},spliceTag:function(t){var n,r=this,a=r.data("tlis"),o=r.data("tlid"),s=e.inArray(t,o);-1!==s&&(n=a[s],r.trigger("tm:splicing",n),e("#"+r.data("tm_rndid")+"_"+t).remove(),a.splice(s,1),o.splice(s,1),i.refreshHiddenTagList.call(r),r.trigger("tm:spliced",n)),i.showOrHide.call(r)},init:function(r){var a,o,s=e.extend({},t,r);s.hiddenTagListName=null===s.hiddenTagListName?"hidden-"+this.attr("name"):s.hiddenTagListName,a=s.delimeters||s.delimiters,o=[9,13,17,18,19,37,38,39,40],s.delimiterChars=[],s.delimiterKeys=[],e.each(a,function(t,n){-1!==e.inArray(n,o)?s.delimiterKeys.push(n):s.delimiterChars.push(n)}),s.baseDelimiter=String.fromCharCode(s.delimiterChars[0]||44),s.tagBaseClass="tm-tag",s.inputBaseClass="tm-input",e.isFunction(s.validator)||(s.validator=null),this.each(function(){var t=e(this),r="",a="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";if(t.data("tagManager"))return!1;t.data("tagManager",!0);for(var c=0;5>c;c++)a+=o.charAt(Math.floor(Math.random()*o.length));if(t.data("tm_rndid",a),t.data("opts",s).data("tlis",[]).data("tlid",[]),null===s.output?(r=e("<input/>",{type:"hidden",name:s.hiddenTagListName}),t.after(r),t.data("lhiddenTagList",r)):t.data("lhiddenTagList",e(s.output)),s.AjaxPushAllTags&&(t.on("tm:spliced",i.pushAllTags),t.on("tm:popped",i.pushAllTags),t.on("tm:pushed",i.pushAllTags)),t.on("focus keypress",function(t){e(this).popover&&e(this).popover("hide")}),s.isClearInputOnEsc&&t.on("keyup",function(t){27===t.which&&(e(this).val(""),i.killEvent(t))}),t.on("keypress",function(e){i.keyInArray(e,s.delimiterChars)&&i.applyDelimiter.call(t,e)}),t.on("keydown",function(e){s.preventTyping(e.key)&&i.killEvent(e),13===e.which&&s.preventSubmitOnEnter&&i.killEvent(e),i.keyInArray(e,s.delimiterKeys)&&i.applyDelimiter.call(t,e)}),s.deleteTagsOnBackspace&&t.on("keydown",function(r){i.keyInArray(r,s.backspace)&&e(this).val().length<=0&&(n.popTag.call(t),i.killEvent(r))}),t.change(function(e){/webkit/.test(navigator.userAgent.toLowerCase())||t.focus(),i.killEvent(e)}),null!==s.prefilled)"object"==typeof s.prefilled?i.prefill.call(t,s.prefilled):"string"==typeof s.prefilled?i.prefill.call(t,s.prefilled.split(s.baseDelimiter)):"function"==typeof s.prefilled&&i.prefill.call(t,s.prefilled());else if(null!==s.output){if(e(s.output)&&e(s.output).val()){e(s.output)}i.prefill.call(t,e(s.output).val().split(s.baseDelimiter))}})}};e.fn.tagsManager=function(t){var r=e(this);return 0 in this?n[t]?n[t].apply(r,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(e.error("Method "+t+" does not exist."),!1):i.init.apply(this,arguments):this}}(jQuery),function(e){function t(t,n){n=n||{};var i=this,r=n.binderObject||{},a=e(r),o=n.view||document,s=e(o);return i.pubSub=a,i.obj=r,i.view=o,i.$view=s,i.objectId=t,i.options=n,i.dataAttr=n.dataAttr||"bind-"+t,i.dataSelector=n.dataSelector||"[data-"+i.dataAttr+"]",i.classSelector=n.classSelector||".js-"+i.dataAttr,i.viewSelector=i[n.viewSelector]||i.classSelector,i}function n(t,n){return e(t).data(n)}e.extend(t.prototype,{applyBindings:function(){var t=this,i=["change"],r="click",a=t.objectId,o=t.pubSub,s=t.obj,c=t.$view,d=t.dataAttr;i.push(r),c.on(i.join(" "),t.viewSelector,function(t){var i,s=e(this),c=e(t.target),l=n(s,d);if(n(c,d)&&l)switch(t.stopPropagation(),!0){case!("change"!==t.type||_.isUndefined(l.value)&&_.isUndefined(l.checked)):i=e.Event(a+":change"),i.originalBindEvent=t,l.value&&(s.is("input, textarea, select")?o.trigger(i,[l.value,s.val(),t]):o.trigger(i,[l.value,s.html(),t])),l.checked&&s.is(":checkbox")&&o.trigger(i,[l.checked,s.prop("checked"),t]);break;case t.type===r&&!_.isUndefined(l.click):i=e.Event(l.click),i.originalBindEvent=t,o.trigger(i)}}),t.pubSub.on(t.objectId+":change",function(i,r,a){e(t.viewSelector).each(function(){var t,o=this,c=e(this),l=i.target||null,u=n(c,d);u.value&&u.value===r&&o!==l&&(c.is("input, textarea, select")?c.val(a):c.html(a.toString())),u.checked&&u.checked===r&&c.is(":checkbox")&&o!==l&&(o.checked=a),u.show&&(t=s.getBinding(u.show),_.isUndefined(t)||c.toggle(t)),u.enabled&&(t=s.getBinding(u.enabled),_.isUndefined(t)||(c.is(":input")?c.prop("disabled",!t):c.find(":input").prop("disabled",!t))),u.disabled&&(t=s.getBinding(u.disabled),_.isUndefined(t)||(c.is(":input")?c.prop("disabled",t):c.find(":input").prop("disabled",t)))})})},preventDefault:function(e){e&&(e.originalBindEvent&&e.originalBindEvent.preventDefault&&e.originalBindEvent.preventDefault(),e.preventDefault&&e.preventDefault())}}),window.fDataBinder=t}(jQuery),function(e){function t(e,t){var n=this;return t=t||{},t.binderObject=t.binderObject||n,n.uid=e,n.attributes=this.attributes||t.attributes||{},n.binder=new fDataBinder(e,t),n.pubSub=n.pubSub||t.pubSub||n.binder.pubSub,n.$view=n.binder.$view,n.options=t,n}e.extend(t.prototype,{constructor:t,applyBindings:function(){var e=this;e.pubSub.on(e.uid+":change",function(t,n,i,r){r!==e&&e.set(n,i,{silent:!0})}),e.binder.applyBindings()},set:function(e,t,n){n=n||{};var i=this,r=n.silent;i.getAttribute(e);r||i.trigger(":beforechange",e,t,i),i.setAttribute(e,t),r||i.trigger(":change",e,t,i)},get:function(e){return arguments.length?this.hasAttribute(e)?this.getAttribute(e):void 0:this.attributes},getBinding:function(e){var t,n=this;return n.hasAttribute&&n.hasAttribute(e)?t=n.get(e):n[e]&&_.isFunction(n[e])?t=n[e]():_.isUndefined(n[e])||(t=n[e]),t},hasAttribute:function(e){var t=this.attributes;e=e.split(".");for(var n=0;n<e.length;n++){if(!_.isObject(t)||!t.hasOwnProperty(e[n]))return!1;t=t[e[n]]}return!0},getAttribute:function(e){var t=this.attributes;if(~e.indexOf(".")){e=e.split(".");for(var n=0;n<e.length;n++){if(e[n]&&!_.isObject(t))throw new TypeError('Cannot read property "'+e[n]+'" of '+e[n-1]);t=t[e[n]]}}else t=this.attributes[e];return t},setAttribute:function(e,t){var n=this.attributes;if(~e.indexOf(".")){e=e.split(".");for(var i=0;i<e.length-1;i++){if(e[i]&&!_.isObject(n))throw new TypeError('Cannot set property "'+e[i]+'" of '+e[i-1]);n=n[e[i]]}n[e.pop()]=t}else this.attributes[e]=t},trigger:function(e){var t=Array.prototype.slice.call(arguments,1);this.pubSub.trigger(this.uid+e,t)},preventDefault:fDataBinder.prototype.preventDefault}),e.each(["pop","push","reverse","shift","sort","splice","slice","unshift"],function(e,n){t.prototype[n]=function(e){var t=this,i={};_.isObject(e)&&(i=e,e=i.attribute);var r=t.get(e),a=Array.prototype.slice.call(arguments,1),o=r[n].apply(r,a);return i.silent||t.pubSub.trigger(t.uid+":change",[e,o,t]),o}}),window.fBasicViewModel=t}(jQuery),function(e){e.fn.multiTrigger=function(t){var n=arguments[1]||[];return t=t.split(" "),this.each(function(){var i=e(this);e.each(t,function(e,t){i.trigger(t,n)})})}}(jQuery),function(){"use strict";function e(e){var t,n,i,r;if(t=x+e,t>=E){if(t>E)return l.style.opacity=.5,void setTimeout(function(){l.style.opacity=1},150);C["in-on"].style.display="none",C["in-off"].style.display="block"}else C["in-on"].style.display="block",C["in-off"].style.display="none";if(0>=t){if(0>t)return l.style.opacity=.5,void setTimeout(function(){l.style.opacity=1},150);C["out-on"].style.display="none",C["out-off"].style.display="block"}else C["out-on"].style.display="block",C["out-off"].style.display="none";x=t,p.style.width=S[t]+"px",n=p.width,i=p.height,null===b?(b=u-n,w=g-i):(r=n/h,d=n/f,b=u-(u-b)*r,w=g-(g-w)*r),h=n,v=i,k=void 0!=d?d:n/f,p.style.left=b+"px",p.style.top=w+"px",a()}function t(){e(1)}function n(){e(-1)}function i(e){e=e||window.event;e.detail?-1*e.detail:e.wheelDelta/40;return e.preventDefault?e.preventDefault():e.returnValue=!1,!1}function r(e){var t=[];return e.touches&&e.touches.length?(t[0]=e.touches[0].clientX,t[1]=e.touches[0].clientY):(t[0]=e.clientX,t[1]=e.clientY),t}function a(){var e=u-h,t=g-v;b>0&&(b=0),w>0&&(w=0),e>b&&(b=e),t>w&&(w=t),p.style.left=b+"px",p.style.top=w+"px"}function o(e){e=e||window.event;var t=r(e);return b=y+(t[0]-T[0]),w=_+(t[1]-T[1]),a(),e.preventDefault?e.preventDefault():e.returnValue=!1,!1}function s(e){e=e||window.event,e.preventDefault?e.preventDefault():e.returnValue=!1;var n=(new Date).getTime();N>n-200?t():N=n,"touchstart"===e.type?(p.onmousedown=null,p.ontouchmove=o,p.ontouchend=function(){p.ontouchmove=null,p.ontouchend=null}):(document.onmousemove=o,document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}),y=b,_=w,T=r(e)}function c(e){var t,n;t=document.createElement("style"),"style"===t.tagName?(t.setAttribute("type","text/css"),t.appendChild(document.createTextNode(e)),n=document.getElementsByTagName("head"),n[0]&&n[0].appendChild(t)):document.write('<style type="text/css"> '+e+" </style>")}var d,l=null,u=null,g=null,p=null,f=null,m=null,h=null,v=null,y=null,_=null,b=null,w=null,C={},x=0,S=[],E=[],N=0,T=null,k=1;c("#image-zoom-wrapper {overflow: hidden; position: relative;} #image-zoom {visibility: hidden; position: relative;}");var D=function(){l=null,u=null,g=null,p=null,f=null,m=null,h=null,v=null,y=null,_=null,b=null,w=null,C={},x=0,S=[],E=[],N=0,T=null,k=1},R=function(){"undefined"==k&&(k=1);var e={ratio:k,coords:Math.round(b/k)+","+Math.round(w/k)};return e},A=function(){if(l=document.getElementById("image-zoom-wrapper"),p=document.getElementById("image-zoom"),l&&p){var r,o,c,d,h,v,y,_,x,N,T;try{o=getComputedStyle(l,""),r=o.getPropertyValue("border-top-width"),u=o.getPropertyValue("width"),g=o.getPropertyValue("height")}catch(k){r=l.currentStyle.borderWidth,u=l.currentStyle.width,g=l.currentStyle.height}for(u=Math.round(parseInt(u,10)),g=Math.round(parseInt(g,10)),f=p.width,m=p.height,_=[{t:"in",s:"on"},{t:"in",s:"off"},{t:"out",s:"on"},{t:"out",s:"off"}],T=0,N=_.length;N>T;T+=1){if(y=_[T],x=y.t+"-"+y.s,C[x]=document.createElement("div"),C[x].className="btn-standard btn-opaque zoom-btn zoom-control zoom-"+y.t+" zoom-"+y.s,"in"===y.t?"on"===y.s&&(C[x].onmousedown=t):"on"===y.s&&(C[x].onmousedown=n),"on"===y.s)try{C[x].style.cursor="pointer"}catch(D){C[x].style.cursor="hand"}l.appendChild(C[x])}for(c=u,d=g,h=f,v=m,S[S.length]=h;h>=c&&v>=d;)h=.85*h,v=.85*v,h>=c&&v>=d?S[S.length]=Math.round(h):S[S.length-1]=c;S.reverse(),5===parseInt(r,10)&&(S[S.length]=Math.round(1.15*f),S[S.length]=Math.round(3*f)),E=S.length-1,e(0),p.style.visibility="visible",p.style.cursor="move",l.style.backgroundImage="none",p.onmousedown=s,p.ontouchstart=s,l.addEventListener?(l.addEventListener("DOMMouseScroll",i,!1),l.addEventListener("mousewheel",i,!1)):l.attachEvent&&l.attachEvent("onmousewheel",i),document.onkeyup=function(e){var i=e?e.which:window.event.keyCode;37===i||39===i?(b+=39===i?50:-50,a()):38===i||40===i?(w+=40===i?50:-50,a()):107===i||187===i||61===i?t():(109===i||189===i)&&n()}}};window.getZoomifyData=R,window.resetZoomify=D,window.initZoomify=A}(),function(e){var t={commits:{},enforceClass:"standard-enforcement",standardNumberOfPackages:function(e){var n=_.find(e.constraints.global,{name:"number_of_packages"});if(!n)throw new Error("number_of_packages is missing in global constraints");var i=parseInt(n.value,10);n.editable?t.isPackagePricingDefinedInThePast(0)||t.commit("active_packages_count",i):(t.commit("active_packages_count",i),t.commit("packagesCountLocked",!0))},standardPackagesNames:function(e){var n=_.find(e.constraints.packages_fields,{id:"packages_names"});if(!n)throw new Error("packages_names is missing in packages_fields constraints");for(var i=0;i<n.packages.length;i++)if(!e.packages[i].title){var r=_.template("packages[${i}].title")({i:i});t.commit(r,n.packages[i].value)}},updatePricingFactor:function(e,n,i,r){var a=_.includes([!1,"",null,void 0],i.value),o=!!_.get(t._data,"extra_fast.0");if(t.commit(e+".isRecommendedToFill",i.editable&&!a),o&&"additional_modifications"===n.id){t.commit("extra_fast.0.isRecommendedToFill",!a);var s;s=t.isPackagePricingDefinedInThePast(0)?t._data.extra_fast[0].active:a?"0":"1",t.commit("extra_fast.0.active",s)}if(!i.editable||!t.isPackagePricingDefinedInThePast(r)){if(i.editable||t.commit(e+".isLocked",!0),"modifications"===n.id){t.commit(e+".active",a?"0":"1");var c=a?n.included_modifications:parseInt(i.value,10);return void t.commit(e+".included_modifications",c)}switch(n.edit_type){case"checkbox":t.commit(e+".active",i.value?"1":"0");break;case"dropdown":case"number":var a=_.includes([!1,"",null,void 0],i.value);t.commit(e+".active",a?"0":"1"),t.commit(e+".data_value",a?null:i.value);break;default:var d=_.template("uncovered case of pricing factor edit_type: ${editType}");throw new Error(d({editType:n.edit_type}))}}},standardPackagesFactors:function(e){var n=e.constraints.pricing_factors;if(!n)throw new Error("pricing_factors is missing in constraints");for(var i=e.packages,r=0;r<i.length;r++)for(var a=i[r].content,o=0;o<a.length;o++){var s=a[o],c=_.chain(n).find({id:s.id}).get("packages").value();if(!_.isEmpty(c)){var d=_.template("packages.${packageIdx}.content.${pricingIdx}"),l=d({packageIdx:r,pricingIdx:o});t.updatePricingFactor(l,s,c[r],r)}}},standardPackagesExtraFactors:function(e){var n=e.constraints.pricing_factors;if(!n)throw new Error("pricing_factors is missing in constraints");for(var i=e.upgrades_per_package,r=0;r<i.length;r++)for(var a=i[r].values,o=0;o<a.length;o++){var s=a[o],c=_.chain(n).find({id:s.id}).get("extras").value();if(!_.isEmpty(c)){var d=_.template("upgrades_per_package.${pricingIdx}.values.${packageIdx}"),l=d({pricingIdx:r,packageIdx:o});t.updatePricingFactor(l,s,c[o],o)}}},standardExtraFactors:function(e){var n=e.constraints.pricing_factors;if(!n)throw new Error("pricing_factors is missing in constraints");for(var i=e.upgrades,r=0;r<i.length;r++){var a=i[r],o=_.chain(n).find({id:a.id}).get("extras").first().value();if(!_.isEmpty(o)){var s=_.template("upgrades.${pricingIdx}"),c=s({pricingIdx:r});t.updatePricingFactor(c,a,o,0)}}},applyConstraints:function(e,n){try{t.commits={},t._data=e;var i=e.constraints;return _.isEmpty(i)?e:i.active?(t.commit=function(n,i){var r=_.get(e,n);_.isEqual(r,i)||(t.commits[n]||(t.commits[n]={prevState:_.cloneDeep(r)}),t.commits[n].state=_.cloneDeep(i),_.set(e,n,i))},t.isPackagePricingDefinedInThePast=function(t){return e.packages[t].title},t.standardNumberOfPackages(e),t.standardPackagesNames(e),t.standardPackagesFactors(e),t.standardPackagesExtraFactors(e),t.standardExtraFactors(e),e):e}catch(r){return r.details||(r.details={}),r.details.module="v2_pricing_standards",r.details.context=n,setTimeout(function(){throw r}),e}}};window.StandardGigsPricing=t}(jQuery),function(){fTextEditor={init:function(e){var t=$("#"+e),n=t.wrap('<div class="gig-edit-editor-wrap"></div>').parent(),i=$(".edit-gig-form-wrap");if(!(t.length<1)){n.append('<div id="'+e+'-toolbar" class="gig-edit-toolbar" style="display: none;"><a class="toolbar-btn bold" data-wysihtml5-command="bold"></a><a class="toolbar-btn ul" data-wysihtml5-command="insertUnorderedList"></a><a class="toolbar-btn ol" data-wysihtml5-command="insertOrderedList"></a><a class="toolbar-btn strong" data-wysihtml5-command="formatInline" data-wysihtml5-command-value="u"></a></div>');var r=new wysihtml5.Editor(e,{toolbar:e+"-toolbar",parserRules:wysihtml5ParserRules,stylesheets:"//assetsv2.fiverrcdn.com/assets/wysiwyg-9fa305f08f4165f33914f088b3249a30.css",autoLink:!1});return r.on("load",function(){var t=$(this.textareaElement.parentElement);t.removeClass("inside"),t.find("iframe.wysihtml5-sandbox").contents().find("body").css({overflow:"hidden"}),t.find(".gig-edit-toolbar").hide();var n=$(r.composer.doc);n.keydown(function(t){Fiverr[e]({target:{value:n.context.body.innerHTML}})}),n.keyup(function(t){Fiverr[e]({target:{value:n.context.body.innerHTML}})})}).on("focus",function(){var e=$(this.textareaElement.parentElement);e.addClass("inside focused").closest(".form-row").addClass("active"),e.find("iframe.wysihtml5-sandbox").contents().find("body").css({overflow:"auto"}),i.addClass("focused"),e.find(".gig-edit-toolbar").show()}).on("change",function(t){Fiverr[e]({target:{value:$(r.composer.doc).context.body.innerHTML}})}).on("blur",function(){var e=$(this.textareaElement),t=e.parent();t.removeClass("focused").closest(".form-row").removeClass("active"),i.removeClass("focused"),this.textarea.getValue().length||n.removeClass("inside")}),r}}},window.fTextEditor=fTextEditor}(jQuery),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["manage-gigs"]=t():e["manage-gigs"]=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=102)}({10:function(e,t,n){"use strict";e.exports=function(e){return isNaN(e)?0:(e/2).toFixed(1)}},102:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(87),a=i(r),o=n(7),s=i(o),c=n(10),d=i(c),l=n(86),u=i(l),g=n(67),p=i(g),f=n(68),m=i(f);t["default"]=function(){Handlebars.registerHelper("safeReqId",a["default"]),Handlebars.registerHelper("countSelected",s["default"]),Handlebars.registerHelper("displayTextualRating",d["default"]),Handlebars.registerHelper("returnPackageTitle",u["default"]),Handlebars.registerHelper("isExtraEnforcedInAnyPackage",p["default"]),Handlebars.registerHelper("isExtraRecommendedToFillInAnyPackage",m["default"])}(),e.exports=t["default"]},67:function(e,t,n){"use strict";e.exports=function(e,t){return e.some(function(e){return e.isLocked})?t.fn(this):void 0}},68:function(e,t,n){"use strict";e.exports=function(e,t){return e.some(function(e){return e.isRecommendedToFill})?t.fn(this):void 0}},7:function(e,t,n){"use strict";e.exports=function(e){return _.filter(e,"selected").length}},86:function(e,t,n){"use strict";e.exports=function(e){return $.t("manage_gigs.edit.gig_and_packages.package_"+e)}},87:function(e,t,n){"use strict";e.exports=function(e){return e||0}}})}),function(e){var t={models:{c:Fiverr.models.context,b:Fiverr.models.browser,ps:Fiverr.models.ps,user:Fiverr.models.user,nestedServiceTypes:{},should_lock_gig_categories:document.pageScope.should_lock_gig_categories,gigs:{filledInputs:[],disableFormPost:!1,shippableSubcats:[56,50,48,55,154,153,122,121,117,2,25,310,79,287,281,321,127,123],proOnlyCats:document.proOnlyCategories,omitCatsFromStudio:{hidden:[7]},omitSubCatsFromStudio:{hidden:[20,31,97,117,120,121,122,123,137],disabled:[16]},categoriesSuggestions:{subCategoriesSuggestionInProgress:!1,subCategories:{},nestedSubCategories:{}},deniedGigsAlert:document.viewData.denied_gigs_alert},fddPriceDefault:{text:"$",val:"",value:""},isPro:!1},selectors:{$form:e(".edit-gig-form-wrap"),$proGigToggle:e(".js-pro-gig-toggle"),$catsWrapper:e(".js-categories-wrapper"),$subCatsWrapper:e(".js-subcategories-wrapper"),$nestedSubCatsWrapper:e(".js-service-types-wrapper"),$suggestedCategoriesWrapper:e(".js-gig-edit-suggestions-wrapper")},progressSteps:["general","pricing","requirements","gallery","publish","pending","share","finish"],timelineSteps:["general","pricing","requirements","gallery","publish"],currentPageSteps:[],currentStep:0,flag:0,lastImgUploadButtonID:"#gig-edit-fileInput1",gigID:"",gigCreateShareLinks:[],isPlayingAround:!1,selectedExtras:[],manageGigsPath:"",editMode:"",init:function(){var t=this,n=t.models,i=t.selectors;if(i.$box=e(".js-upgrades"),i.$boxShipping=e(".js-shipping"),!n.b.isMobileResponsive){if(n.proChecked=i.$proGigToggle.length&&i.$proGigToggle.prop("checked"),t.bindCategoryDropDown(),t.bindFormProgressActions(),t.bindGigDurationDropDown(),t.bindGigShippingDropDown(),t.bindBlurOnGigText(),n.gigs.deniedGigsAlert&&t.showDeniedGigsAlert(),"new"===n.c.psSub||"create"===n.c.psSub)t.editMode="create",t.initProMode(),t.bindGigGeneralForm(),t.initTimeline(),n.autoSelectCategory=ft.utl.getUrlHashVars().category_id,n.autoSelectSubcategory=ft.utl.getUrlHashVars().subcategory_id,n.autoSelectCategory&&e(".js-categories-wrapper").fakeDropdown("val",n.autoSelectCategory);else if("edit"===n.c.psSub||"update"===n.c.psSub||"translate"===n.c.psSub){t.editMode="edit",t.initProMode(),t.bindGigEditForm(),t.bindFiverrLearnReportEvent();var r=parseFloat(e('[name="gig[sub_category_id]"]').val(),10);t.hideShipping(r),(228===r||16===r)&&Fiverr.pushGoogleGenericTag({subCategoryId:1})}fDashboardNew.shared.pdfUploadHandler.init(),fGigRequirementsViewModel.init(t,"requirements",e("#gig-edit-requirements")[0],document.fEditGigData),i.$box.on("click",".js-open-package-intro",function(e){e.preventDefault(),fDashboardNew.shared.initPackagesPopup(150248568)}),t.bindMultiPairsEvents(),"edit"===n.c.psSub&&(n.ps.shouldLockCatalogPosition?this.lockCatalogPositionChanges([i.$catsWrapper,i.$subCatsWrapper,i.$nestedSubCatsWrapper],e.t("manage_gigs.edit.locked_catalog_position")):n.ps.preventEditGigCategory&&this.lockCatalogPositionChanges([i.$catsWrapper],e.t("manage_gigs.edit.cant_change_cat")))}},lockCatalogPositionChanges:function(e,t){var n=this,i=(n.models,n.selectors);i.$form.find(".gig-edit-suggestions-wrapper").remove(),_.forEach(e,function(e){e.find(".dropdown-toggle").addClass("disabled"),e.find(".dropdown-menu").remove(),e.addClass("hint--top").attr("data-hint",t)})},initProMode:function(){var e=this,t=e.models,n=(e.selectors,!!t.user.is_pro),i=document.gigIsPro||!1;t.isPro="create"==e.editMode?n:i},initProPricing:function(){var t,n=this,i=n.models,r=n.selectors;if(i.isPro){var a=e(".js-price-round");r.$inpPriceRound=a.find('input[type="number"]'),r.$inpPriceRound.length&&(Fiverr._forceDigits(a),t=e(".js-step-spin"),t.off("click").on("click",function(t){t.preventDefault();var i=e(this);n.clickProStepSpin(i)}))}},clickProStepSpin:function(e){var t=e.parents(".js-price-round").find('input[type="number"]'),n=parseInt(t.val()),i=parseInt(t.attr("step")),r=parseInt(t.attr("max")),a=parseInt(t.attr("min")),o=n;o=Fiverr._roundPriceValue(n,i,r),n===o&&(e.hasClass("add")?(o+=i,o=o>r?r:o):(o-=i,o=a>o?a:o)),_.isNil(o)&&(o=a),t.val(o),t.trigger("change")},loopProPricing:function(){var t,n,i=this,r=i.models,a=i.selectors;r.isPro&&(t=e(".js-price-round"),a.$inpPriceRound=t.find('input[type="number"]'),a.$inpPriceRound.length&&a.$inpPriceRound.each(function(){n=e(this),n.val(Fiverr._roundPriceValue(n.val(),n.attr("step"),n.attr("max")))}))},returnProInp:function(t){var n="";return t.initVal&&t.initVal.length&&_.isString(t.initVal)&&(n=t.initVal.replace(/\D/g,"")),e("<input>",{type:t.inpType,step:t.step,min:t.step,max:t.max,"class":t.classes,name:t.name,value:n})},handleProCats:function(t,n){var i=this,r=i.selectors,a=i.models,o=n.hasClass("js-subcategories-wrapper"),s=n.hasClass("js-service-types-wrapper");if(0===r.$proGigToggle.length||!t)return void n.find("ul li").each(function(t,n){var i=e(n),r=i.find("a"),o=r.data("val");if(o){var s=_.includes(a.gigs.proOnlyCats,o);if(s){r.addClass("disabled");var c=e('<i class="pro-badge" title="For Fiverr Pro sellers"></i>');r.append(c)}}});if(o){var c=n.fakeDropdown("val"),d=!c||!t.hasOwnProperty(c);d&&(n.empty(),i.regenerateSubcatsDropDown(i.onSubcategoryClicked))}s||n.find("ul li").each(function(n,i){var r=e(i),a=r.find("a"),o=a.data("val");o&&(t.hasOwnProperty(o)?a.addClass("pro"):a.addClass("pro-disabled disabled"))})},hideShipping:function(e){var t=this,n=t.models,i=t.selectors;i.$boxShipping.toggleClass("hidden",-1===n.gigs.shippableSubcats.indexOf(e))},bindMetaData:function(t){var n,i,r=this,a=e(".metadata-edit-row"),o=a.find(".js-metadata-edit"),s=0===e(".metadata-inputs").length,c={metadata:t,noneText:e.t("manage_gigs.index.not_defined"),chooseText:e.t("manage_gigs.index.choose"),suggestText:e.t("manage_gigs._metadata.suggest"),tooltipText:e.t("manage_gigs._metadata.suggest_hover"),helpText:e.t("manage_gigs._metadata.suggest_help"),other_md:document.pageScope.other_md};Fiverr._getHbTemplate({tplType:"dashboard",tplName:"metadata-edit",tplData:c,callback:function(e){o.html(e),a.removeClass("metadata-hidden")}}),o.find(".gig-meta-dd").length&&(Fiverr.initfakeDropdown(o),e.each(o.find(".gig-meta-dd"),function(){var t=this;Fiverr.initfakeDropdownReal(t,function(e){r.activateDropDown(e)});var n=e(t).find(".dropdown-menu");n.innerHeight()>350&&n.css({maxHeight:350,"overflow-y":"scroll"})})),o.find(".js-check-max-limit").length&&o.find(".metadata-checkbox").trigger("change"),n=function(e){o.height()>o.find("aside > ul").height()+3&&e.removeClass("remove-border")},i=function(e){if(e.hasClass("js-md-other")){var t=e.closest("li").find(".js-metadata-other");t.removeClass("hidden-md").find("input").addClass("active")}},s&&(o.on("click",".js-metadata-side-titles > li:not(.sel)",function(t){var i=e(this);e(".js-metadata-side-titles .sel").removeClass("sel"),i.hasClass("remove-border")&&n(i),i.addClass("sel"),e(".metadata-inputs > section.current").removeClass("current"),e("."+i.data("id")+"-wrapper").addClass("current")}),o.on("keydown",".number",function(t){return(t.keyCode<48||t.keyCode>57)&&(t.keyCode<96||t.keyCode>105)&&8!=t.keyCode?(t.preventDefault(),!1):void r.markCurrentTitle(e(this).val(),this.name)}),o.on("blur",'section > input[type="text"]',function(t){var n=e(this),i=n.data("validate")||!1,a=n.val();(!i||(i=new RegExp(i),i.test(a)))&&r.markCurrentTitle(a.length,this.name)}),o.on("change",".metadata-radio",function(t){var n=this,i=e(n),a=i.closest("ul"),o=a.data("last-selection");return r.checkIfSelectAsStructuredExtras(o,i.data("wrapper"))?(t.preventDefault(),a.find(':input[value="'+o+'"]').prop("checked",!0),!1):(a.data("last-selection",n.value),void r.markCurrentTitle(""!=n.value,i.data("wrapper")))}),o.on("change",".metadata-checkbox",function(t){var n=e(this),i=e(this).closest("section"),a=i.find(".js-max-to-select-status em"),o=n.data("wrapper"),s=e("."+o),c=s.find(".metadata-checkbox:checked").length,d=s.data("max-limit")||!1;return r.checkIfSelectAsStructuredExtras(n.val(),o)?(t.preventDefault(),n.prop("checked",!0),!1):(a.html(c),1===c?r.markCurrentTitle(!0,o):0===c&&r.markCurrentTitle(!1,o),void(d&&(c>=d?(a.addClass("reached-limit"),i.find(".metadata-checkbox:not(:checked)").attr("disabled","disabled").parent().addClass("disabled")):(a.removeClass("reached-limit"),i.find(".metadata-checkbox").removeAttr("disabled").parent().removeClass("disabled")))))}),o.on("change",".js-md-other-trigger",function(t){var n=e(this),i=n.closest(".metadata-other-wrapper").find("footer");n.prop("checked")?i.removeClass("hidden-md").find(".js-metadata-other").focus():i.addClass("hidden-md")}),o.on("blur",".js-metadata-other",function(t){var n=e(this);n.val().length?n.attr("name",n.data("field-name")):n.removeAttr("name")}))},markCurrentTitle:function(t,n){var i=e(".js-metadata-side-titles ."+n+"-side-title i"),r=e(".js-multi-pairs-hidden-input"),a=0;r.size()>0&&(e.each(r,function(t,n){e(n).val()&&a++}),t=a>=1?!0:!1),t?i.replaceWith('<i class="fa fa-check"></i>'):i.replaceWith("<i></i>")},hideSiblingSelectedOption:function(t){var n=e(t).closest(".fake-dropdown"),i=n.siblings(".fake-dropdown"),r=e(t).data("field-value");i.find("[data-field-value]").closest("li").show(),i.find('[data-field-value="'+r+'"]').closest("li").hide()},activateDropDown:function(t){var n=this,i=e(t).closest(".gig-meta-dd"),r=i.find(".dropdown-toggle"),a=i.data("field-name"),o=e('input[name="'+a+'"]'),s=i.find(".dropdown-menu .selected"),c=e(t).data("field-value"),d=e(t).text();return""!=o.val()&&o.val()!=c&&n.checkIfSelectAsStructuredExtras(o.val(),a)?!1:(o.val(c),r.html(d),s.length&&s.removeClass("selected"),e(t).addClass("selected"),n.hideSiblingSelectedOption(t),void n.markCurrentTitle(c,a.replace(/\[.*?\]/g,"")))},resetPairSelectedDropDown:function(t){var n=this,i=(n.selectors,n.models,t.find(".js-meta-data-dd").eq(0).data("field-name").slice(0,-3)),r=2*(t.closest(".multi-pairs-select").find(".multi-pairs-group").size()-1),a=t.html().replace(new RegExp(i+"\\[0\\]","g"),i+"["+r+"]").replace(new RegExp(i+"\\[1\\]","g"),i+"["+(r+1)+"]");t.html(a),t.find('input[type="hidden"]').val(""),t.find(".fake-dropdown a.dropdown-toggle").eq(0).text(e.t("manage_gigs.general.from_dots")),t.find(".fake-dropdown a.dropdown-toggle").eq(1).text(e.t("manage_gigs.general.to_dots")),t.find("a.selected").removeClass("selected"),t.find(".with-error").removeClass("with-error"),t.find(".fake-dropdown li").show()},checkIfSelectAsStructuredExtras:function(n,i){var r=_.findIndex(t.selectedExtras,{name:n,extended_id:i});if(-1!=r){if(confirm(e.t("manage_gigs.index.alerts.confirm_meta_change"))){var a=t.selectedExtras[r].eleIndex;return e('input[name="gig[gig_items_attributes]['+a+'][structured_extra][option_name]"]').val(""),e('input[name="gig[gig_items_attributes]['+a+'][structured_extra][extra_id]"]').val(""),e('input[name="gig[gig_items_attributes]['+a+'][structured_extra][display_name]"]').val(""),t.selectedExtras[r].dd.find(".dropdown-toggle").html("+ "+e.t("manage_gigs.form.labels.choose_type")),t.selectedExtras.splice(r,1),!1}return!0}return!1},updateMetaDataSelection:function(e,t,n,i){var r;switch(t){case"single_select":r=e.find(".gig-meta-dd"),r.find(".dropdown-toggle").text(i),r.find('input[type="hidden"]').val(n);break;case"multi_select":case"radio":r=e.find(':input[value="'+n+'"]'),"multi_select"===t?r.prop("checked",!0).removeAttr("disabled"):r.prop("checked",!0),r.trigger("change")}},bindMultiPairsEvents:function(){var t=this,n=(t.models,t.selectors);n.$form.on("click",".metadata-edit-row .js-add-language",function(n){var i=e(".js-metadata-edit"),r=i.find(".multi-pairs-group"),a=r.closest(".multi-pairs-select"),o=r.first().clone();n.preventDefault(),a.append(o),t.resetPairSelectedDropDown(o),o.find(".js-meta-data-dd").fakeDropdown({doPreventDefault:!0,specificWidth:93,onAction:function(e){t.activateDropDown(e)}})}),n.$form.on("click",".metadata-edit-row .js-remove-language",function(n){var i=e(this).closest(".multi-pairs-group").find(".fake-dropdown").eq(0).data("field-name").slice(0,-3);n.preventDefault(),e(this).closest(".multi-pairs-group").remove(),t.markCurrentTitle(!0,i)})},showDeniedGigsAlert:function(){var t=this,n=t.models;Fiverr.handlePageAlerts({$alertContainer:e(".js-denied-gig-page-alert"),autoShow:!0,escapeHTML:!1,prepend:!0,alertData:{content:'<h2 class="alt">'+n.gigs.deniedGigsAlert.title+"</h2> <p>"+n.gigs.deniedGigsAlert.text+"</p>",alertType:"error",showClose:!0,customClass:"denied-gig-page-alert"},onClose:function(){e.ajax({url:ft.utl.getRestfulUrl("/users/@user/manage_gigs/dismiss_deny_alert"),type:"post"})}})},initTimeline:function(){var n=e(".action-bar-gig"),i=t.timelineSteps;e.each(i,function(n,i){e("#gig-edit-"+i).length>0&&t.currentPageSteps.push(i)}),e.each(n.find(".step"),function(){var n=e(this).data("timeline");e.inArray(n,t.currentPageSteps)<0&&e(this).remove()}),e(document).on("click",".step.visited-step",function(){t.progressToSection(e(this).data("timeline"))}),n.removeClass("hidden")},progressTimeline:function(){var n=t.progressSteps[t.currentStep];if(n){var i=e(".action-bar-gig"),r="",a=i.find(".step.current-step"),o="step visited-step ca-green",s="step current-step visited-step ca-orange";if(e.inArray(n,t.currentPageSteps)>=0||"pre-video"==n||"pre-extras"==n){if("pre-video"==n&&(n="upload-video"),"pre-extras"==n&&(n="extras"),r=i.find('.step[data-timeline="'+n+'"]'),r.length>0)if(r.hasClass("visited-step"))i.find(".step h5").removeClass("with-arrow"),a.removeClass("ca-orange current-step").addClass("ca-green"),r.addClass("ca-orange current-step").find("h5").addClass("with-arrow");else{a.addClass("visited-step"),i.find(".step.visited-step").attr("class",o);var c=e.inArray(n,t.currentPageSteps);if(c>0)for(var d=i.find(".step"),l=0;c>l;l++)e(d[l]).attr("class",o);i.find(".step h5").removeClass("with-arrow"),i.find(".step.visited-step h5").addClass("with-check"),r.attr("class",s).find("h5").addClass("with-arrow")}if("general"==n){var u=e(".form-buttons.js-general");u.find('input[type="submit"]').removeClass("in-progress"),u.find(".sub-action").text("")}}}},showSection:function(t){var n=this,i=(n.models,n.selectors);if(t.length){var r=t.data("action"),a=t.data("action-text"),o=t.data("hide-sub-action");r&&n.toggleActionBtn(r,a,o),n.progressTimeline(),Fiverr.mainWrapperPush(),e(document).scrollTo({top:"0",left:"0"},800),t.hide().removeClass("hidden").fadeIn(),i.$form.slideDown()}else i.$form.slideDown(),n.progressStep(1)},hideSection:function(t,n){var i=this,r=(i.models,i.selectors);t.length?(t.fadeOut(function(){e(this).addClass("hidden"),n&&n()}),r.$form.slideUp()):n&&n(),e(".js-page-alert-wrap").remove()},bindFormProgressActions:function(){e("form.edit-gig .js-skip").on("click",function(e){t.progressStep(2),e.preventDefault()}),e("form.edit-gig .js-skip-one").on("click",function(e){t.progressStep(1),e.preventDefault()}),e("form.edit-gig .js-back").on("click",function(e){t.progressStep(-1),e.preventDefault()}),e("form.edit-gig .js-finish").on("click",function(e){t.execLastStep(),e.preventDefault()})},initShippingActions:function(){var t=e(".js-gig-shipping-dropdown");e(document).on("change",".js-shipping-checkbox",function(){e(this).is(":checked")||t.not('[data-field-name="gig[local_shipping_country]"]').find("li:first > a").trigger("click")})},toggleActionBtn:function(t,n,i){i=null!=i?i:!1;var r=this,a=(r.models,r.selectors),o=e.t("manage_gigs.form.buttons.save_continue"),s=r.progressSteps[r.currentStep],c=a.$form.find(".js-form-button.js-"+s);_.has(window,"fGigsUpcrate")&&(c=a.$form.find(".form-buttons.js-next-back"),o=e.t("manage_gigs.form.buttons.save")),_.isEmpty(c)&&(c=a.$form.find(".form-buttons.submit-buttons")),a.$form.find(".js-form-button").addClass("hidden"),n&&c.find('input[type="submit"]').val(n),"in-progress"===t&&(c.find('input[type="submit"]').addClass("in-progress disabled"),c.find(".sub-action").text(n)),"normal"===t&&(c.find('input[type="submit"]').removeClass("in-progress disabled").val(o),c.find(".sub-action").text("")),"saved"===t&&(c.find('input[type="submit"]').removeClass("in-progress disabled").val(o),c.find(".sub-action").hide().text(e.t("manage_gigs.form.buttons.changes_saved")).fadeIn("fast"),_.delay(function(){c.find(".sub-action").fadeOut("fast",function(){e(this).text("").show()})},2500)),i?c.find(".sub-action").hide():c.find(".sub-action").show(),c.removeClass("hidden")},bindGigShippingDropDown:function(){e.each(e(".js-gig-shipping-dropdown"),function(){var t=this,n=e(t);Fiverr.initfakeDropdownReal(t,function(t){var i=n,r=i.find(".dropdown-toggle"),a=i.data("field-name"),o=e('input[name="'+a+'"]'),s=e(t).data("field-value"),c=e(t).text();o.val(s),r.html(c)})})},getSelectedSubCategoryName:function(){return e(".js-subcategories-wrapper .dropdown-toggle").text().trim()},bindBlurOnGigText:function(){var t=this,n=t.selectors.$form.find(".gig-title-text");n.on("blur",function(){MixpanelWrapper.trackEvent(MixpanelWrapper.Events.GigUpCreateEvents.FINISHED_EDITING_GIG_TITLE_IN_GIG_CREATE_FLOW,{"Sub-category":t.getSelectedSubCategoryName(),"Service Type":e(".js-gig-edit-service-type .dropdown-toggle").text().trim()})})},bindGigDurationDropDown:function(){Fiverr.initfakeDropdownReal(".gig-duration-dropdown",function(t){var n=e(".gig-duration-dropdown"),i=n.find(".dropdown-toggle"),r=n.data("field-name"),a=e('input[name="'+r+'"]'),o=e(t).data("field-value"),s=e(t).text();a.val(o),i.html(s),e(".js-expected-gig-duration").text(o),e(".js-packages-expected-duration").fakeDropdown("val",o.toString())});var t=e(".gig-duration-dropdown .dropdown-menu");t.innerHeight()>350&&t.css({maxHeight:350,"overflow-y":"scroll"})},insertCategoriesSuggestions:function(){var n=this,i=n.models,r=n.selectors,a=e('textarea[name="gig[title]"]');return i.gigs.categoriesSuggestions.subCategoriesSuggestionInProgress?!1:(i.gigs.categoriesSuggestions.subCategoriesSuggestionInProgress=!0,void e.getJSON(i.ps.category_suggestion_url,{gig_title:a.val()}).success(function(e){if(e&&e.suggestions&&e.suggestions.length&&!i.proChecked){r.$form.find(".gig-edit-suggestions-wrapper").removeClass("hidden");var n=_.reject(e.suggestions,function(e){return t.getSubCatClassName({id:e.sub_category_id})});t.populateCategorySuggestions(n)}}).done(function(){i.gigs.categoriesSuggestions.subCategoriesSuggestionInProgress=!1}))},populateCategorySuggestions:function(t){var n=this,i=n.models,r=(n.selectors,e(".gig-edit-suggestions")),a=e('input[name="suggestions"]'),o=e('input[name="user_received_suggestions"]'),s=i.gigs.categoriesSuggestions.subCategories,c=0;r.empty();var d=function(t,n,i,r,a){return e('<a href="#!" data-index="'+t+'" class="gig-edit-suggestion js-choose-category" cat-id="'+n+'"sub-cat-id="'+r+'" sub-cat-name="'+a+'">'+i+" > "+a+"</a>")};_.each(t,function(t,n){var a=d(n,t.category_id,t.category_title,t.sub_category_id,t.sub_category_title),o=t.nested_sub_categories||[];s[t.category_id+"_"+t.sub_category_id]=t.all_sub_categories,_.each(o,function(t,n){_.each(t,function(t,r){t.unshift({val:0,text:e.t("manage_gigs.form.placeholders.service_type")}),i.nestedServiceTypes[n]=i.nestedServiceTypes[n]||{},i.nestedServiceTypes[n][r]=t})}),r.append(a),_.delay(function(){a.addClass("shown")},80*c++)}),e(".js-choose-category").on("click",n.chooseSuggestedCategorySubCategory),o.val("true"),a.val(_.map(t,function(e){return e.category_id+"|"+e.sub_category_id}))},getCatTypeClassName:function(e,t){if(document.in_studio_gig_flow)for(var n=_.keys(t),i=0;i<n.length;i++){var r=n[i];if(_.includes(t[r],e.id))return r}return""},getSubCatClassName:function(e){return this.getCatTypeClassName(e,t.models.gigs.omitSubCatsFromStudio)},getCatClassName:function(e){return this.getCatTypeClassName(e,t.models.gigs.omitCatsFromStudio)},chooseSuggestedCategorySubCategory:function(n){var i=t.models,r=t.selectors,a=e(n.target),o=r.$catsWrapper,s=r.$subCatsWrapper,c=i.gigs.categoriesSuggestions.subCategories,d=parseInt(a.attr("cat-id"),10),l=parseInt(a.attr("sub-cat-id"),10),u=[],g=_.get(s,"[0].innerText"),p=parseInt(a.attr("data-index"),10);MixpanelWrapper.trackEvent(MixpanelWrapper.Events.GigUpCreateEvents.CLICKED_ON_SUGGESTED_CATEGORY,{"Sub-category":g,"Suggestion Position":p+1}),o.fakeDropdown("valNoAction",d),u=_.map(c[a.attr("cat-id")+"_"+a.attr("sub-cat-id")],function(e){return{text:e.name,attrs:'data-field-value="'+e.id+'" class="'+t.getSubCatClassName(e)+'"',val:e.id}}),i.subCatOptions=u,s.empty(),s.fakeDropdown({classes:"js-gig-edit-subcat",initial:{text:a.attr("sub-cat-name"),id:l},options:i.subCatOptions,createHiddenInput:!0,doPreventDefault:!0,onAction:t.onSubcategoryClicked,hiddenInputName:"gig[sub_category_id]"}),s.fakeDropdown("val",l)},onSubcategoryClicked:function(n,i,r){var a=t,o=e(n).data("field-value"),s=e(n).text(),c=s.trim();parseInt(e('input[name="gig[category_id]"]').val(),10);r.catName!==c&&(a.reportGigChange({subCategoryId:o,nestedSubCategoryId:null}),MixpanelWrapper.trackEvent(MixpanelWrapper.Events.GigUpCreateEvents.SELECTED_SUBCATEGORY_IN_GIG_CREATE_FLOW,{"Selected Sub-category":c,"Previous Sub-category":r.catName})),i.html(s),a.doMetaData(o),a.initPricing(o),a.hideShipping(o),document.pageScope.hasServiceType=!1,a.initNestedSubCategory(n)},initNestedSubCategory:function(n){var i=this,r=i.selectors,a=t.models,o=e(n).data("field-value"),s=e(".js-box-service-types"),c=e(".js-service-types-wrapper"),d=e('input[name="gig[service_type_id]"]'),l=e('input[name="gig[category_id]"]').val();s.addClass("hidden"),c.empty(),d.val(""),a.nestedServiceTypes&&a.nestedServiceTypes[l]&&!_.isEmpty(a.nestedServiceTypes[l][o])&&(s.removeClass("hidden"),c.fakeDropdown({classes:"js-gig-edit-service-type",initial:{text:e.t("manage_gigs.form.placeholders.service_type"),id:0},options:a.nestedServiceTypes[l][o],createHiddenInput:!0,doPreventDefault:!0,onAction:function(n,i,r){var a=e(n).text().trim(),s=e(n).data("val");a!==r.catName&&t.reportGigChange({nestedSubCategoryId:s||null}),e.isNumeric(s)?t.initPricing(o,s):t.initPricing(o)},hiddenInputName:"gig[service_type_id]"}),i.handleProCats({},r.$nestedSubCatsWrapper))},bindCategoryDropDown:function(){var n=this,i=n.models,r=n.selectors,a=[],o=[],s=document.pageScope.categories,c=document.pageScope.subcategories,d=function(i,r,a){var o=e(i).data("field-value"),s=e(i).text();n.reportGigChange({categoryId:o,subCategoryId:null,nestedSubCategoryId:null}),MixpanelWrapper.trackEvent(MixpanelWrapper.Events.GigUpCreateEvents.SELECTED_CATEGORY_IN_GIG_CREATE_FLOW,{"Selected Category":s.trim(),"Previous Category":a.catName}),r.html(e(i).text()),t.loadSubCategories(o,s),t.initNestedSubCategory(i)};s&&s.list.length&&(_.map(s.list,function(e,n){a.push({text:e.name,attrs:'data-field-value="'+e.id+'" class="'+t.getCatClassName(e)+'"',val:e.id})}),r.$catsWrapper.fakeDropdown({initial:{text:s.initial,val:s.initial_id},options:a,createHiddenInput:!0,doPreventDefault:!0,onAction:d,hiddenInputName:"gig[category_id]"}),n.handleProCats(i.ps.pro_categories,r.$catsWrapper)),c&&c.list.length&&(_.map(c.list,function(n,r){o.push({text:n.name,attrs:'data-field-value="'+n.id+'" class="'+t.getSubCatClassName(n)+'"',val:n.id}),i.subCatOptions=o,_.isEmpty(n.nested_sub_categories)||(n.nested_sub_categories=_.sortBy(n.nested_sub_categories,"text"),n.nested_sub_categories.unshift({val:"0",text:e.t("manage_gigs.form.placeholders.service_type")}),i.nestedServiceTypes[i.ps.categories.initial_id]=i.nestedServiceTypes[i.ps.categories.initial_id]||{},i.nestedServiceTypes[i.ps.categories.initial_id][n.id]=n.nested_sub_categories);}),r.$subCatsWrapper.fakeDropdown({initial:{text:c.initial,val:c.initial_id},options:i.subCatOptions,autoWidth:!0,createHiddenInput:!0,doPreventDefault:!0,onAction:t.onSubcategoryClicked,hiddenInputName:"gig[sub_category_id]"}),c.initial_id&&r.$subCatsWrapper.fakeDropdown("val",c.initial_id),n.handleProCats(i.ps.pro_subcategories,r.$subCatsWrapper)),i.should_lock_gig_categories&&(r.$catsWrapper.fakeDropdown("disable"),r.$subCatsWrapper.fakeDropdown("disable"),r.$suggestedCategoriesWrapper.addClass("disabled"));var l=(e('input[name="gig[service_type_id]"]'),e('input[name="gig[sub_category_id]"]')),u=e('input[name="gig[category_id]"]');c&&c.list.length&&(_.isEmpty(l)||_.isEmpty(i.nestedServiceTypes[u.val()])||_.isEmpty(i.nestedServiceTypes[u.val()][l.val()])||(r.$subCatsWrapper.fakeDropdown("val",c.initial_id),c.initial_nested_sub_cat_id&&e(".js-service-types-wrapper").fakeDropdown("val",c.initial_nested_sub_cat_id)))},initPricing:function(t,n){var i,r=this,a=r.models,o=r.selectors,s="/manage_gigs/gig_pricing",c=/((upgrades\.)|(extra_fast\.)|(upgrades_per_package\.)).+\.isRecommendedToFill/,d=0,l=0,u=[],g=a.ps.hasServiceType;if(1!=g||!_.isUndefined(n)){a.subCatID=parseInt(t,10),durationOptionSelected={text:e.t("general.select"),val:0},o.$gigExtraSection=e(".js-upgrades"),u.push(durationOptionSelected);for(var p=1;14>=p;p++)u.push({text:p+" "+e.t("general.days"),val:p});t&&(s+="?sub_cat_id="+t),n&&e.isNumeric(n)&&(s+="&service_type_id="+n,e(".js-reload-packages").removeClass("hidden").find(".icn-refresh").addClass("spinning")),document.pageScope.gigId&&(s+=t?"&":"?",s+="gig_id="+document.pageScope.gigId),document.in_standard_packages_rollout&&(s+="&include_constraints=true"),o.$pricingFactors||(o.$pricingFactors=e(".js-pricing-factors")),e.getJSON(s,function(t){var t=window.StandardGigsPricing.applyConstraints(t,{gig_pricing_request:s}),n=_.some(window.StandardGigsPricing.commits,function(e,t){var n=c.test(t);return n&&e.state===!0});e(".js-extra-pricing-education-banner").toggleClass("hidden",!n),a.pricingFactors={},a.gig_pricing=e.extend(!0,{},t),a.pricingFactors.customExtrasLength=e(".js-gig-extra").length,a.pricingFactors.durationOptionSelected=durationOptionSelected,i="",a.custom_extras=t.custom_extras,a.show_new_custom_extras_for_seller=t.show_new_custom_extras_for_seller,a.can_assign_extras_to_packages=t.can_assign_extras_to_packages;var g,p="gig_upcrate::voiceover_pricing",f={detail:_.set(t,"isVoiceOver",16===a.subCatID)};"function"==typeof window.CustomEvent?g=new CustomEvent(p,f):(g=document.createEvent("CustomEvent"),g.initCustomEvent(p,!1,!1,f.detail)),document.dispatchEvent(g),t.basic_offer||(r.renderCustomGigExtra(),o.$pricingFactors.empty(),Fiverr._logEventToGraphite({label:"gig_upcrate_refactor.dead_code.pricingMode."+t.mode,value:1,percentage:100}),"packages"===t.mode?(o.$gigExtraSection.find("header h2").text(e.t("manage_gigs.form.my_packages_extras")),o.$gigExtraSection.find("header h4").remove(),o.$gigExtraSection.find("header h2").after("<h4>"+e.t("manage_gigs.form.my_packages_extras_sub_title")+"</h4>")):(o.$gigExtraSection.find("header h2").text(e.t("manage_gigs.form.my_gig_extras")),o.$gigExtraSection.find("header h4").remove()),t.upgrades&&(t.pricing_points=r.reformatDataForFakeDropdown(t.pricing_points),t.pricing_points.unshift(a.fddPriceDefault),d=a.pricingFactors.customExtrasLength,_.forEach(t.upgrades,function(n,a){n.price&&(l=parseInt(n.price.substr(1,n.price.length-1))),e.extend(n,{currentIndex:++d,minWidth:50,options:t.pricing_points,initial:_.find(t.pricing_points,{val:l}),durationOptions:u}),i+=r.loadPricingFactorsTmpl(n)}),o.$pricingFactors.html(i),r.pricingFactorsComponents(t))),t.needs_migration?setTimeout(function(){!ft.utl.getLS("show_vo_migration_message-"+document.pageScope.gigId)&&r.handleVoiceOverMigration()},100):e(".js-migration-message").remove(),t.packages||t.basic_gig||t.basic_offer?(a.gigPackages=t,r.models.packagesManagerLoaded?fPackagesEdit.init():fLoader({load:["//assetsv2.fiverrcdn.com/assets/packages-edit-90cbe030a730055fc673f66bd2d45f6c.js"],complete:function(){r.models.packagesManagerLoaded=!0,fPackagesEdit.init()}})):a.gigPackages=!1,a.extraFastRandInd=8765,"packages"===t.mode&&t.extra_fast&&r.initPackagesExtraFast(),t.upgrades_per_package&&!t.basic_offer&&r.renderUpgradesPerPackage(),r.initProPricing()}).error(function(){o.$pricingFactors.empty(),r.showErrorPage()})}},handleVoiceOverMigration:function(){var t=e(".basic-offer-container"),n=e(".js-top-header"),i=t.find(".js-words-included"),r=t.find(".js-additional-words"),a=t.find(".js-additional-words-price"),o=t.find(".js-delivery-time-words"),s=t.find(".js-delivery-additional-words"),c=t.find(".js-delivery-time-duration"),d="<h3>"+e.t("manage_gigs.edit.basic_offer.migration.header")+"</h3>",l="<p>"+e.t("manage_gigs.edit.basic_offer.migration.content")+"</p>";n.find(".js-migration-message").length||(Fiverr.handlePageAlerts({$alertContainer:n,autoShow:!0,escapeHTML:!1,alertData:{customClass:"js-migration-message",content:d+l,alertType:"warning",showClose:!0}}),!i.val()&&i.addClass("with-warning"),!r.val()&&r.addClass("with-warning"),!parseInt(a.val(),10)&&a.addClass("with-warning"),!o.val()&&o.addClass("with-warning"),!s.val()&&s.addClass("with-warning"),!parseInt(c.val(),10)&&c.addClass("with-warning"))},renderUpgradesPerPackage:function(){var t,n=this,i=n.models,r=n.selectors,a=1e5,o=e.extend(!0,{},i.gig_pricing);return o.upgrades_per_package?(_.each(o.upgrades_per_package,function(e,t){var n=0;(1===o.active_packages_count||0===o.active_packages_count)&&o.upgrades_per_package[t].values.splice(1),_.each(e.values,function(e,i){o.upgrades_per_package[t].values[i].packageId=i+1,parseFloat(e.active,10)&&(n=1)}),o.upgrades_per_package[t].active=n,o.upgrades_per_package[t].randInd=a+t,o.upgrades_per_package[t].upgradeSpecificSeelctorName="js-upgrade-"+e.type.replace(/_/g,"-")}),t=Fiverr._getHbTemplate({tplType:"dashboard-new",tplName:"upgrades-per-package",tplData:{data:o,standardEnforcement:window.StandardGigsPricing.enforceClass}}),r.$gigExtraSection.find(".js-upgrades-per-package").remove(),r.$gigExtraSection.find("> header").after(t),void n.renderDdUpgradesPerPackage(o)):!1},renderDdUpgradesPerPackage:function(t){var n=this,i=n.models,r=n.selectors,a=r.$form.find(".js-upgrades-per-package");a.find(".js-fdd-price").each(function(){var r=e(this),a=r.data("selected-val")||t.pricing_points[0].val,o=r.data("randind"),s=r.data("package-id");i.isPro?r.addClass("js-price-round").html(n.returnProInp({inpType:"number",step:"5",max:"2000",classes:"input-wrap pro-price-input js-force-digits",name:"gig[packages]["+s+"][upgrades_per_package]["+o+"][price]",initVal:r.data("selected-val")||""})).prepend("$"):r.fakeDropdown({doPreventDefault:!0,createHiddenInput:!0,initial:_.find(t.pricing_points,{val:a})?_.find(t.pricing_points,{val:a}):_.find(t.pricing_points,{text:a}),specificWidth:50,maxHeight:200,hiddenInputName:"gig[packages]["+s+"][upgrades_per_package]["+o+"][price]",options:t.pricing_points})}),a.each(function(){e(this).find(".js-fdd-unit").each(function(n){var i,r=e(this),a=r.data("randind"),o=r.data("package-id"),s=r.closest(".js-upgrades-per-package").data("item-id"),c=t.upgrades_per_package[s].values[n].data_options,d={val:"0",value:"0",text:e.t("general.select")};c.unshift(d),i=parseFloat(r.data("selected-val"),10)||c[0].val,r.fakeDropdown({doPreventDefault:!0,createHiddenInput:!0,initial:_.find(c,{val:i})||d,autoWidth:!0,hiddenInputName:"gig[packages]["+o+"][upgrades_per_package]["+a+"][pricing_factor][data_value]",options:c,onAction:function(t){var n=e(t),i=n.data("val"),r=parseFloat(i,10)?1:0;n.closest(".upgrades-per-package-item").find(".js-upgrades-package-active").val(r)}})})})},renderCustomGigExtra:function(){var e,t=this,n=(t.models,t.selectors);n.$customExtraWrapper=n.$form.find(".js-custom-extra-wrapper"),e=t.customExtraModel(),result=Fiverr._getHbTemplate({tplType:"dashboard-new",tplName:"custom-extra",tplData:e}),n.$customExtraWrapper.html(result),fGigsUpcrate.bindGigsExtraTitleCounter(),t.renderCustomGigFdd(),_.has(window,"fGigsUpcrate")&&fGigsUpcrate.bindTranslationExtraTextWidth()},customExtraModel:function(){var e,t=this,n=t.models,i=(t.selectors,0);if(!n.gig_pricing.upgrades||!n.custom_extras)return!1;e=n.gig_pricing.upgrades.length+n.custom_extras.length+1;for(var r=0;r<n.custom_extras.length;r++)n.custom_extras[r].currentIndex=e,e++,n.custom_extras[r].is_blank&&i++;return{custom_extras:n.custom_extras,isAddCustomExtraVisible:i?!0:!1,newCustomExtra:n.show_new_custom_extras_for_seller,assignPackages:n.can_assign_extras_to_packages}},modelCustomGigFdd:function(){var t,n,i=this,r=i.models,a=(i.selectors,[]);if(r.gig_pricing)n=r.gig_pricing.pricing_points;else{if(!r.gig_attributes)return!1;n=r.gig_attributes.pricing_points}if(!n)return!1;a.push({val:"0",text:e.t("general.select")}),a.push({val:"0",text:e.t("general.none")});for(var o=1;14>=o;o++)a.push({val:o.toString(),text:e.t("general.num_days",{count:o})});return n=i.reformatDataForFakeDropdown(n),n.unshift(r.fddPriceDefault),t={priceOptions:n,expectedDurationOptions:a}},renderCustomGigFdd:function(){var t,n=this,i=n.models,r=n.selectors;return r.$customExtraWrapper=e(".js-custom-extra-wrapper"),t=n.modelCustomGigFdd(),t&&"undefined"!=typeof r.$customExtraWrapper?(_.each(r.$customExtraWrapper.find(".js-fdd-price"),function(r,a){var o,s=e(r),c=s.closest(".js-gig-extra").data("extras-count"),d=_.find(t.priceOptions,{val:s.data("initial-price")});i.isPro?(o=s.data("initial-price")?s.data("initial-price").toString():"",s.addClass("js-price-round").html(n.returnProInp({inpType:"number",step:"5",max:"2000",classes:"pro-price-input js-force-digits",name:"gig[gig_items_attributes]["+c+"][price]",initVal:o})).prepend("$")):s.fakeDropdown({doPreventDefault:!0,createHiddenInput:!0,initial:d,specificWidth:50,maxHeight:200,hiddenInputName:"gig[gig_items_attributes]["+c+"][price]",options:t.priceOptions})}),void _.each(r.$customExtraWrapper.find(".js-fdd-duration"),function(n,i){var r=e(n),a=r.closest(".js-gig-extra").data("extras-count"),o=r.data("initial-expected-duration").toString(),s=_.find(t.expectedDurationOptions,{val:o})||t.expectedDurationOptions[0];r.fakeDropdown({doPreventDefault:!0,createHiddenInput:!0,initial:s,specificWidth:50,maxHeight:200,hiddenInputName:"gig[gig_items_attributes]["+a+"][expected_duration]",options:t.expectedDurationOptions,onAction:function(e,t){var n=t.closest(".js-gig-extra").find(".js-extra-checkbox");n.val(1),n.prop("checked",1)}})})):!1},initPackagesExtraFast:function(){var t,n,i,r,a=this,o=a.models,s=a.selectors,c=e.extend(!0,{},o.gig_pricing),d=s.$form.find(".js-extra-fast"),l=["a","b","c"];if(!c.basic_offer){c.pricing_points=a.reformatDataForFakeDropdown(c.pricing_points),(1===c.active_packages_count||0===c.active_packages_count)&&c.extra_fast.splice(1);for(var u=0;u<=c.extra_fast.length-1;u++)c.extra_fast[u].packageName=l[u],c.extra_fast[u].packageId=u+1,c.extra_fast[u].packageTitle=e.t("manage_gigs.edit.gig_and_packages.package_"+(u+1)),parseInt(c.extra_fast[u].active,10)&&(t=1);i=_.find(c.extra_fast,{active:"1"})||c.extra_fast[0],c.basicExtraFast={extra_id:i.extra_id,type:i.type,active:t,price:i.price,expected_duration:i.expected_duration,randInd:o.extraFastRandInd},r=Fiverr._getHbTemplate({tplType:"dashboard-new",tplName:"packages-extra-fast",tplData:c}),d.length||(d=e(".js-extra-fast.packages")),d.replaceWith(r),n=e(".js-extra-fast.packages"),$eachExtraFastActive=e('.js-extra-fast.packages [name="gig[packages][1][content]['+o.extraFastRandInd+'][active]"], .js-extra-fast.packages [name="gig[packages][2][content]['+o.extraFastRandInd+'][active]"], .js-extra-fast.packages [name="gig[packages][3][content]['+o.extraFastRandInd+'][active]"]'),n.on("click",".js-extra-checkbox",function(e){var t=s.$gigExtraSection.find(".js-basic-extra-fast-active"),i=n.hasClass("open");i?(n.removeClass("open"),$eachExtraFastActive.val(0),t.val(0)):(n.addClass("open"),a.updateEachExtraFastActive(),a.updateBasicExtraFastActive())}),a.renderExtraFastFdd(c.extra_fast,c.pricing_points),a.updateBasicExtraFastActive()}},renderExtraFastFdd:function(t,n){var i=this,r=i.models,a=(i.selectors,[]),o=e(".js-extra-fast.packages .upgrades-per-package-list > li"),s=o.length?o:e(".js-upgrades .js-extra-fast");a.push({val:null,text:e.t("general.select")});for(var c=t[0].duration_limit.min;c<=t[0].duration_limit.max;c++)a.push({val:c.toString(),text:e.t("general.num_days",{count:c})});s.each(function(o,s){if(!t[o])return!1;var c="packages"===r.gigPackages.mode?"gig[packages]["+t[o].packageId+"][content]["+r.extraFastRandInd+"][expected_duration]":"gig[gig_items_attributes]["+r.extraFastRandInd+"][expected_duration]",d="packages"===r.gigPackages.mode?"gig[packages]["+t[o].packageId+"][content]["+r.extraFastRandInd+"][price]":"gig[gig_items_attributes]["+r.extraFastRandInd+"][price]";if(e(s).find(".js-fdd-duration").fakeDropdown({doPreventDefault:!0,createHiddenInput:!0,specificWidth:50,initial:_.find(a,{val:t[o].expected_duration})||{text:e.t("general.select"),val:0},hiddenInputName:c,options:a,onAction:function(t){var n,r=e(t),a=parseInt(r.data("val"),10),o=r.closest(".fdd").closest("li").find(".js-extra-fast-active");a>0?o.val(1):o.val(0),i.updateBasicExtraFastActive(),n=e(t).closest(".upgrades-per-package-list").find('.js-extra-fast-active[value="1"]').closest(".upgrades-per-package-item").find(".js-fdd-duration [type=hidden]").first(),e(t).closest(".js-extra-fast.packages").find(".js-package-extra-fast-duration").val(n.val())}}),r.isPro){var l=t[o].price?t[o].price.toString():"";e(s).find(".js-fdd-price").addClass("js-price-round").html(i.returnProInp({inpType:"number",step:"5",max:"2000",classes:"input-wrap pro-price-input js-force-digits",name:d,initVal:l})).prepend("$"),i.initProPricing()}else e(s).find(".js-fdd-price").fakeDropdown({doPreventDefault:!0,createHiddenInput:!0,specificWidth:50,classes:"price-wrapper",initial:_.find(n,{val:t[o].price})||{text:"$",val:""},hiddenInputName:d,maxHeight:200,options:n,onAction:function(t){$hiddenPriceInput=e(t).closest(".upgrades-per-package-list").find('.js-extra-fast-active[value="1"]').closest(".upgrades-per-package-item").find(".js-fdd-price [type=hidden]").first(),e(t).closest(".js-extra-fast.packages").find(".js-package-extra-fast-price").val($hiddenPriceInput.val())}})})},updateBasicExtraFastActive:function(){var t=this,n=t.models,i=(t.selectors,e(".js-extra-fast.packages").find('[name="gig[packages][1][content]['+n.extraFastRandInd+'][active]"], [name="gig[packages][2][content]['+n.extraFastRandInd+'][active]"], [name="gig[packages][3][content]['+n.extraFastRandInd+'][active]"]')),r=e(".js-extra-fast.packages .js-basic-extra-fast-active");i.each(function(t,n){return $activeInput=e(this),parseInt($activeInput.val(),10)?(r.val(1),!1):void r.val(0)})},updateEachExtraFastActive:function(){var t=this;t.models,t.selectors;e(".js-extra-fast.packages .upgrades-per-package-list > li").each(function(t,n){var i=e(this),r=i.find(".js-extra-fast-active"),a=i.find('.js-fdd-duration [type="hidden"]');parseInt(a.val(),10)>0?r.val(1):r.val(0)})},loadPricingFactorsTmpl:function(t){var n,i=this,r=i.models,a=(i.selectors,"pricing-factor-generic");return t.typeAsCssClass=t.type.replace(/_/g,"-"),_.includes(["stock_image","modifications"],t.type)&&(a="pricing-factor-"+t.type.replace(/_/g,"-")),"commercial_use"===t.type&&(r.isCommercialUse=!0,t.link=document.pageScope.commercialUseReadMore),"stock_image"===t.type&&(r.isStockImage=!0,t.videoThumbnail="//assetsv2.fiverrcdn.com/assets/v2_photos/packages-video-4f6293807f749882bc033eafc7faec63.jpg"),t.subcatId=e('[name="gig[sub_category_id]"]').val(),t.standardEnforcement=window.StandardGigsPricing.enforceClass,n=Fiverr._getHbTemplate({tplType:"dashboard",tplName:a,tplData:t}),n||""},onPricingFactorModified:function(t){var n=e(t).closest(".gig-pricing-factor").find('input[type="checkbox"].js-extra-checkbox');n.prop("checked")||(n.prop("checked",!0),n.trigger("change"))},pricingFactorsComponents:function(t){var n,i,r,a=this,o=a.models,s=a.selectors,c=o.pricingFactors.customExtrasLength;_.each(t.upgrades,function(t,d){var l=s.$gigExtraSection.find("."+t.type.replace(/_/g,"-")+"-factor"),u=l.find(".js-fdd");c++,u.length&&_.forEach(u,function(s,d){i=e(s).data("fdd-data-name"),r=e(s).data("fdd-selected-data-name"),o.isPro&&"price"===r?e(s).addClass("js-price-round").html(a.returnProInp({inpType:"number",step:"5",max:"2000",classes:"input-wrap pro-price-input js-force-digits",name:"gig[gig_items_attributes]["+c+"]["+r+"]",initVal:"price"===r?t.display_price:t[r]})).prepend("$"):(n="price"===r?_.find(t[i],{text:t.display_price})?_.find(t[i],{text:t.display_price}):{text:"$",val:""}:_.find(t[i],{val:t[r]})||o.pricingFactors.durationOptionSelected,e(s).fakeDropdown({doPreventDefault:!0,createHiddenInput:!0,initial:n,hiddenInputName:"gig[gig_items_attributes]["+c+"]["+r+"]",options:t[i],maxHeight:200,onAction:a.onPricingFactorModified}))})}),s.$pricingFactors.find(".js-extra-checkbox").on("change",function(t){var n=e(this),i="1"===n.val();i?(n.removeAttr("checked").val("0"),n.closest("label").find("input[type=hidden]").val("0")):(n.attr("checked","checked").val("1"),n.closest("label").find("input[type=hidden]").val("1"))}),s.$pricingFactors.find(".js-extra-checkbox").on("change",function(n){var i=e(this),r=i.closest(".gig-pricing-factor").data("meta-data-id"),o=e("."+r+"-wrapper"),s=e("."+r+"-side-title"),c=i.closest(".gig-pricing-factor").data("pricing-factor-type"),d=_.find(t.upgrades,_.matchesProperty("type",c));"undefined"!=typeof d&&(parseFloat(i.val(),10)?(a.updateMetaDataSelection(o,s.data("component-type"),d.related_metadata_name,d.title),e(s).find("i").replaceWith('<i class="fa fa-check"></i>')):(o.find(':input[value="'+d.related_metadata_name+'"]').prop("checked",!1),e(s).find("i").replaceWith("<i></i>")))})},updateUpgradesPricingFactorState:function(t){var n=this,i=(n.models,fPackagesEdit.getActivePackagesCount()),r=(fPackagesEdit.getAllPackages(),[]),a=0,o=e(".js-upgrades .js-pricing-factors");if(3!==i&&"1"==fPackagesEdit.getPricingFactor({factorType:t,packageIndex:0}).active)a=3;else for(var s=0;2>=s;s++)r.push(fPackagesEdit.getPricingFactor({factorType:t,packageIndex:s})),"undefined"!=typeof r[s].active&&"1"==r[s].active&&a++;if(t=t.replace(/_/g,"-")+"-factor",3===a){var c=o.find("."+t),d=c.find("input[type=checkbox]");c.addClass("hide"),d.is(":checked")&&d.click()}else o.find("."+t).removeClass("hide")},doMetaData:function(t){var n=this,i=n.models,r=(n.selectors,e(".metadata-edit-row")),a="/manage_gigs/gig_attributes?sub_cat_id="+t;r.length&&(document.pageScope.gigId&&(a+="&gig_id="+document.pageScope.gigId),e.getJSON(a,function(t){i.gig_attributes=t,t.extended&&t.extended.length?n.bindMetaData(t.extended):(r.addClass("metadata-hidden"),e(".js-metadata-edit").html("")),n.renderCustomGigFdd()}).error(function(){n.showErrorPage()}))},loadSubCategories:function(n,i){var r,a=this,o=a.models,s=a.selectors,c=s.$subCatsWrapper,d=c.find(".dropdown-menu"),l=e('input[name="gig[sub_category_id]"]'),u=e(".js-box-service-types"),g=e(".js-service-types-wrapper"),p=e('input[name="gig[service_type_id]"]'),f={},m=function(n,i,o){var c=e(n),d=c.text(),l=d.trim(),m=parseInt(e('input[name="gig[category_id]"]').val(),10);o.catName!==l&&MixpanelWrapper.trackEvent(MixpanelWrapper.Events.GigUpCreateEvents.SELECTED_SUBCATEGORY_IN_GIG_CREATE_FLOW,{"Selected Sub-category":l,"Previous Sub-category":o.catName}),r=c.data("field-value"),a.reportGigChange({subCategoryId:r,nestedSubCategoryId:null}),i.html(d),isNaN(m)||fPopupExamples.refreshPopup(m,r),t.doMetaData(r),t.initPricing(r),t.hideShipping(r),u.addClass("hidden"),g.empty(),p.val(""),f[m]&&!_.isEmpty(f[m][r])&&(u.removeClass("hidden"),g.fakeDropdown({classes:"js-gig-edit-service-type",initial:{text:e.t("manage_gigs.form.placeholders.service_type"),id:0},options:f[m][r],createHiddenInput:!0,doPreventDefault:!0,onAction:h,hiddenInputName:"gig[service_type_id]"}),a.handleProCats({},s.$nestedSubCatsWrapper))},h=function(n,i,o){var s=e(n).text().trim(),c=e(n).data("val");s!==o.catName&&a.reportGigChange({nestedSubCategoryId:c||null}),_.isNumber(c)?t.initPricing(r,c):t.initPricing(r)};return l.attr("data-no-sub-cat","false"),c.empty().closest(".input-wrap").addClass("loading"),""==n||isNaN(n)||11==n?(c.closest(".input-wrap").removeClass("loading"),l.attr("data-no-sub-cat","true").val(""),!1):void e.ajax({dataType:"json",cache:!1,url:"/categories/"+n+"/sub_categories",error:function(e,t,n){},success:function(n){var i=0,r=[],s=n;d.html(""),d.siblings(".dropdown-toggle").attr("data-min-width","160").text(e.t("manage_gigs.form.placeholders.subcategory")),c.closest(".input-wrap").removeClass("loading"),s.length&&(_.map(s,function(n,a){r.push({text:n.sub_category.name,attrs:'data-field-value="'+n.sub_category.id+'" class="'+t.getSubCatClassName(n.sub_category)+'"',val:n.sub_category.id}),o.subCatOptions=r,_.isEmpty(n.sub_category.nested_sub_categories)||(f[n.sub_category.category_id]=f[n.sub_category.category_id]||{},f[n.sub_category.category_id][n.sub_category.id]=_.sortBy(n.sub_category.nested_sub_categories,"text"),f[n.sub_category.category_id][n.sub_category.id].unshift({val:0,text:e.t("manage_gigs.form.placeholders.service_type")}),o.nestedServiceTypes=e.extend({},o.nestedServiceTypes,f)),i+=1}),a.regenerateSubcatsDropDown(m),a.handleProCats(o.ps.pro_subcategories,c),o.autoSelectSubcategory&&(c.fakeDropdown("val",o.autoSelectSubcategory),o.autoSelectSubcategory=null))}})},reportGigChange:function(e){var t,n="gigUpcrate:gigChanged",i={detail:{gig:e}};"function"==typeof window.CustomEvent?t=new CustomEvent(n,i):(t=document.createEvent("CustomEvent"),t.initCustomEvent(n,!1,!1,i.detail)),document.dispatchEvent(t)},regenerateSubcatsDropDown:function(t){var n=this,i=n.models,r=n.selectors;r.$subCatsWrapper.fakeDropdown({classes:"js-gig-edit-subcat",initial:{text:e.t("manage_gigs.form.placeholders.subcategory"),id:0},options:i.subCatOptions,autoWidth:!0,createHiddenInput:!0,doPreventDefault:!0,onAction:t,hiddenInputName:"gig[sub_category_id]"})},initTextEditor:function(e,t,n,i){fTextEditor.init(e,t,n,i)},initTagsEditor:function(n){var i,r,a=e(n),o=a.find("textarea").hide(),s=o.val();e.each(a.find("input.tag-input"),function(t,n){r=e('<input type="text" class="tag-input" name="tag-input" maxlength="20">'),e(this).replaceWith(r)}),i=a.find("input.tag-input");var c=function(e){return e.length<3||e.length>20?!1:!0},d=function(e){var t=/[a-z0-9 ]/i;return!t.test(e)};a.on("click",function(){i.focus()}),i.on("focus",function(){a.addClass("inside")}).on("blur",function(){a.removeClass("inside"),c(i.val())&&(i.tagsManager("pushTag",i.val()),Fiverr.pushGoogleTag("GigCreate","TagSelect",i.val(),"blank"))}).tagsManager({prefilled:s,delimeters:[44,13],backspace:[8],maxTags:5,hiddenTagListId:o.attr("id"),tagCloseIcon:"x",tagClass:"gig-tag",validator:c,preventTyping:d}),e('#js-gig-tags input[name="hidden-tag-input"]').bind("change",function(){e("#gig_tag_list").val(e(this).val())}),t.initAutoComplete({input:i,listContainer:e(".js-tag-list"),autoCompleteData:document.tagsList,minChars:3,autoPositioning:!0,autoPositionOffsets:{left:-5,top:6}},function(t,n){e(t).tagsManager("popTag"),e(t).tagsManager("pushTag",n),Fiverr.pushGoogleTag("GigCreate","TagSelect",n,"blank")})},initSocialEmail:function(){var t=this,n=e("#email-gig-delivery"),i=n.find(".js-share-delivery-recipient"),r=n.find(".js-share-delivery-email"),a=n.find(".js-share-delivery-message"),o=e(".input-wrap.email");t.addErrorMessage=function(t,n,i){var i=i||e.t("users.new.form.error_messages.email"),r=n.find(".error-container").length,a=e('<div class="error-container"><p class="msg-error">'+i+"</p></div>");r||(n.append(a),a.show(),t.addClass("with-error"))},t.cleanErrorMessage=function(e,t){t.find(".error-container").remove(),e.removeClass("with-error")},n.find("input").placeholder(),n.find("textarea").placeholder(),e(".js-share-delivery-email").focus(function(){t.cleanErrorMessage(r,o)}),e(".js-submit-share-email").on("click",function(n){n.preventDefault();var s=e(this).closest(".email-share-form"),c=s.find(".js-share-delivery-data"),d={};return d={email:{to:r.val(),name:i.val(),user_message:a.val()},delivery_type:e(".js-coll-slider .js-slide:eq(0)").find("a.js-vid-play").length>0?"vid":"pic",object_id:c.attr("object_id"),object_type:c.attr("object_type"),order_id:c.attr("order_id"),user_id:c.attr("user_id"),social_platform:c.attr("social_platform"),sharer:c.attr("sharer"),source:c.attr("source"),utm_term:c.attr("utm_term"),utm_campaign:c.attr("utm_campaign"),utm_medium:c.attr("utm_medium"),utm_source:c.attr("utm_source"),buyable_type:c.attr("buyable_type")},t.cleanErrorMessage(r,o),fForms.models.formRegEx.email.test(d.email.to)?void e.ajax({url:"/d/share_delivery_email",type:"post",data:d,complete:function(t){e(".js-email-share-form").slideUp(),s.find(".error-container").hide()}}):void t.addErrorMessage(r,o)})},populateShareButtons:function(){var t=this,n=t.gigCreateShareLinks,i=e("#email-gig-delivery"),r=e(".btn-share.email"),a=e(".js-link-copy"),o=e(".js-email-share-form");if(t.initSocialEmail(),i.find("input").placeholder(),i.find("textarea").placeholder(),r.on("click",function(e){e.preventDefault(),o.slideToggle()}),!(_.keys(n).length<1)){for(var s in n){var c=e(".btn-share."+s);c.length&&c.attr("href",n[s])}a.val(n.directLink),e("#share-gig").attr("object_id",n.gigId)}},populatePreviewButton:function(){var n=t.gigID,i=e("a.js-preview"),r="";!n||i.length<1||!Fiverr.models.user||(r="/"+Fiverr.models.user.userName+"/"+n,i.attr("href",r))},progressStep:function(n){n=n||1;var i=this,r=i.progressSteps,a=i.currentStep,o=a+n<r.length?a+n:-1,s=null,c=null;if(!(i.flag>r.length)){if(s=e("section#gig-edit-"+i.progressSteps[a]),i.currentStep+=n,!(o>=0))return Fiverr._debug("[fEditGig] progressStep : entering-last"),void t.execLastStep();var d="/gig-funnel/entering-"+i.progressSteps[o];document.pageScope.ftg&&(d+="-ftg"),Fiverr._debug("[fEditGig] progressStep : entering-"+i.progressSteps[o]),Fiverr.pushGoogleGenericTag({virtualPage:d,event:"virtualPages"}),c=e("section#gig-edit-"+i.progressSteps[o]),_.has(window,"fGigsUpcrate")?ft.utl.getUrlHashVars().wizard&&Fiverr.pushGoogleUniversalTag("Gig Create","Gig Create - New Design",i.progressSteps[a]):"new"===document.pageScope.sub&&Fiverr.pushGoogleUniversalTag("Gig Create","Gig Create - Old Design",i.progressSteps[a]);var l=function(){c.length?i.showSection(c):(i.flag++,n>=0?i.progressStep(1):i.progressStep(-1))};i.hideSection(s,l),e(".flash-message").remove()}},progressToSection:function(t){if(!t)return!1;("share"==t||"pending"==t)&&"es"==document.pageScope.locale&&fLoader("//assetsv2.fiverrcdn.com/assets/invitebox-code-912dae636b5519f921127772a95d934c.js");var n=this,i=n.progressSteps,r=n.currentStep,a=null,o=null,s=e.inArray(t,i);if(r!=s&&(a=e("section#gig-edit-"+n.progressSteps[r]),"new"===document.pageScope.sub&&Fiverr.pushGoogleUniversalTag("Gig Create","Gig Create - Old Design",n.progressSteps[r]),s>=0)){n.currentStep=s,o=e("section#gig-edit-"+n.progressSteps[s]);var c=function(){o.length?n.showSection(o):(n.flag++,n.progressStep(1))};n.hideSection(a,c),e(".flash-message").remove()}},prependTextToGigTitle:function(t,n){if(!(t.length<1)){var i=e("<span></span>").addClass("gig-before-title").text(n);t.closest(".gig-edit-title-wrap").append(i),t.css({"text-indent":i.innerWidth()}),Fiverr.models.browser.ie&&t.focus(),i.on("click",function(){t.focus()}),t.on("scroll",function(){i.css({top:7-e(this).scrollTop()})})}},bindGigExtrasFocus:function(){var t=this,n=(t.models,t.selectors);n.$form.find(".js-upgrades").on("focus",".js-gig-extra textarea.js-extra-title, .js-gig-extra textarea.js-extra-description",function(){var t=e(this).closest(".js-gig-extra").find('input[type="checkbox"].js-extra-checkbox');t.attr("checked",!0),t.val(1)})},bindGigExtraShow:function(){e(".js-upgrades").on("click",".js-add-gig-extra",function(t){t.preventDefault();var n=e(this),i=e(".js-gig-extra.hidden"),r=i.first(),a=r.find(".js-extra-title"),o=r.find(".js-extra-description"),s=r.find(".js-fdd-duration"),c=s.find(".dropdown-toggle"),d=r.find(".js-includes-extra"),l=r.closest(".js-custom-extra-wrapper").find(".js-remove-extra").find("input");i.length<=1&&n.closest(".add-gig-extra").addClass("hidden"),a.val()&&(a.val(""),o.val(""),c.fakeDropdown("reset"),d.prop("checked",!1),l.val("")),r.removeClass("hidden"),_.has(window,"fGigsUpcrate")&&(fGigsUpcrate.bindTranslationExtraTextWidth(),fGigsUpcrate.bindExtraDescriptionScroll())}),e(document).on("click",".js-remove-extra",function(t){var n=e(this),i=n.closest(".js-gig-extra"),r=n.closest(".js-custom-extra-wrapper").find(".add-gig-extra"),a=n.find("input");Fiverr.popups.confirmation({confirmHeader:e.t("manage_gigs.index.custom_extra.title"),confirmText:e.t("manage_gigs.index.custom_extra.remove_extra_confirmation"),buttons:[{btnText:e.t("general.cancel")},{btnText:e.t("general.yes")}],onConfirm:function(){a.val("true"),i.addClass("hidden"),r.removeClass("hidden")}})})},fieldBuilder:{expectedDuration:function(t,n){var i={options:[],selected:t.selected,initial:{text:e.t("manage_gigs.edit.gig_and_packages.placeholders.delivery_time")}};i.createHiddenInput=!1,i.onAction=function(t){var n=e(t),i=n.data("val"),r=n.closest("td");e('input[name="gig[expected_duration]"]').val(i).closest(".expected-duration-wrap").find(".dropdown-toggle").text(n.text()),r.removeClass("with-error")};for(var r=t.min;r<=t.max;r++)i.options.push({text:e.t("general.num_days",{count:r})+" "+e.t("general.delivery"),val:r});return i},includedModifications:function(n){var i,r=this,a=t.models,o=(t.selectors,n),s="included_modifications";if(i=a.gigPackages.templateData.gigItems,o.hiddenInputName=r.buildPricingFactorString(s,i.randInd),o.onAction=function(t){var n=e(t),i=n.closest("td"),a=n.data("val");r.setActiveState(i,"select"===a?"0":"1"),i.find('input[data-name="included-modifications"]').val(a)},_.isArray(n.included_modifications_options)){o.options=n.included_modifications_options;for(var c=0;c<o.options.length;c++)for(var d in o.options[c])o.options[c][d]=_.isString(o.options[c][d])?o.options[c][d].toLowerCase():o.options[c][d];_.isUndefined(n[s])||_.isNull(n[s])||(o.selected=n[s]),o.options.unshift({val:"select",text:e.t("general.select")})}return o},price:function(t,n){var i={moreThanFive:!1},r=e.i18n.numberToCurrency(300);switch(level=Fiverr.models.ps.highestAchievement,i.options=t.all_prices,_.isUndefined(t.selected)||_.isNull(t.selected)||(i.selected=t.selected),t.all_prices.length>1&&(i.moreThanFive=!0),level){case"level_one_seller":r=e.i18n.numberToCurrency(2e3);break;case"level_two_seller":r=e.i18n.numberToCurrency(4500);break;case"top_rated_seller":r=e.i18n.numberToCurrency(1400)}return i.earnMoreString=e.t("manage_gigs.edit.gig_and_packages.basic_gig_tooltips.price_tooltip.earn_more_than",{amount:r}),i.isPro=m.isPro,i},buildFakeDropdown:function(n,i,r){var a,o=this,s=(t.models,t.selectors,{autoWidth:!0,initial:{text:e.t("general.select")},maxHeight:250,showInitialOptions:!0,createHiddenInput:!0}),c=r.closest("td");i[n].options&&(a=_.extend({},s,i[n]),a.options=o.reformatDataForFakeDropdown(a.options),a.hiddenInputName&&(a.attrs='data-hidden-input-name="'+a.hiddenInputName+'"'),_.isFunction(a.onAction)||(a.onAction=function(t){var n=e(t),i=n.closest(".filter-select"),r=i.data("hidden-input-name");o.setActiveState(n.closest("td"),"select"===n.data("val")?"0":"1"),r&&i.find('input[name="'+r+'"]').trigger("change")}),1===a.options.length&&(a.isDisabled=!0),r.fakeDropdown(a).addClass("capitalized"),!a.hasOwnProperty("active")||a.active&&0!==parseInt(a.active,10)?_.isUndefined(a.selected)||_.isNull(a.selected)||(r.fakeDropdown("val",a.selected.toString()),o.setActiveState(c,"1")):(r.fakeDropdown("reset"),o.setActiveState(c,"0")))},setActiveState:function(e,t){e.find('input[data-name="active"]').val(t).trigger("setActive")},buildPricingFactorString:function(e,t){return"gig[gig_items_attributes]["+t+"][pricing_factor]["+e+"]"}},getCurrentServiceType:function(){var n=t.models,i=n.ps.subcategories,r=_.isEmpty(n.nestedServiceTypes)?{}:n.nestedServiceTypes[e('input[name="gig[category_id]"]').val()],a={};return r=r||{},_.isEmpty(r)&&i&&i.list.length&&_.map(i.list,function(e,t){_.isEmpty(e.nested_sub_categories)||(r[e.id]=e.nested_sub_categories)}),r&&!_.isEmpty(r[n.subCatID])&&(a.options=r[n.subCatID],a.initial=_.find(r[n.subCatID],{val:e(".js-service-types-wrapper").fakeDropdown("val")})||{},_.isEmpty(a.initial)&&(a.initial={text:e.t("manage_gigs.form.placeholders.service_type"),val:0})),a},postGigRenderActions:function(t){var n,i,r=this;r.models,r.selectors;_.forOwn(t,function(a,o){if(_.isObject(t[o])&&!_.isEmpty(t[o])){if(level=t,"gigItems"===o)return level=t[o],void _.forOwn(level,function(t,a){i=_.kebabCase(a),n=e(".js-packages-"+i),n.hasClass("js-dd")&&r.fieldBuilder.buildFakeDropdown(a,level,n)});i=_.kebabCase(o),n=e(".js-packages-"+i),n.hasClass("js-dd")&&r.fieldBuilder.buildFakeDropdown(o,level,n)}}),r.initProPricing()},initServiceType:function(t){var n=e(".js-box-change-service-type"),i=function(){n.find("strong").addClass("hidden"),n.find("a").text(e.t("general.cancel")),n.find(".ddl-change-service-type").removeClass("hidden").fakeDropdown({initial:t.initial,options:t.options,doPreventDefault:!0,minWidth:150,onAction:r})},r=function(){var t=e(".js-service-types-wrapper").fakeDropdown("txt"),i=n.find(".ddl-change-service-type").fakeDropdown("txt"),r=function(){document.pageScope.hasServiceType=!1,e(".js-service-types-wrapper").fakeDropdown("val",n.find(".ddl-change-service-type").fakeDropdown("val"))};if(t!==i)return t?void Fiverr.popups.confirmation({confirmHeader:e.t("manage_gigs.confirmation_popup.change_service_type.title"),confirmText:e.t("manage_gigs.confirmation_popup.change_service_type.desc",{new_service_type:i,old_service_type:t}),buttons:[{btnText:e.t("general.cancel")},{btnText:e.t("manage_gigs.confirmation_popup.change_service_type.btn_confirm",{new_service_type:i})}],onConfirm:function(e){r()},onClose:function(){a()}}):void r()},a=function(){n.removeClass("hidden editing"),n.find(".ddl-change-service-type").addClass("hidden").empty(),n.find("a").text(e.t("general.change")),n.find("strong").removeClass("hidden")},o=function(){n.find("a").on("click",function(){n.toggleClass("editing"),n.hasClass("editing")?i():a()})},s=function(){n.addClass("hidden"),_.isEmpty(t)||(a(),o())};s()},bindUpgradeCheckbox:function(){var t=this;e(".js-upgrades").on("click",".js-extra-checkbox",function(n){var i=e(this),r=i.prop("checked")?1:0;r?i.closest(".item-row, .extra-fast, .js-upgrades-per-package").addClass("is-checked open"):i.closest(".item-row, .extra-fast, .js-upgrades-per-package").removeClass("is-checked open"),i.closest(".js-upgrades-per-package").length&&t.updateUpgradePackageActive(i.closest(".js-upgrades-per-package"),i.prop("checked")),i.closest(".gig-extra").length&&i.val(r)})},updateUpgradePackageActive:function(t,n){var i=this,r=(i.models,i.selectors,t.find(".js-upgrades-package-active"));n?t.find(".js-fdd-unit .fake-dropdown [type=hidden]").each(function(){var t=e(this),n=parseFloat(t.val(),10);n&&t.closest(".upgrades-per-package-item").find(".js-upgrades-package-active").val("1")}):r.val("0")},bindShippingToggle:function(){e(".js-shipping").on("click",".js-shipping-checkbox",function(t){var n=e(this),i=n.prop("checked");i?n.closest(".shipping").find(".shipping-input-pad").addClass("show"):n.closest(".shipping").find(".shipping-input-pad").removeClass("show")})},publishGigAjax:function(n){var i=n.form,r=this;return n.disableFormSubmit(),t.gigID?void e.ajax({url:t.manageGigsPath+"/"+r.gigID+"/publish",type:"get",data:i.serialize(),dataType:"text",success:function(t){var i;t=e.parseJSON(t),200==t.code?("approved"==t.gig_status?(r.gigCreateShareLinks.facebook=t.facebook_link,r.gigCreateShareLinks.twitter=t.twitter_link,r.gigCreateShareLinks.gplus=t.gplus_link,r.gigCreateShareLinks.linkedin=t.linkedin_link,r.gigCreateShareLinks.directLink=t.direct_link,r.gigCreateShareLinks.gigId=t.gig_id,document.pageScope.gig_id=t.gig_id,i=document.pageScope.ftg?"first-time-publish-gig-success":"publish-gig-success",r.populateShareButtons(),r.populatePreviewButton(),r.progressToSection("share"),e("#gig-edit-share").trigger("js-tracking-open-popup")):(i=document.pageScope.ftg?"first-time-publish-gig-pending":"publish-gig-pending",r.progressToSection("pending")),Fiverr._debug("[fEditGig] publishGigAjax : "+i),Fiverr.pushGoogleGenericTag({virtualPage:"/gig-funnel/"+i,event:"virtualPages"})):(i=document.pageScope.ftg?"first-time-publish-gig-finish":"publish-gig-finish",r.progressToSection("finish")),n.enableFormSubmit()},error:function(){n.form.find(".sub-action").text(e.t("manage_gigs.form.error.gig_failed_save")),n.enableFormSubmit()}}):(n.enableFormSubmit(),!1)},showFormSubmitErrors:function(t){if(t){var n=e(".main-flashes"),i=e('<div class="flash-message flash-error"><p></p></div>');i.find("p")[0].innerHTML=t,n.find(".flash-message").remove(),n.append(i),Fiverr.mainWrapperPush(),e(document).scrollTo({top:"0",left:"0"},800)}},showAjaxErrors:function(t,n){if(!(n.length<1)){var i=e(".main-flashes"),r=e('<div class="flash-message flash-error"><p></p></div>'),a="";e(n).each(function(e,t){var n=this.error_desc;a+=n+"<br>"}),r.find("p")[0].innerHTML=a,i.find(".flash-message").remove(),i.append(r),Fiverr.mainWrapperPush(),e(document).scrollTo({top:"0",left:"0"},800)}},bindGigEditForm:function(){var n=this,i=n.models,r=(n.selectors,e("form.edit-gig")),a=r.find(".gig-title-text");if(i.ps.gig_edit_seo_title)var o,s=r.find(".js-show-seo-title"),c=r.find(".js-hide-seo-title"),d=r.find(".js-field-seo-title"),l=d.find(".gig-seo-title-text"),u={minSeoTitleLength:5,maxSeoTitleLength:50};r.length&&(i.ps.gig_edit_seo_title&&(s.on("click",function(){var e=a.val();o(),e.length&&l.val(e).change()}),c.on("click",function(){o(),l.val("")}),o=function(){d.toggleClass("hidden"),s.toggleClass("hidden")}),n.initTagsEditor("#js-gig-tags"),n.initShippingActions(),fForms.models.forms.gigEdit=new fForms.formHandler(r,{onInit:function(t){Fiverr._logEventToGraphite({label:"gig_upcrate_refactor.dead_code.gigEditForm.on_init",value:1,percentage:100}),i.gigFormHandler=t,t.isAjaxValidated=!1,t.gigTitle=r.find('textarea[name="gig[title]"]'),new fForms.formTextAreaObj(t.gigTitle),n.prependTextToGigTitle(t.gigTitle,e.t(n.getTranslatedGigTitlePrefix(),void 0,t.gigTitle.data("locale"))),i.ps.gig_edit_seo_title&&(t.gigSeoTitle=r.find('textarea[name="gig[seo_title]"]'),new fForms.formTextAreaObj(t.gigSeoTitle)),t.gigCategory=r.find('input[name="gig[category_id]"]'),new fForms.formGeneralObject(t.gigCategory),t.gigSubCategory=r.find('input[name="gig[sub_category_id]"]'),new fForms.formGeneralObject(t.gigSubCategory),t.gigDesc=r.find('textarea[name="gig[description]"]'),new fForms.formTextAreaObj(t.gigDesc),t.gigTags=r.find('textarea[name="gig[tag_list]"]'),new fForms.formGeneralObject(t.gigTags),t.gigDuration=r.find('input[name="gig[expected_duration]"]'),new fForms.formGeneralObject(t.gigDuration),t.$btnSubmit=r.find('input[type="submit"]'),n.addCurrentStepHiddenField(t.form,"general");for(var a=0;5>a;a++)t["gigExtraTitle"+a]=r.find('textarea[name="gig[gig_items_attributes]['+a+'][title]"]'),new fForms.formGeneralObject(t["gigExtraTitle"+a]),t["gigExtraActive"+a]=r.find('input[name="gig[gig_items_attributes]['+a+'][active]"]'),t["gigExtraDuration"+a]=r.find('input[name="gig[gig_items_attributes]['+a+'][expected_duration]"]'),new fForms.formGeneralObject(t["gigExtraDuration"+a]);n.bindUpgradeCheckbox(),n.bindShippingToggle(),n.bindGigExtraShow(),n.bindGigExtrasFocus()},onSubmit:function(e){e.preventDefault()},ajaxSubmit:!0,onAjaxSuccess:function(n,i){var r=Fiverr,a=r.models;i=e.parseJSON(i),200==i.code?window.location.href="/users/"+a.user.userName+"/manage_gigs":(n.enableFormSubmit(),t.showAjaxErrors(n,i.errors))}}).addCharsCounter(e("#js-gig-title-wrap"),80," "+e.t("manage_gigs.form.labels.max"),15).addCharsCounter(e(".textarea"),450," "+e.t("manage_gigs.form.labels.characters")),i.ps.gig_edit_seo_title&&fForms.models.forms.gigEdit.addCharsCounter(e("#js-gig-seo-title-wrap"),u.maxSeoTitleLength," "+e.t("manage_gigs.form.labels.max"),u.minSeoTitleLength))},getTranslatedGigTitlePrefix:function(){return"layouts.iwill."+(document.in_studio_gig_flow?"we_will":"i_will")},bindGigGeneralForm:function(){var n=e("form.create-gig"),i=this,r=i.models;n.length&&(i.initTagsEditor("#js-gig-tags"),fForms.models.forms.gigCreate=new fForms.formHandler(n,{onInit:function(t){Fiverr._logEventToGraphite({label:"gig_upcrate_refactor.dead_code.gigCreateForm.on_init",value:1,percentage:100}),r.gigFormHandler=t,t.isAjaxValidated=!1,t.gigTitle=n.find('textarea[name="gig[title]"]'),new fForms.formTextAreaObj(t.gigTitle),i.prependTextToGigTitle(t.gigTitle,e.t(i.getTranslatedGigTitlePrefix())),t.gigCategory=n.find('input[name="gig[category_id]"]'),new fForms.formGeneralObject(t.gigCategory),t.gigSubCategory=n.find('input[name="gig[sub_category_id]"]'),t.gigDesc=n.find('textarea[name="gig[description]"]'),new fForms.formTextAreaObj(t.gigDesc),t.gigTags=n.find('textarea[name="gig[tag_list]"]'),new fForms.formGeneralObject(t.gigTags),t.gigDuration=n.find('input[name="gig[expected_duration]"]'),new fForms.formGeneralObject(t.gigDuration),i.addCurrentStepHiddenField(t.form,"general")},onSubmit:function(e){e.preventDefault()},ajaxSubmit:!0,resetAfterAjax:!1,onAjaxSuccess:function(n,i){i=e.parseJSON(i),200==i.code?(e(".js-close-locale-notification").parent().hide(),i.gig_cached_slug&&(t.gigID=i.gig_cached_slug,document.pageScope.gigId=i.gig_id,t.manageGigsPath=n.form.attr("action")),n.form.attr("action",t.manageGigsPath+"/"+t.gigID),n.form.append('<input type="hidden" name="_method" value="put">'),n.form.find('input[name="retry_after_error"]').remove(),e("input#gig-id").val(t.gigID),n.uploadifiveAction("upload"),_.has(window,"fGigsUpcrate")&&fGigsUpcrate.handleGigCreated(i)):t.showAjaxErrors(n,i.errors)},onAjaxError:function(t,n){t.form.append('<input type="hidden" name="retry_after_error" value="1">'),t.form.find(".js-general .sub-action").text(e.t("manage_gigs.form.error.gig_failed_save")),t.enableFormSubmit()}}).addCharsCounter(e("#js-gig-title-wrap"),80," "+e.t("manage_gigs.form.labels.max")).addCharsCounter(e(".textarea"),450," "+e.t("manage_gigs.form.labels.characters")))},execLastStep:function(){window.onbeforeunload=null,window.location=t.manageGigsPath},RegexEscape:function(e){return String(e).replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")},initAutoComplete:function(n,i){if(!n.input||!n.listContainer||!n.autoCompleteData)return!1;var r={input:n.input,listContainer:n.listContainer,autoCompleteData:n.autoCompleteData,minChars:n.minChars||3,resultLength:n.resultLength||5,autoPositioning:n.autoPositioning||!1,autoPositionOffsets:n.autoPositionOffsets||{left:0,top:0}},a=function(){var e=r.input.position(),t=e.left+r.autoPositionOffsets.left,n=e.top+r.autoPositionOffsets.top+r.input.outerHeight();r.listContainer.css({left:t,top:n})};r.input.bind("keydown",function(t){if(13==t.keyCode&&(r.listContainer.find("li.sel").trigger("click"),r.input.val(""),r.listContainer.empty()),40==t.keyCode||38==t.keyCode){t.preventDefault();var n=r.listContainer.find("li.sel"),i=n.next(),a=n.prev(),o=40==t.keyCode;if(0==n.length){var s=r.listContainer.find("li");o?e(s[0]).addClass("sel"):e(s[s.length-1]).addClass("sel")}else n.removeClass("sel"),o&&i?i.addClass("sel"):a&&a.addClass("sel")}}).bind("change, keyup",function(n){if(40==n.keyCode||38==n.keyCode)return!1;var i,o=[],s=e(this).val(),c=r.listContainer;c.empty(),s.length>=r.minChars&&(i=new RegExp(t.RegexEscape(s),"gi"),o=jQuery.map(r.autoCompleteData,function(e){return e.toString().match(i)?e:null})),o.length>0?(e.each(o.slice(0,r.resultLength),function(t,n){var r=n.replace(/[\s\n\r]+/g," "),a='<span class="search-term">'+s+"</span>",o='<li title="'+r+'">'+r.replace(i,a)+"</li>";c.append(e(o).data("obj",r))}),r.autoPositioning&&a(),c.show()):c.empty().hide()}).bind("blur",function(e){setTimeout(function(){r.listContainer.hide()},200)}).bind("focus",function(){r.listContainer.show()}),r.listContainer.on("click","li",function(){i(r.input,e(this).data("obj"))})},addCurrentStepHiddenField:function(e,t){e.length&&e.append('<input type="hidden" class="js-current-step" name="current_step" value="'+t+'">')},showErrorPage:function(){Fiverr._getHbTemplate({tplType:"misc",tplName:"error-page",tplUrl:"//assetsv2.fiverrcdn.com/assets/dist/templates-compiled/misc/error-page-023e72ce58930f8047d4bff14764267f.js",tplData:{cta_url:ft.utl.getRestfulUrl("/users/@user/manage_gigs/"),title:e.t("manage_gigs.form.error_page.title"),sub_title:e.t("manage_gigs.form.error_page.sub_title"),cta_btn:e.t("manage_gigs.form.error_page.cta")},dependencies:["//assetsv2.fiverrcdn.com/assets/shared/global/error-page-0d033c31821ac257f5815302e674ac89.css"]},function(t){e(".db-top-nav-bar.upcrate-page").hide(),e(".js-db-edit-gig .db-content-inner").empty().append(t)})},reformatDataForFakeDropdown:function(e){return e&&e.length&&!e[0].hasOwnProperty("val")?(_.forEach(e,function(t,n){e[n].val=t.value,e[n].attrs='data-val="'+t.value+'"'}),e):e},bindFiverrLearnReportEvent:function(){e(".js-view-all-button").find("a").on("click",function(){Fiverr.sendEvents({group:"fiverr_learn",type:"fiverr_learn.click",current_page:"gig create",user:[{id:t.models.ps.currentUser.userId}],gig:{id:t.models.ps.gigId}})})}};window.fEditGig=t,e(document).ready(function(){t.init()})}(jQuery),Handlebars.registerPartial("fake-dropdown",Fiverr.Templates["global/fake-dropdown"]),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["manage-gigs-requirements"]=t():e["manage-gigs-requirements"]=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=101)}({101:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),a=i(r);t["default"]=function(){Handlebars.registerHelper("breaklines",a["default"])}(),e.exports=t["default"]},6:function(e,t,n){"use strict";e.exports=function(e){return e=Handlebars.Utils.escapeExpression(e).trim().replace(/(\r\n|\n|\r)/gm,"<br>"),new Handlebars.SafeString(e)}}})}),function(e){function t(){function t(e){r.toggleClass("hidden",!i.includes(e)),n=e}var n,i=[417,418,414,77,412,416,413,279],r=e(".js-cta-schedule");document.addEventListener("gigUpcrate:gigChanged",function(e){var n=_.get(e.detail.gig,"subCategoryId");n&&t(n)});var a=_.get(document.gigInitialCats,"subCategoryId");a&&t(a),r.find("a").on("click",function(){MixpanelWrapper.trackEvent("Clicked Learn About Live Sessions",{"Sub-category":n.toString()})})}function n(e,t){function n(){}n.prototype=e.prototype,t.uber=e.prototype,t.prototype=new n,t.prototype.constructor=t}function i(){e.each(o.requirements,function(e,t){t.sort_order=e})}var r,a,o,s,c=0,d=Fiverr.models.ps;!function(){var t=function(t,n){a=this,a=fBasicViewModel.call(a,t,n),a.onshowInitialEditor=function(t){var n;a.isEditStarted||(n=e(t.originalBindEvent.target),n.closest(".inactive").removeClass("inactive"),n.removeClass(a.binder.viewSelector),a.isEditStarted=!0)},a.onshowEditor=function(e){a.preventDefault(e),a.reset(),a.$editor.slideDown("fast"),a.$buyerView.slideUp("fast"),a.$view.removeClass("buyer-view")},a.oncloseEditor=function(e){return a.preventDefault(e),o.requirements.length?(a.$editor.slideUp("fast",a.reset),a.$buyerView.slideDown("fast"),void a.$view.addClass("buyer-view")):void a.reset()},a.onaddOption=function(t){a.preventDefault(t);var n,i,r,o=a.$view.find(".js-option")[0],s="";if(a.showAddOptionBtn())return n=a.get("optionsNum"),i=e(o).closest(".js-option"),r=i.clone(),r.find("input").val(s),i.parent().append(r),a.set("optionsNum",n+1),r},a.onremoveOption=function(t){var n;t=t.originalBindEvent,a.showRemoveOption()&&(n=a.get("optionsNum"),e(t.target).closest(".js-option").remove(),a.set("optionsNum",n-1))},a.onadd=function(e){var t,n,i;a.get("requirements");return a.preventDefault(e),t=a.$editor.find(":input").serializeArray(),i=a.validate({type:"form",serializedArray:t}),i.length?void a.showErrors(i):(n=a.newRequirement(t),a.editingNowItem?(a.splice("requirements",a.editingNowItem.index,1,n),a.editingNowItem=null):a.push("requirements",n),void a.set("r_id",""))},a.ondelete=function(t){t=t.originalBindEvent||t;var n=e(t.target).closest(".js-requirement"),i=a.getRequirement(t.target,"findIndex");n.remove(),a.splice("requirements",i,1)},a.onedit=function(t){var n;a.pubSub.trigger("showEditor"),t=t.originalBindEvent,n=a.getRequirement(t.target),a.editingNowItem={item:n,index:_.indexOf(a.get("requirements"),n)},~n.type.indexOf("select_")?(a.$typeDD.find('a[data-val="select_one"]').trigger("click"),a.renderOptions(n.meta_data.options)):a.$typeDD.find('a[data-val="'+n.type+'"]').trigger("click"),"select_many"===n.type?a.set("selectMany",!0):a.set("selectMany",!1),a.set("body",n.body),a.set("r_id",n.r_id?n.r_id:""),a.set("isMandatory",n.is_mandatory),a.set("requirementsNum","#"+(a.editingNowItem.index+1)),a.set("saveBtnText",e.t("manage_gigs.form.requirements.update")),a.$form.find("textarea").trigger("keyup")},a.isSelectType=function(){return a.get("type").indexOf("select_")>-1},a.showAddOptionBtn=function(){return a.get("optionsNum")<a.validations.maxOptions},a.showRemoveOption=function(){return a.get("optionsNum")>a.validations.minOptions}};n(fBasicViewModel,t),e.extend(t.prototype,{validations:{minBodyLength:2,maxBodyLength:450,minOptionLength:1,maxOptionLength:100,minOptions:2,maxOptions:10,maxRequirements:10},errors:{maxItems:e.t("manage_gigs.form.error.gig_requirements.requirements_max"),descShort:e.t("manage_gigs.form.error.gig_requirements.description_short"),descLong:e.t("manage_gigs.form.error.gig_requirements.description_long"),optionShort:e.t("manage_gigs.form.error.gig_requirements.option_short"),optionLong:e.t("manage_gigs.form.error.gig_requirements.option_long"),maxOptions:e.t("manage_gigs.form.error.gig_requirements.options_max"),minOptions:e.t("manage_gigs.form.error.gig_requirements.options_min")},fields:["_id","r_id","body","type","is_mandatory","sort_order","buyable_id","buyable_type","option","select_many"],typeOptions:[{val:"free_text",text:e.t("manage_gigs.form.requirements.types.free_text")},{val:"select_one",text:e.t("manage_gigs.form.requirements.types.multiple")},{val:"file_upload",text:e.t("manage_gigs.form.requirements.types.file")}],isEditStarted:!1,editingNowItem:null,hasErrors:!1,validate:function(t){var n,i=[],r=a.validations,s={},c=[],d=/^select_(one|many)$/;return!a.editingNowItem&&o.requirements.length>=r.maxRequirements&&i.push({selector:".js-requirement-editor",text:a.errors.maxItems}),"form"===t.type&&(n=t.serializedArray,e.each(n,function(t,n){if(-1===e.inArray(n.name,a.fields))return!0;switch(n.name){case"option":c.push(e.trim(n.value));break;default:s[n.name]=n.value}})),"object"===t.type&&(s=t.data),d.test(s.type)&&c.length&&(s.options=c,c.length>r.maxOptions?i.push({selector:".js-options-errors",text:a.errors.maxOptions}):c.length<r.minOptionLength&&i.push({selector:".js-options-errors",text:a.errors.minOptions}),e.each(c,function(e,t){t.trim().length<r.minOptionLength?i.push({option:e,text:a.errors.optionShort}):t.length>r.maxOptionLength&&i.push({option:e,text:a.errors.optionLong})})),s.body.trim().length<r.minBodyLength?i.push({selector:"textarea",text:a.errors.descShort}):s.body.length>r.maxBodyLength&&i.push({selector:".textarea",text:a.errors.descLong}),a.hasErrors=!!i.length,i},showErrors:function(t){var n,i,r;a.hasErrors&&t&&t.length&&(a.clearErrors(),n=e('<div class="error-container"><p class="msg-error"></p></div>'),e.each(t,function(e,t){t.selector?r=a.$view.find(t.selector):_.isUndefined(t.option)||(r=a.$options.find(".js-option").eq(t.option).find("input")),r.addClass("with-error"),i=n.clone().show(),i.insertAfter(r).find("p").html(t.text)}),n=i=r=null)},clearErrors:function(){a.$view.find(".error-container").remove(),a.$view.find(".with-error").removeClass("with-error"),a.hasErrors=!1},newRequirement:function(t){var n,i,r,o=a.fields,s={};return e.each(t,function(t,a){if(n=a.name,i=a.value,~e.inArray(n,o))switch(n){case"option":i.length>=1&&(s.meta_data=s.meta_data||{},s.meta_data.options=s.meta_data.options||[],s.meta_data.options.push(i));break;case"is_mandatory":s[n]=!!i;break;case"select_many":r=!!i;break;case"body":s[n]=e.trim(i);break;default:s[n]=i}}),"select_one"===s.type&&r&&(s.type="select_many"),new l(s)},getRequirement:function(t,n){var i,r,o=a.get("requirements");return n=n||"find",_.isObject(t)?(r=e(t),i=r.closest(".js-requirement").data("id")):_.isString(t)&&(i=t),_[n](o,function(e){return e._id===i})},reset:function(){return a.$form.trigger("reset"),a.clearErrors(),a.set("selectMany",!1,{silent:!0}),a.set("isMandatory",!1,{silent:!0}),a.set("body","",{silent:!0}),a.set("requirementsNum","#"+(o.requirements.length+1)),a.set("saveBtnText",e.t("manage_gigs.form.requirements.save")),a.$typeDD.find('a[data-val="free_text"]').trigger("click"),a.renderOptions(),a.$form.find("textarea").trigger("keyup"),a.editingNowItem=null,a},render:function(){return Fiverr._getHbTemplate({tplType:"dashboard-new",tplName:"manage-gig-formed-requirements",tplData:{requirements:o.requirements},callback:function(t){var n=function(e){return{val:"",text:_.escape(e)}},i=a.$buyerView.parent();a.$buyerView.detach().html(t).appendTo(i),e.each(o.requirements,function(t,i){i.type.match(/select_one/)&&i.meta_data.options.length>2&&e(".js-requirement-"+i._id).fakeDropdown({initial:{text:_.escape(i.meta_data.options[0]),val:""},options:_.map(i.meta_data.options,n),doPreventDefault:!0,noUppercase:!0,calculateHiddenWidth:!0,isDisabled:!0,onAction:e.noop})})}}),a},renderOptions:function(e){e=e||new Array(a.validations.minOptions),Fiverr._getHbTemplate({tplType:"dashboard-new",tplName:"manage-gig-formed-requirement-options",tplData:{options:e},callback:function(t){a.$options.html(t),a.set("optionsNum",e.length)}})},bindGigRequirementsDropDown:function(){a.$typeDD.fakeDropdown({initial:{text:"",val:""},options:a.typeOptions,createHiddenInput:!0,doPreventDefault:!0,noUppercase:!0,autoWidth:!0,calculateHiddenWidth:!0,hiddenInputName:"type",onAction:function(t){var n=e(t).data("val");a.set("type",n),a.clearErrors()}}),a.$typeDD.fakeDropdown("val","free_text")}}),function(e){var t=e.progressSteps,n=e.timelineSteps;t.splice(_.indexOf(t,"publish"),0,"requirements"),n.splice(_.indexOf(n,"publish"),0,"requirements")}(window.fEditGig);var c=function(n,c,d,u){r=new t(c,{view:d}),n.models.fGigRequirements=r,a=r,a.parent=n,o=a.models=n.models,s=a.selectors=n.selectors,e(document).ready(function(){a.applyBindings(),s.$requirements&&s.$requirements.length&&s.$requirements.parent().remove(),a.editMode=n.editMode||"create",o.requirements=o.requirements||[],s.$requirements=a.$view,s.$formedRequirements=a.$view,s.$formedRequirementsForm=a.$form=a.$view.closest("form"),s.$formedRequirementsTypeDD=a.$typeDD=a.$view.find(".type-dropdown"),s.$formedRequirementsOptions=a.$options=a.$view.find(".js-options"),s.$formedRequirementsEditor=a.$editor=a.$view.find(".js-requirement-editor"),s.$formedRequirementsBuyerView=a.$buyerView=a.$view.find(".js-requirements-view"),a.set("requirements",o.requirements,{silent:!0}),a.set("type","free_text"),a.set("requirementsNum","#"+(o.requirements.length+1)),a.renderOptions(),"edit"===a.editMode&&u&&u.length&&(e.each(u,function(e,t){var n=new l(t);o.requirements.push(n)}),a.$editor.find("textarea").trigger("click"),a.pubSub.multiTrigger("closeEditor render")),fForms.formHandlerObj.addCharsCounter(a.$editor.find(".ta-wrap"),a.validations.maxBodyLength," "+e.t("manage_gigs.form.labels.characters")),a.bindGigRequirementsDropDown(),a.pubSub.on(a.uid+":change",function(e,t,n){"requirements"===t&&(o.requirements.length?(i(),a.pubSub.multiTrigger("render closeEditor")):a.pubSub.trigger("showEditor"),a.$view.find(".js-requirements-dirty").val("true"))}),a.$editor.on("keyup","input, textarea",function(){a.clearErrors()})})};t.init=function(e,t,n,i){return r?r:(c(e,t,n,i),r)},window.fGigRequirementsViewModel=t}();var l=function(t){t=t||{};var n={_id:"temp-"+c++,sort_order:o.requirements.length,is_mandatory:!1,buyable_id:d.gigId,buyable_type:"Gig",meta_data:null};if(t=_.pick(t,this.properties),_.isObject(t._id)){var i=String(t._id.$oid);t._id=i,t.r_id=i}e.extend(this,n,t)};l.prototype.properties=["_id","r_id","type","body","sort_order","is_mandatory","buyable_id","buyable_type","meta_data"],t()}(jQuery);